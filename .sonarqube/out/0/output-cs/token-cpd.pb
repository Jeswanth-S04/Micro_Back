ˇ¨
YD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Services\UserService.cs
	namespace		 	"
BudgetManagementSystem		
  
.		  !
Api		! $
.		$ %
Services		% -
{

 
public 

class 
UserService 
: 
IUserService +
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
private 
readonly 
ILogger  
<  !
UserService! ,
>, -
_logger. 5
;5 6
public 
UserService 
( 
AppDbContext '
context( /
,/ 0
ILogger1 8
<8 9
UserService9 D
>D E
loggerF L
)L M
{ 	
_context 
= 
context 
; 
_logger 
= 
logger 
; 
} 	
private 
string 
HashPassword #
(# $
string$ *
password+ 3
)3 4
{ 	
using 
( 
var 
sha256 
= 
SHA256  &
.& '
Create' -
(- .
). /
)/ 0
{ 
var 
saltedPassword "
=# $
password% -
+. /
$str0 E
;E F
var 
hashedBytes 
=  !
sha256" (
.( )
ComputeHash) 4
(4 5
Encoding5 =
.= >
UTF8> B
.B C
GetBytesC K
(K L
saltedPasswordL Z
)Z [
)[ \
;\ ]
return 
Convert 
. 
ToBase64String -
(- .
hashedBytes. 9
)9 :
;: ;
} 
} 	
public!! 
async!! 
Task!! 
<!! 
IEnumerable!! %
<!!% &
UserResponseDto!!& 5
>!!5 6
>!!6 7
GetAllAsync!!8 C
(!!C D
)!!D E
{"" 	
try## 
{$$ 
var%% 
users%% 
=%% 
await%% !
_context%%" *
.%%* +
Users%%+ 0
.&& 
Include&& 
(&& 
u&& 
=>&& !
u&&" #
.&&# $

Department&&$ .
)&&. /
.'' 
OrderBy'' 
('' 
u'' 
=>'' !
u''" #
.''# $
Name''$ (
)''( )
.(( 
Select(( 
((( 
u(( 
=>((  
new((! $
UserResponseDto((% 4
{)) 
Id** 
=** 
u** 
.** 
Id** !
,**! "
Name++ 
=++ 
u++  
.++  !
Name++! %
,++% &
Email,, 
=,, 
u,,  !
.,,! "
Email,," '
,,,' (
Role-- 
=-- 
(--  
int--  #
)--# $
u--$ %
.--% &
Role--& *
,--* +
DepartmentId.. $
=..% &
u..' (
...( )
DepartmentId..) 5
,..5 6
DepartmentName// &
=//' (
u//) *
.//* +

Department//+ 5
!=//6 8
null//9 =
?//> ?
u//@ A
.//A B

Department//B L
.//L M
Name//M Q
://R S
null//T X
}00 
)00 
.11 
ToListAsync11  
(11  !
)11! "
;11" #
return33 
users33 
;33 
}44 
catch55 
(55 
	Exception55 
ex55 
)55  
{66 
_logger77 
.77 
LogError77  
(77  !
ex77! #
,77# $
$str77% A
)77A B
;77B C
throw88 
;88 
}99 
}:: 	
public<< 
async<< 
Task<< 
<<< 
UserResponseDto<< )
?<<) *
><<* +
GetByIdAsync<<, 8
(<<8 9
int<<9 <
id<<= ?
)<<? @
{== 	
try>> 
{?? 
var@@ 
user@@ 
=@@ 
await@@  
_context@@! )
.@@) *
Users@@* /
.AA 
IncludeAA 
(AA 
uAA 
=>AA !
uAA" #
.AA# $

DepartmentAA$ .
)AA. /
.BB 
WhereBB 
(BB 
uBB 
=>BB 
uBB  !
.BB! "
IdBB" $
==BB% '
idBB( *
)BB* +
.CC 
SelectCC 
(CC 
uCC 
=>CC  
newCC! $
UserResponseDtoCC% 4
{DD 
IdEE 
=EE 
uEE 
.EE 
IdEE !
,EE! "
NameFF 
=FF 
uFF  
.FF  !
NameFF! %
,FF% &
EmailGG 
=GG 
uGG  !
.GG! "
EmailGG" '
,GG' (
RoleHH 
=HH 
(HH  
intHH  #
)HH# $
uHH$ %
.HH% &
RoleHH& *
,HH* +
DepartmentIdII $
=II% &
uII' (
.II( )
DepartmentIdII) 5
,II5 6
DepartmentNameJJ &
=JJ' (
uJJ) *
.JJ* +

DepartmentJJ+ 5
!=JJ6 8
nullJJ9 =
?JJ> ?
uJJ@ A
.JJA B

DepartmentJJB L
.JJL M
NameJJM Q
:JJR S
nullJJT X
}KK 
)KK 
.LL 
FirstOrDefaultAsyncLL (
(LL( )
)LL) *
;LL* +
returnNN 
userNN 
;NN 
}OO 
catchPP 
(PP 
	ExceptionPP 
exPP 
)PP  
{QQ 
_loggerRR 
.RR 
LogErrorRR  
(RR  !
exRR! #
,RR# $
$strRR% E
,RRE F
idRRG I
)RRI J
;RRJ K
throwSS 
;SS 
}TT 
}UU 	
publicWW 
asyncWW 
TaskWW 
<WW 
UserResponseDtoWW )
>WW) *
CreateAsyncWW+ 6
(WW6 7
UserCreateDtoWW7 D
dtoWWE H
,WWH I
intWWJ M
createdByUserIdWWN ]
)WW] ^
{XX 	
tryYY 
{ZZ 
var\\ 
existingUser\\  
=\\! "
await\\# (
_context\\) 1
.\\1 2
Users\\2 7
.]] 
Where]] 
(]] 
u]] 
=>]] 
u]]  !
.]]! "
Email]]" '
.]]' (
ToLower]]( /
(]]/ 0
)]]0 1
==]]2 4
dto]]5 8
.]]8 9
Email]]9 >
.]]> ?
ToLower]]? F
(]]F G
)]]G H
)]]H I
.^^ 
FirstOrDefaultAsync^^ (
(^^( )
)^^) *
;^^* +
if`` 
(`` 
existingUser``  
!=``! #
null``$ (
)``( )
{aa 
throwbb 
newbb %
InvalidOperationExceptionbb 7
(bb7 8
$"bb8 :
$strbb: M
{bbM N
dtobbN Q
.bbQ R
EmailbbR W
}bbW X
$strbbX h
"bbh i
)bbi j
;bbj k
}cc 
ifff 
(ff 
dtoff 
.ff 
DepartmentIdff $
.ff$ %
HasValueff% -
)ff- .
{gg 
varhh 
departmentExistshh (
=hh) *
awaithh+ 0
_contexthh1 9
.hh9 :
Departmentshh: E
.ii 
AnyAsyncii !
(ii! "
dii" #
=>ii$ &
dii' (
.ii( )
Idii) +
==ii, .
dtoii/ 2
.ii2 3
DepartmentIdii3 ?
.ii? @
Valueii@ E
)iiE F
;iiF G
ifkk 
(kk 
!kk 
departmentExistskk )
)kk) *
{ll 
throwmm 
newmm !%
InvalidOperationExceptionmm" ;
(mm; <
$"mm< >
$strmm> Q
{mmQ R
dtommR U
.mmU V
DepartmentIdmmV b
}mmb c
$strmmc m
"mmm n
)mmn o
;mmo p
}nn 
}oo 
ifrr 
(rr 
dtorr 
.rr 
Rolerr 
<rr 
$numrr  
||rr! #
dtorr$ '
.rr' (
Rolerr( ,
>rr- .
$numrr/ 0
)rr0 1
{ss 
throwtt 
newtt %
InvalidOperationExceptiontt 7
(tt7 8
$str	tt8 Ä
)
ttÄ Å
;
ttÅ Ç
}uu 
varxx 
hashedPasswordxx "
=xx# $
HashPasswordxx% 1
(xx1 2
dtoxx2 5
.xx5 6
Passwordxx6 >
)xx> ?
;xx? @
varzz 
userzz 
=zz 
newzz 
Userzz #
{{{ 
Name|| 
=|| 
dto|| 
.|| 
Name|| #
.||# $
Trim||$ (
(||( )
)||) *
,||* +
Email}} 
=}} 
dto}} 
.}}  
Email}}  %
.}}% &
Trim}}& *
(}}* +
)}}+ ,
.}}, -
ToLower}}- 4
(}}4 5
)}}5 6
,}}6 7
PasswordHash~~  
=~~! "
hashedPassword~~# 1
,~~1 2
Role 
= 
( 
Enums !
.! "
UserRole" *
)* +
dto+ .
.. /
Role/ 3
,3 4
DepartmentId
ÄÄ  
=
ÄÄ! "
dto
ÄÄ# &
.
ÄÄ& '
DepartmentId
ÄÄ' 3
}
ÅÅ 
;
ÅÅ 
_context
ÉÉ 
.
ÉÉ 
Users
ÉÉ 
.
ÉÉ 
Add
ÉÉ "
(
ÉÉ" #
user
ÉÉ# '
)
ÉÉ' (
;
ÉÉ( )
await
ÑÑ 
_context
ÑÑ 
.
ÑÑ 
SaveChangesAsync
ÑÑ /
(
ÑÑ/ 0
)
ÑÑ0 1
;
ÑÑ1 2
var
áá 
createdUser
áá 
=
áá  !
await
áá" '
GetByIdAsync
áá( 4
(
áá4 5
user
áá5 9
.
áá9 :
Id
áá: <
)
áá< =
;
áá= >
_logger
ââ 
.
ââ 
LogInformation
ââ &
(
ââ& '
$strââ' ™
,ââ™ ´
user
ää 
.
ää 
Id
ää 
,
ää 
user
ää !
.
ää! "
Name
ää" &
,
ää& '
user
ää( ,
.
ää, -
Email
ää- 2
,
ää2 3
user
ää4 8
.
ää8 9
Role
ää9 =
,
ää= >
user
ää? C
.
ääC D
DepartmentId
ääD P
,
ääP Q
createdByUserId
ääR a
)
ääa b
;
ääb c
return
åå 
createdUser
åå "
!
åå" #
;
åå# $
}
çç 
catch
éé 
(
éé 
	Exception
éé 
ex
éé 
)
éé  
{
èè 
_logger
êê 
.
êê 
LogError
êê  
(
êê  !
ex
êê! #
,
êê# $
$str
êê% G
,
êêG H
dto
êêI L
.
êêL M
Email
êêM R
)
êêR S
;
êêS T
throw
ëë 
;
ëë 
}
íí 
}
ìì 	
public
ïï 
async
ïï 
Task
ïï 
<
ïï 
UserResponseDto
ïï )
>
ïï) *
UpdateAsync
ïï+ 6
(
ïï6 7
UserUpdateDto
ïï7 D
dto
ïïE H
,
ïïH I
int
ïïJ M
updatedByUserId
ïïN ]
)
ïï] ^
{
ññ 	
try
óó 
{
òò 
var
ôô 
user
ôô 
=
ôô 
await
ôô  
_context
ôô! )
.
ôô) *
Users
ôô* /
.
öö 
Where
öö 
(
öö 
u
öö 
=>
öö 
u
öö  !
.
öö! "
Id
öö" $
==
öö% '
dto
öö( +
.
öö+ ,
Id
öö, .
)
öö. /
.
õõ !
FirstOrDefaultAsync
õõ (
(
õõ( )
)
õõ) *
;
õõ* +
if
ùù 
(
ùù 
user
ùù 
==
ùù 
null
ùù  
)
ùù  !
{
ûû 
throw
üü 
new
üü '
InvalidOperationException
üü 7
(
üü7 8
$"
üü8 :
$str
üü: G
{
üüG H
dto
üüH K
.
üüK L
Id
üüL N
}
üüN O
$str
üüO Y
"
üüY Z
)
üüZ [
;
üü[ \
}
†† 
var
££ 
existingUser
££  
=
££! "
await
££# (
_context
££) 1
.
££1 2
Users
££2 7
.
§§ 
Where
§§ 
(
§§ 
u
§§ 
=>
§§ 
u
§§  !
.
§§! "
Email
§§" '
.
§§' (
ToLower
§§( /
(
§§/ 0
)
§§0 1
==
§§2 4
dto
§§5 8
.
§§8 9
Email
§§9 >
.
§§> ?
ToLower
§§? F
(
§§F G
)
§§G H
&&
§§I K
u
§§L M
.
§§M N
Id
§§N P
!=
§§Q S
dto
§§T W
.
§§W X
Id
§§X Z
)
§§Z [
.
•• !
FirstOrDefaultAsync
•• (
(
••( )
)
••) *
;
••* +
if
ßß 
(
ßß 
existingUser
ßß  
!=
ßß! #
null
ßß$ (
)
ßß( )
{
®® 
throw
©© 
new
©© '
InvalidOperationException
©© 7
(
©©7 8
$"
©©8 :
$str
©©: M
{
©©M N
dto
©©N Q
.
©©Q R
Email
©©R W
}
©©W X
$str
©©X h
"
©©h i
)
©©i j
;
©©j k
}
™™ 
if
≠≠ 
(
≠≠ 
dto
≠≠ 
.
≠≠ 
DepartmentId
≠≠ $
.
≠≠$ %
HasValue
≠≠% -
)
≠≠- .
{
ÆÆ 
var
ØØ 
departmentExists
ØØ (
=
ØØ) *
await
ØØ+ 0
_context
ØØ1 9
.
ØØ9 :
Departments
ØØ: E
.
∞∞ 
AnyAsync
∞∞ !
(
∞∞! "
d
∞∞" #
=>
∞∞$ &
d
∞∞' (
.
∞∞( )
Id
∞∞) +
==
∞∞, .
dto
∞∞/ 2
.
∞∞2 3
DepartmentId
∞∞3 ?
.
∞∞? @
Value
∞∞@ E
)
∞∞E F
;
∞∞F G
if
≤≤ 
(
≤≤ 
!
≤≤ 
departmentExists
≤≤ )
)
≤≤) *
{
≥≥ 
throw
¥¥ 
new
¥¥ !'
InvalidOperationException
¥¥" ;
(
¥¥; <
$"
¥¥< >
$str
¥¥> Q
{
¥¥Q R
dto
¥¥R U
.
¥¥U V
DepartmentId
¥¥V b
}
¥¥b c
$str
¥¥c m
"
¥¥m n
)
¥¥n o
;
¥¥o p
}
µµ 
}
∂∂ 
if
ππ 
(
ππ 
dto
ππ 
.
ππ 
Role
ππ 
<
ππ 
$num
ππ  
||
ππ! #
dto
ππ$ '
.
ππ' (
Role
ππ( ,
>
ππ- .
$num
ππ/ 0
)
ππ0 1
{
∫∫ 
throw
ªª 
new
ªª '
InvalidOperationException
ªª 7
(
ªª7 8
$strªª8 Ä
)ªªÄ Å
;ªªÅ Ç
}
ºº 
user
øø 
.
øø 
Name
øø 
=
øø 
dto
øø 
.
øø  
Name
øø  $
.
øø$ %
Trim
øø% )
(
øø) *
)
øø* +
;
øø+ ,
user
¿¿ 
.
¿¿ 
Email
¿¿ 
=
¿¿ 
dto
¿¿  
.
¿¿  !
Email
¿¿! &
.
¿¿& '
Trim
¿¿' +
(
¿¿+ ,
)
¿¿, -
.
¿¿- .
ToLower
¿¿. 5
(
¿¿5 6
)
¿¿6 7
;
¿¿7 8
user
¡¡ 
.
¡¡ 
Role
¡¡ 
=
¡¡ 
(
¡¡ 
Enums
¡¡ "
.
¡¡" #
UserRole
¡¡# +
)
¡¡+ ,
dto
¡¡, /
.
¡¡/ 0
Role
¡¡0 4
;
¡¡4 5
user
¬¬ 
.
¬¬ 
DepartmentId
¬¬ !
=
¬¬" #
dto
¬¬$ '
.
¬¬' (
DepartmentId
¬¬( 4
;
¬¬4 5
if
≈≈ 
(
≈≈ 
!
≈≈ 
string
≈≈ 
.
≈≈ 
IsNullOrEmpty
≈≈ )
(
≈≈) *
dto
≈≈* -
.
≈≈- .
Password
≈≈. 6
)
≈≈6 7
)
≈≈7 8
{
∆∆ 
user
«« 
.
«« 
PasswordHash
«« %
=
««& '
HashPassword
««( 4
(
««4 5
dto
««5 8
.
««8 9
Password
««9 A
)
««A B
;
««B C
}
»» 
await
   
_context
   
.
   
SaveChangesAsync
   /
(
  / 0
)
  0 1
;
  1 2
var
ÕÕ 
updatedUser
ÕÕ 
=
ÕÕ  !
await
ÕÕ" '
GetByIdAsync
ÕÕ( 4
(
ÕÕ4 5
user
ÕÕ5 9
.
ÕÕ9 :
Id
ÕÕ: <
)
ÕÕ< =
;
ÕÕ= >
_logger
œœ 
.
œœ 
LogInformation
œœ &
(
œœ& '
$strœœ' ™
,œœ™ ´
user
–– 
.
–– 
Id
–– 
,
–– 
user
–– !
.
––! "
Name
––" &
,
––& '
user
––( ,
.
––, -
Email
––- 2
,
––2 3
user
––4 8
.
––8 9
Role
––9 =
,
––= >
user
––? C
.
––C D
DepartmentId
––D P
,
––P Q
updatedByUserId
––R a
)
––a b
;
––b c
return
““ 
updatedUser
““ "
!
““" #
;
““# $
}
”” 
catch
‘‘ 
(
‘‘ 
	Exception
‘‘ 
ex
‘‘ 
)
‘‘  
{
’’ 
_logger
÷÷ 
.
÷÷ 
LogError
÷÷  
(
÷÷  !
ex
÷÷! #
,
÷÷# $
$str
÷÷% C
,
÷÷C D
dto
÷÷E H
.
÷÷H I
Id
÷÷I K
)
÷÷K L
;
÷÷L M
throw
◊◊ 
;
◊◊ 
}
ÿÿ 
}
ŸŸ 	
public
€€ 
async
€€ 
Task
€€ 
DeleteAsync
€€ %
(
€€% &
int
€€& )
id
€€* ,
,
€€, -
int
€€. 1
deletedByUserId
€€2 A
)
€€A B
{
‹‹ 	
try
›› 
{
ﬁﬁ 
var
ﬂﬂ 
user
ﬂﬂ 
=
ﬂﬂ 
await
ﬂﬂ  
_context
ﬂﬂ! )
.
ﬂﬂ) *
Users
ﬂﬂ* /
.
‡‡ 
Where
‡‡ 
(
‡‡ 
u
‡‡ 
=>
‡‡ 
u
‡‡  !
.
‡‡! "
Id
‡‡" $
==
‡‡% '
id
‡‡( *
)
‡‡* +
.
·· !
FirstOrDefaultAsync
·· (
(
··( )
)
··) *
;
··* +
if
„„ 
(
„„ 
user
„„ 
==
„„ 
null
„„  
)
„„  !
{
‰‰ 
throw
ÂÂ 
new
ÂÂ '
InvalidOperationException
ÂÂ 7
(
ÂÂ7 8
$"
ÂÂ8 :
$str
ÂÂ: G
{
ÂÂG H
id
ÂÂH J
}
ÂÂJ K
$str
ÂÂK U
"
ÂÂU V
)
ÂÂV W
;
ÂÂW X
}
ÊÊ 
bool
ÈÈ 
hasRelatedData
ÈÈ #
=
ÈÈ$ %
false
ÈÈ& +
;
ÈÈ+ ,
try
ÍÍ 
{
ÎÎ 
hasRelatedData
ÏÏ "
=
ÏÏ# $
await
ÏÏ% *
_context
ÏÏ+ 3
.
ÏÏ3 4 
AdjustmentRequests
ÏÏ4 F
.
ÌÌ 
AnyAsync
ÌÌ !
(
ÌÌ! "
r
ÌÌ" #
=>
ÌÌ$ &
r
ÌÌ' (
.
ÌÌ( )
ReviewedByUserId
ÌÌ) 9
==
ÌÌ: <
id
ÌÌ= ?
)
ÌÌ? @
;
ÌÌ@ A
}
ÓÓ 
catch
ÔÔ 
{
 
}
ÚÚ 
if
ÙÙ 
(
ÙÙ 
hasRelatedData
ÙÙ "
)
ÙÙ" #
{
ıı 
throw
ˆˆ 
new
ˆˆ '
InvalidOperationException
ˆˆ 7
(
ˆˆ7 8
$strˆˆ8 ê
)ˆˆê ë
;ˆˆë í
}
˜˜ 
_context
˙˙ 
.
˙˙ 
Users
˙˙ 
.
˙˙ 
Remove
˙˙ %
(
˙˙% &
user
˙˙& *
)
˙˙* +
;
˙˙+ ,
await
˚˚ 
_context
˚˚ 
.
˚˚ 
SaveChangesAsync
˚˚ /
(
˚˚/ 0
)
˚˚0 1
;
˚˚1 2
_logger
˝˝ 
.
˝˝ 
LogInformation
˝˝ &
(
˝˝& '
$str
˝˝' m
,
˝˝m n
user
˛˛ 
.
˛˛ 
Id
˛˛ 
,
˛˛ 
user
˛˛ !
.
˛˛! "
Name
˛˛" &
,
˛˛& '
deletedByUserId
˛˛( 7
)
˛˛7 8
;
˛˛8 9
}
ˇˇ 
catch
ÄÄ 
(
ÄÄ 
	Exception
ÄÄ 
ex
ÄÄ 
)
ÄÄ  
{
ÅÅ 
_logger
ÇÇ 
.
ÇÇ 
LogError
ÇÇ  
(
ÇÇ  !
ex
ÇÇ! #
,
ÇÇ# $
$str
ÇÇ% C
,
ÇÇC D
id
ÇÇE G
)
ÇÇG H
;
ÇÇH I
throw
ÉÉ 
;
ÉÉ 
}
ÑÑ 
}
ÖÖ 	
public
áá 
Task
áá 
<
áá 
bool
áá 
>
áá 
ActivateUserAsync
áá +
(
áá+ ,
int
áá, /
id
áá0 2
,
áá2 3
int
áá4 7
activatedByUserId
áá8 I
)
ááI J
{
àà 	
throw
ââ 
new
ââ %
NotImplementedException
ââ -
(
ââ- .
)
ââ. /
;
ââ/ 0
}
ää 	
}
ãã 
}åå Æ{
\D:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Services\RequestService.cs
	namespace

 	"
BudgetManagementSystem


  
.

  !
Api

! $
.

$ %
Services

% -
{ 
public 

class 
RequestService 
:  !
IRequestService" 1
{ 
private 
readonly 
AppDbContext %
_db& )
;) *
private 
readonly  
INotificationService -
	_notifier. 7
;7 8
private 
readonly 
IHubContext $
<$ %
	BudgetHub% .
>. /
_hub0 4
;4 5
public 
RequestService 
( 
AppDbContext *
db+ -
,- . 
INotificationService/ C
notifierD L
,L M
IHubContextN Y
<Y Z
	BudgetHubZ c
>c d
hube h
)h i
{ 	
_db 
= 
db 
; 
	_notifier 
= 
notifier  
;  !
_hub 
= 
hub 
; 
} 	
public 
async 
Task 
< (
AdjustmentRequestResponseDto 6
>6 7
CreateAsync8 C
(C D&
AdjustmentRequestCreateDtoD ^
dto_ b
,b c
intd g
userIdh n
)n o
{ 	
var 
dep 
= 
await 
_db 
.  
Departments  +
.+ ,
	FindAsync, 5
(5 6
dto6 9
.9 :
DepartmentId: F
)F G
??H J
throwK P
newQ T
	ExceptionU ^
(^ _
$str_ u
)u v
;v w
var 
cat 
= 
await 
_db 
.  
BudgetCategories  0
.0 1
	FindAsync1 :
(: ;
dto; >
.> ?

CategoryId? I
)I J
??K M
throwN S
newT W
	ExceptionX a
(a b
$strb v
)v w
;w x
var 
entity 
= 
new 
AdjustmentRequest .
{ 
DepartmentId   
=   
dto   "
.  " #
DepartmentId  # /
,  / 0

CategoryId!! 
=!! 
dto!!  
.!!  !

CategoryId!!! +
,!!+ ,
Reason"" 
="" 
dto"" 
."" 
Reason"" #
,""# $
Amount## 
=## 
dto## 
.## 
Amount## #
}$$ 
;$$ 
_db%% 
.%% 
AdjustmentRequests%% "
.%%" #
Add%%# &
(%%& '
entity%%' -
)%%- .
;%%. /
await&& 
_db&& 
.&& 
SaveChangesAsync&& &
(&&& '
)&&' (
;&&( )
_db(( 
.(( 
	AuditLogs(( 
.(( 
Add(( 
((( 
new(( !
AuditLog((" *
{)) 
UserId** 
=** 
userId** 
,**  
Action++ 
=++ 
$str++ .
,++. /
Details,, 
=,, 
$",, 
$str,, !
{,,! "
dep,," %
.,,% &
Name,,& *
},,* +
$str,,+ 1
{,,1 2
cat,,2 5
.,,5 6
Name,,6 :
},,: ;
$str,,; D
{,,D E
dto,,E H
.,,H I
Amount,,I O
},,O P
",,P Q
}-- 
)-- 
;-- 
await.. 
_db.. 
... 
SaveChangesAsync.. &
(..& '
)..' (
;..( )
await11 
	_notifier11 
.11 
NotifyRoleAsync11 +
(11+ ,
nameof11, 2
(112 3
UserRole113 ;
.11; <
FinanceAdmin11< H
)11H I
,11I J
$str11K c
,11c d
$"22 
$str22 
{22 
dep22 !
.22! "
Name22" &
}22& '
$str22' 2
{222 3
dto223 6
.226 7
Amount227 =
}22= >
$str22> C
{22C D
cat22D G
.22G H
Name22H L
}22L M
"22M N
)22N O
;22O P
await44 
_hub44 
.44 
Clients44 
.44 
Group44 $
(44$ %
$str44% 8
)448 9
.449 :
	SendAsync44: C
(44C D
$str44D U
)44U V
;44V W
return66 
ToDto66 
(66 
entity66 
)66  
;66  !
}77 	
public99 
async99 
Task99 
<99 (
AdjustmentRequestResponseDto99 6
>996 7
ReviewAsync998 C
(99C D
AdjustmentReviewDto99D W
dto99X [
,99[ \
int99] `
reviewerUserId99a o
)99o p
{:: 	
var;; 
req;; 
=;; 
await;; 
_db;; 
.;;  
AdjustmentRequests;;  2
.;;2 3
Include;;3 :
(;;: ;
r;;; <
=>;;= ?
r;;@ A
.;;A B

Department;;B L
);;L M
.;;M N
Include;;N U
(;;U V
r;;V W
=>;;X Z
r;;[ \
.;;\ ]
Category;;] e
);;e f
.<< 
FirstOrDefaultAsync<< $
(<<$ %
r<<% &
=><<' )
r<<* +
.<<+ ,
Id<<, .
==<</ 1
dto<<2 5
.<<5 6
	RequestId<<6 ?
)<<? @
??<<A C
throw<<D I
new<<J M
	Exception<<N W
(<<W X
$str<<X k
)<<k l
;<<l m
if>> 
(>> 
req>> 
.>> 
Status>> 
!=>> 
RequestStatus>> +
.>>+ ,
Pending>>, 3
)>>3 4
throw>>5 :
new>>; >
	Exception>>? H
(>>H I
$str>>I c
)>>c d
;>>d e
req@@ 
.@@ 
Status@@ 
=@@ 
dto@@ 
.@@ 
Approve@@ $
?@@% &
RequestStatus@@' 4
.@@4 5
Approved@@5 =
:@@> ?
RequestStatus@@@ M
.@@M N
Rejected@@N V
;@@V W
reqAA 
.AA 
ReviewerNoteAA 
=AA 
dtoAA "
.AA" #
ReviewerNoteAA# /
;AA/ 0
reqBB 
.BB 

ReviewedAtBB 
=BB 
DateTimeBB %
.BB% &
UtcNowBB& ,
;BB, -
reqCC 
.CC 
ReviewedByUserIdCC  
=CC! "
reviewerUserIdCC# 1
;CC1 2
awaitEE 
_dbEE 
.EE 
SaveChangesAsyncEE &
(EE& '
)EE' (
;EE( )
_dbGG 
.GG 
	AuditLogsGG 
.GG 
AddGG 
(GG 
newGG !
AuditLogGG" *
{HH 
UserIdII 
=II 
reviewerUserIdII '
,II' (
ActionJJ 
=JJ 
dtoJJ 
.JJ 
ApproveJJ $
?JJ% &
$strJJ' 8
:JJ9 :
$strJJ; L
,JJL M
DetailsKK 
=KK 
$"KK 
$strKK $
{KK$ %
reqKK% (
.KK( )
IdKK) +
}KK+ ,
$strKK, -
{KK- .
reqKK. 1
.KK1 2
StatusKK2 8
}KK8 9
"KK9 :
}LL 
)LL 
;LL 
awaitMM 
_dbMM 
.MM 
SaveChangesAsyncMM &
(MM& '
)MM' (
;MM( )
ifPP 
(PP 
dtoPP 
.PP 
ApprovePP 
)PP 
{QQ 
varRR 

allocationRR 
=RR  
awaitRR! &
_dbRR' *
.RR* +
AllocationsRR+ 6
.SS 
FirstOrDefaultAsyncSS (
(SS( )
aSS) *
=>SS+ -
aSS. /
.SS/ 0
DepartmentIdSS0 <
==SS= ?
reqSS@ C
.SSC D
DepartmentIdSSD P
&&SSQ S
aSST U
.SSU V

CategoryIdSSV `
==SSa c
reqSSd g
.SSg h

CategoryIdSSh r
)SSr s
;SSs t
ifTT 
(TT 

allocationTT 
==TT !
nullTT" &
)TT& '
{UU 

allocationVV 
=VV  
newVV! $

AllocationVV% /
{WW 
DepartmentIdXX $
=XX% &
reqXX' *
.XX* +
DepartmentIdXX+ 7
,XX7 8

CategoryIdYY "
=YY# $
reqYY% (
.YY( )

CategoryIdYY) 3
,YY3 4
AmountZZ 
=ZZ  
reqZZ! $
.ZZ$ %
AmountZZ% +
}[[ 
;[[ 
_db\\ 
.\\ 
Allocations\\ #
.\\# $
Add\\$ '
(\\' (

allocation\\( 2
)\\2 3
;\\3 4
}]] 
else^^ 
{__ 

allocation`` 
.`` 
Amount`` %
+=``& (
req``) ,
.``, -
Amount``- 3
;``3 4
}aa 
awaitbb 
_dbbb 
.bb 
SaveChangesAsyncbb *
(bb* +
)bb+ ,
;bb, -
}cc 
varff 
headff 
=ff 
awaitff 
_dbff  
.ff  !
Usersff! &
.ff& '
FirstOrDefaultAsyncff' :
(ff: ;
uff; <
=>ff= ?
uff@ A
.ffA B
DepartmentIdffB N
==ffO Q
reqffR U
.ffU V
DepartmentIdffV b
&&ffc e
ufff g
.ffg h
Roleffh l
==ffm o
UserRoleffp x
.ffx y
DepartmentHead	ffy á
)
ffá à
;
ffà â
ifgg 
(gg 
headgg 
!=gg 
nullgg 
)gg 
{hh 
varii 
subjectii 
=ii 
dtoii !
.ii! "
Approveii" )
?ii* +
$strii, >
:ii? @
$striiA S
;iiS T
varjj 
bodyjj 
=jj 
dtojj 
.jj 
Approvejj &
?kk 
$"kk 
$strkk &
{kk& '
reqkk' *
.kk* +
Idkk+ -
}kk- .
$strkk. 3
{kk3 4
reqkk4 7
.kk7 8
Amountkk8 >
}kk> ?
$strkk? C
{kkC D
reqkkD G
.kkG H
CategorykkH P
.kkP Q
NamekkQ U
}kkU V
$strkkV i
"kki j
:ll 
$"ll 
$strll &
{ll& '
reqll' *
.ll* +
Idll+ -
}ll- .
$strll. 3
{ll3 4
reqll4 7
.ll7 8
Amountll8 >
}ll> ?
$strll? C
{llC D
reqllD G
.llG H
CategoryllH P
.llP Q
NamellQ U
}llU V
$strllV k
{llk l
dtolll o
.llo p
ReviewerNotellp |
}ll| }
"ll} ~
;ll~ 
awaitmm 
	_notifiermm 
.mm  
NotifyUserAsyncmm  /
(mm/ 0
headmm0 4
.mm4 5
Idmm5 7
,mm7 8
subjectmm9 @
,mm@ A
bodymmB F
)mmF G
;mmG H
}nn 
awaitpp 
_hubpp 
.pp 
Clientspp 
.pp 
Grouppp $
(pp$ %
$"pp% '
$strpp' +
{pp+ ,
reqpp, /
.pp/ 0
DepartmentIdpp0 <
}pp< =
"pp= >
)pp> ?
.pp? @
	SendAsyncpp@ I
(ppI J
$strppJ [
)pp[ \
;pp\ ]
returnrr 
ToDtorr 
(rr 
reqrr 
)rr 
;rr 
}ss 	
publicuu 
asyncuu 
Taskuu 
<uu 
IEnumerableuu %
<uu% &(
AdjustmentRequestResponseDtouu& B
>uuB C
>uuC D
GetPendingAsyncuuE T
(uuT U
)uuU V
{vv 	
varww 
listww 
=ww 
awaitww 
_dbww  
.ww  !
AdjustmentRequestsww! 3
.ww3 4
Whereww4 9
(ww9 :
rww: ;
=>ww< >
rww? @
.ww@ A
StatuswwA G
==wwH J
RequestStatuswwK X
.wwX Y
PendingwwY `
)ww` a
.xx 
OrderByxx 
(xx 
rxx 
=>xx 
rxx 
.xx  
	CreatedAtxx  )
)xx) *
.xx* +
ToListAsyncxx+ 6
(xx6 7
)xx7 8
;xx8 9
returnyy 
listyy 
.yy 
Selectyy 
(yy 
ToDtoyy $
)yy$ %
;yy% &
}zz 	
public|| 
async|| 
Task|| 
<|| 
IEnumerable|| %
<||% &(
AdjustmentRequestResponseDto||& B
>||B C
>||C D 
GetByDepartmentAsync||E Y
(||Y Z
int||Z ]
departmentId||^ j
)||j k
{}} 	
var~~ 
list~~ 
=~~ 
await~~ 
_db~~  
.~~  !
AdjustmentRequests~~! 3
.~~3 4
Where~~4 9
(~~9 :
r~~: ;
=>~~< >
r~~? @
.~~@ A
DepartmentId~~A M
==~~N P
departmentId~~Q ]
)~~] ^
. 
OrderByDescending "
(" #
r# $
=>% '
r( )
.) *
	CreatedAt* 3
)3 4
.4 5
ToListAsync5 @
(@ A
)A B
;B C
return
ÄÄ 
list
ÄÄ 
.
ÄÄ 
Select
ÄÄ 
(
ÄÄ 
ToDto
ÄÄ $
)
ÄÄ$ %
;
ÄÄ% &
}
ÅÅ 	
private
ÉÉ 
static
ÉÉ *
AdjustmentRequestResponseDto
ÉÉ 3
ToDto
ÉÉ4 9
(
ÉÉ9 :
AdjustmentRequest
ÉÉ: K
r
ÉÉL M
)
ÉÉM N
=>
ÉÉO Q
new
ÉÉR U
(
ÉÉU V
)
ÉÉV W
{
ÑÑ 	
Id
ÖÖ 
=
ÖÖ 
r
ÖÖ 
.
ÖÖ 
Id
ÖÖ 
,
ÖÖ 
DepartmentId
ÜÜ 
=
ÜÜ 
r
ÜÜ 
.
ÜÜ 
DepartmentId
ÜÜ )
,
ÜÜ) *

CategoryId
áá 
=
áá 
r
áá 
.
áá 

CategoryId
áá %
,
áá% &
Reason
àà 
=
àà 
r
àà 
.
àà 
Reason
àà 
,
àà 
Amount
ââ 
=
ââ 
r
ââ 
.
ââ 
Amount
ââ 
,
ââ 
Status
ää 
=
ää 
r
ää 
.
ää 
Status
ää 
,
ää 
ReviewerNote
ãã 
=
ãã 
r
ãã 
.
ãã 
ReviewerNote
ãã )
,
ãã) *
	CreatedAt
åå 
=
åå 
r
åå 
.
åå 
	CreatedAt
åå #
,
åå# $

ReviewedAt
çç 
=
çç 
r
çç 
.
çç 

ReviewedAt
çç %
}
éé 	
;
éé	 

}
èè 
}êê ∆L
aD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Services\NotificationService.cs
	namespace

 	"
BudgetManagementSystem


  
.

  !
Api

! $
.

$ %
Services

% -
{ 
public 

class 
NotificationService $
:% & 
INotificationService' ;
{ 
private 
readonly 
IConfiguration '
_config( /
;/ 0
private 
readonly 
AppDbContext %
_db& )
;) *
public 
NotificationService "
(" #
IConfiguration# 1
config2 8
,8 9
AppDbContext: F
dbG I
)I J
{ 	
_config 
= 
config 
; 
_db 
= 
db 
; 
} 	
public 
async 
Task 
SendEmailAsync (
(( )
string) /
to0 2
,2 3
string4 :
subject; B
,B C
stringD J
htmlBodyK S
)S T
{ 	
try 
{ 
var 
message 
= 
new !
MimeMessage" -
(- .
). /
;/ 0
message 
. 
From 
. 
Add  
(  !
new! $
MailboxAddress% 3
(3 4
_config4 ;
[; <
$str< K
]K L
,L M
_configN U
[U V
$strV f
]f g
)g h
)h i
;i j
message 
. 
To 
. 
Add 
( 
MailboxAddress -
.- .
Parse. 3
(3 4
to4 6
)6 7
)7 8
;8 9
message 
. 
Subject 
=  !
subject" )
;) *
var   
body   
=   
new   
BodyBuilder   *
{  + ,
HtmlBody  - 5
=  6 7
htmlBody  8 @
}  A B
;  B C
message!! 
.!! 
Body!! 
=!! 
body!! #
.!!# $
ToMessageBody!!$ 1
(!!1 2
)!!2 3
;!!3 4
using## 
var## 
client##  
=##! "
new### &

SmtpClient##' 1
(##1 2
)##2 3
;##3 4
var$$ 
host$$ 
=$$ 
_config$$ "
[$$" #
$str$$# .
]$$. /
;$$/ 0
var%% 
port%% 
=%% 
int%% 
.%% 
Parse%% $
(%%$ %
_config%%% ,
[%%, -
$str%%- 8
]%%8 9
??%%: <
$str%%= B
)%%B C
;%%C D
var&& 
useStartTls&& 
=&&  !
bool&&" &
.&&& '
Parse&&' ,
(&&, -
_config&&- 4
[&&4 5
$str&&5 G
]&&G H
??&&I K
$str&&L R
)&&R S
;&&S T
await(( 
client(( 
.(( 
ConnectAsync(( )
((() *
host((* .
,((. /
port((0 4
,((4 5
useStartTls((6 A
?((B C
SecureSocketOptions((D W
.((W X
StartTls((X `
:((a b
SecureSocketOptions((c v
.((v w
Auto((w {
)(({ |
;((| }
await)) 
client)) 
.)) 
AuthenticateAsync)) .
()). /
_config))/ 6
[))6 7
$str))7 B
]))B C
,))C D
_config))E L
[))L M
$str))M \
]))\ ]
)))] ^
;))^ _
await** 
client** 
.** 
	SendAsync** &
(**& '
message**' .
)**. /
;**/ 0
await++ 
client++ 
.++ 
DisconnectAsync++ ,
(++, -
true++- 1
)++1 2
;++2 3
},, 
catch-- 
(-- 
	Exception-- 
ex-- 
)--  
{.. 
Console00 
.00 
	WriteLine00 !
(00! "
$"00" $
$str00$ :
{00: ;
ex00; =
.00= >
Message00> E
}00E F
"00F G
)00G H
;00H I
}11 
}22 	
public44 
async44 
Task44 
NotifyUserAsync44 )
(44) *
int44* -
userId44. 4
,444 5
string446 <
title44= B
,44B C
string44D J
message44K R
)44R S
{55 	
var66 
user66 
=66 
await66 
_db66  
.66  !
Users66! &
.66& '
FirstOrDefaultAsync66' :
(66: ;
u66; <
=>66= ?
u66@ A
.66A B
Id66B D
==66E G
userId66H N
)66N O
;66O P
if77 
(77 
user77 
==77 
null77 
)77 
return77 $
;77$ %
_db99 
.99 
Notifications99 
.99 
Add99 !
(99! "
new99" %
Models99& ,
.99, -
Notification99- 9
{:: 
UserId;; 
=;; 
userId;; 
,;;  
Title<< 
=<< 
title<< 
,<< 
Message== 
=== 
message== !
}>> 
)>> 
;>> 
await?? 
_db?? 
.?? 
SaveChangesAsync?? &
(??& '
)??' (
;??( )
tryAA 
{BB 
awaitCC 
SendEmailAsyncCC $
(CC$ %
userCC% )
.CC) *
EmailCC* /
,CC/ 0
titleCC1 6
,CC6 7
$"CC8 :
$strCC: =
{CC= >
messageCC> E
}CCE F
$strCCF J
"CCJ K
)CCK L
;CCL M
}DD 
catchEE 
{FF 
}HH 
}II 	
publicKK 
asyncKK 
TaskKK 
NotifyRoleAsyncKK )
(KK) *
stringKK* 0
roleKK1 5
,KK5 6
stringKK7 =
titleKK> C
,KKC D
stringKKE K
messageKKL S
)KKS T
{LL 	
UserRoleNN 
roleEnumNN 
;NN 
ifOO 
(OO 
!OO 
EnumOO 
.OO 
TryParseOO 
<OO 
UserRoleOO '
>OO' (
(OO( )
roleOO) -
,OO- .
outOO/ 2
roleEnumOO3 ;
)OO; <
)OO< =
{PP 
returnQQ 
;QQ 
}RR 
varUU 
usersUU 
=UU 
awaitUU 
_dbUU !
.UU! "
UsersUU" '
.UU' (
WhereUU( -
(UU- .
uUU. /
=>UU0 2
uUU3 4
.UU4 5
RoleUU5 9
==UU: <
roleEnumUU= E
)UUE F
.UUF G
ToListAsyncUUG R
(UUR S
)UUS T
;UUT U
foreachWW 
(WW 
varWW 
userWW 
inWW  
usersWW! &
)WW& '
{XX 
awaitYY 
NotifyUserAsyncYY %
(YY% &
userYY& *
.YY* +
IdYY+ -
,YY- .
titleYY/ 4
,YY4 5
messageYY6 =
)YY= >
;YY> ?
}ZZ 
}[[ 	
public]] 
async]] 
Task]] #
SendThresholdAlertAsync]] 1
(]]1 2
int]]2 5
departmentId]]6 B
,]]B C
int]]D G

categoryId]]H R
,]]R S
string]]T Z
details]][ b
)]]b c
{^^ 	
var`` 
depHeads`` 
=`` 
await``  
_db``! $
.``$ %
Users``% *
.aa 
Whereaa 
(aa 
uaa 
=>aa 
uaa 
.aa 
DepartmentIdaa *
==aa+ -
departmentIdaa. :
&&aa; =
uaa> ?
.aa? @
Roleaa@ D
==aaE G
UserRoleaaH P
.aaP Q
DepartmentHeadaaQ _
)aa_ `
.bb 
ToListAsyncbb 
(bb 
)bb 
;bb 
foreachdd 
(dd 
vardd 
headdd 
indd  
depHeadsdd! )
)dd) *
{ee 
awaitff 
NotifyUserAsyncff %
(ff% &
headff& *
.ff* +
Idff+ -
,ff- .
$strff/ G
,ffG H
detailsffI P
)ffP Q
;ffQ R
}gg 
varii 
adminsii 
=ii 
awaitii 
_dbii "
.ii" #
Usersii# (
.jj 
Wherejj 
(jj 
ujj 
=>jj 
ujj 
.jj 
Rolejj "
==jj# %
UserRolejj& .
.jj. /
FinanceAdminjj/ ;
)jj; <
.kk 
ToListAsynckk 
(kk 
)kk 
;kk 
foreachmm 
(mm 
varmm 
adminmm 
inmm !
adminsmm" (
)mm( )
{nn 
awaitoo 
NotifyUserAsyncoo %
(oo% &
adminoo& +
.oo+ ,
Idoo, .
,oo. /
$stroo0 P
,ooP Q
detailsooR Y
)ooY Z
;ooZ [
}pp 
}qq 	
}rr 
}ss ÑD
]D:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Services\CategoryService.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Services% -
{ 
public		 

class		 
CategoryService		  
:		! "
ICategoryService		# 3
{

 
private 
readonly 
AppDbContext %
_db& )
;) *
public 
CategoryService 
( 
AppDbContext +
db, .
). /
=>0 2
_db3 6
=7 8
db9 ;
;; <
public 
async 
Task 
< 
CategoryResponseDto -
>- .
CreateAsync/ :
(: ;
CategoryCreateDto; L
dtoM P
,P Q
intR U
userIdV \
)\ ]
{ 	
var 
exists 
= 
await 
_db "
." #
BudgetCategories# 3
.3 4
AnyAsync4 <
(< =
c= >
=>? A
cB C
.C D
NameD H
==I K
dtoL O
.O P
NameP T
&&U W
cX Y
.Y Z
	TimeframeZ c
==d f
dtog j
.j k
	Timeframek t
)t u
;u v
if 
( 
exists 
) 
throw 
new !
	Exception" +
(+ ,
$str, W
)W X
;X Y
var 
entity 
= 
new 
BudgetCategory +
{ 
Name 
= 
dto 
. 
Name 
,  
Limit 
= 
dto 
. 
Limit !
,! "
	Timeframe 
= 
dto 
.  
	Timeframe  )
,) *
ThresholdPercent  
=! "
dto# &
.& '
ThresholdPercent' 7
} 
; 
_db 
. 
BudgetCategories  
.  !
Add! $
($ %
entity% +
)+ ,
;, -
await 
_db 
. 
SaveChangesAsync &
(& '
)' (
;( )
_db 
. 
	AuditLogs 
. 
Add 
( 
new !
Models" (
.( )
AuditLog) 1
{ 
UserId   
=   
userId   
,    
Action!! 
=!! 
$str!! *
,!!* +
Details"" 
="" 
$""" 
$str"" %
{""% &
entity""& ,
."", -
Name""- 1
}""1 2
$str""2 4
{""4 5
entity""5 ;
.""; <
	Timeframe""< E
}""E F
$str""F N
{""N O
entity""O U
.""U V
Limit""V [
}""[ \
"""\ ]
}## 
)## 
;## 
await$$ 
_db$$ 
.$$ 
SaveChangesAsync$$ &
($$& '
)$$' (
;$$( )
return&& 
ToDto&& 
(&& 
entity&& 
)&&  
;&&  !
}'' 	
public)) 
async)) 
Task)) 
<)) 
CategoryResponseDto)) -
>))- .
UpdateAsync))/ :
()): ;
CategoryUpdateDto)); L
dto))M P
,))P Q
int))R U
userId))V \
)))\ ]
{** 	
var++ 
entity++ 
=++ 
await++ 
_db++ "
.++" #
BudgetCategories++# 3
.++3 4
	FindAsync++4 =
(++= >
dto++> A
.++A B
Id++B D
)++D E
??++F H
throw++I N
new++O R
	Exception++S \
(++\ ]
$str++] q
)++q r
;++r s
entity-- 
.-- 
Name-- 
=-- 
dto-- 
.-- 
Name-- "
;--" #
entity.. 
... 
Limit.. 
=.. 
dto.. 
... 
Limit.. $
;..$ %
entity// 
.// 
	Timeframe// 
=// 
dto// "
.//" #
	Timeframe//# ,
;//, -
entity00 
.00 
ThresholdPercent00 #
=00$ %
dto00& )
.00) *
ThresholdPercent00* :
;00: ;
await22 
_db22 
.22 
SaveChangesAsync22 &
(22& '
)22' (
;22( )
_db44 
.44 
	AuditLogs44 
.44 
Add44 
(44 
new44 !
Models44" (
.44( )
AuditLog44) 1
{55 
UserId66 
=66 
userId66 
,66  
Action77 
=77 
$str77 *
,77* +
Details88 
=88 
$"88 
$str88 %
{88% &
entity88& ,
.88, -
Id88- /
}88/ 0
$str880 8
"888 9
}99 
)99 
;99 
await:: 
_db:: 
.:: 
SaveChangesAsync:: &
(::& '
)::' (
;::( )
return<< 
ToDto<< 
(<< 
entity<< 
)<<  
;<<  !
}== 	
public?? 
async?? 
Task?? 
DeleteAsync?? %
(??% &
int??& )
id??* ,
,??, -
int??. 1
userId??2 8
)??8 9
{@@ 	
varAA 
entityAA 
=AA 
awaitAA 
_dbAA "
.AA" #
BudgetCategoriesAA# 3
.AA3 4
	FindAsyncAA4 =
(AA= >
idAA> @
)AA@ A
??AAB D
throwAAE J
newAAK N
	ExceptionAAO X
(AAX Y
$strAAY m
)AAm n
;AAn o
_dbBB 
.BB 
BudgetCategoriesBB  
.BB  !
RemoveBB! '
(BB' (
entityBB( .
)BB. /
;BB/ 0
awaitCC 
_dbCC 
.CC 
SaveChangesAsyncCC &
(CC& '
)CC' (
;CC( )
_dbEE 
.EE 
	AuditLogsEE 
.EE 
AddEE 
(EE 
newEE !
ModelsEE" (
.EE( )
AuditLogEE) 1
{FF 
UserIdGG 
=GG 
userIdGG 
,GG  
ActionHH 
=HH 
$strHH *
,HH* +
DetailsII 
=II 
$"II 
$strII %
{II% &
idII& (
}II( )
"II) *
}JJ 
)JJ 
;JJ 
awaitKK 
_dbKK 
.KK 
SaveChangesAsyncKK &
(KK& '
)KK' (
;KK( )
}LL 	
publicNN 
asyncNN 
TaskNN 
<NN 
IEnumerableNN %
<NN% &
CategoryResponseDtoNN& 9
>NN9 :
>NN: ;
GetAllAsyncNN< G
(NNG H
)NNH I
{OO 	
varPP 
listPP 
=PP 
awaitPP 
_dbPP  
.PP  !
BudgetCategoriesPP! 1
.PP1 2
OrderByPP2 9
(PP9 :
cPP: ;
=>PP< >
cPP? @
.PP@ A
NamePPA E
)PPE F
.PPF G
ToListAsyncPPG R
(PPR S
)PPS T
;PPT U
returnQQ 
listQQ 
.QQ 
SelectQQ 
(QQ 
ToDtoQQ $
)QQ$ %
;QQ% &
}RR 	
privateTT 
staticTT 
CategoryResponseDtoTT *
ToDtoTT+ 0
(TT0 1
BudgetCategoryTT1 ?
cTT@ A
)TTA B
=>TTC E
newTTF I
(TTI J
)TTJ K
{UU 	
IdVV 
=VV 
cVV 
.VV 
IdVV 
,VV 
NameWW 
=WW 
cWW 
.WW 
NameWW 
,WW 
LimitXX 
=XX 
cXX 
.XX 
LimitXX 
,XX 
	TimeframeYY 
=YY 
cYY 
.YY 
	TimeframeYY #
,YY# $
ThresholdPercentZZ 
=ZZ 
cZZ  
.ZZ  !
ThresholdPercentZZ! 1
}[[ 	
;[[	 

}\\ 
}]] ‚*
YD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Services\AuthService.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Services% -
{ 
public 

class 
AuthService 
: 
IAuthService +
{ 
private 
readonly 
AppDbContext %
_db& )
;) *
private 
readonly 
PasswordHasher '
_hasher( /
;/ 0
private 
readonly 
IConfiguration '
_config( /
;/ 0
public 
AuthService 
( 
AppDbContext '
db( *
,* +
PasswordHasher, :
hasher; A
,A B
IConfigurationC Q
configR X
)X Y
{ 	
_db 
= 
db 
; 
_hasher 
= 
hasher 
; 
_config 
= 
config 
; 
} 	
public 
async 
Task 
< 
LoginResponse '
>' (

LoginAsync) 3
(3 4
LoginRequest4 @
requestA H
)H I
{ 	
var 
user 
= 
await 
_db  
.  !
Users! &
.& '
Include' .
(. /
u/ 0
=>1 3
u4 5
.5 6

Department6 @
)@ A
.A B
FirstOrDefaultAsyncB U
(U V
uV W
=>X Z
u[ \
.\ ]
Email] b
==c e
requestf m
.m n
Emailn s
)s t
;t u
if 
( 
user 
== 
null 
|| 
!  !
_hasher! (
.( )
Verify) /
(/ 0
request0 7
.7 8
Password8 @
,@ A
userB F
.F G
PasswordHashG S
)S T
)T U
throw 
new 
	Exception #
(# $
$str$ ?
)? @
;@ A
var!! 
claims!! 
=!! 
new!! 
List!! !
<!!! "
Claim!!" '
>!!' (
{"" 
new## 
(## 

ClaimTypes## 
.## 
NameIdentifier## -
,##- .
user##/ 3
.##3 4
Id##4 6
.##6 7
ToString##7 ?
(##? @
)##@ A
)##A B
,##B C
new$$ 
($$ 

ClaimTypes$$ 
.$$ 
Email$$ $
,$$$ %
user$$& *
.$$* +
Email$$+ 0
)$$0 1
,$$1 2
new%% 
(%% 

ClaimTypes%% 
.%% 
Role%% #
,%%# $
user%%% )
.%%) *
Role%%* .
.%%. /
ToString%%/ 7
(%%7 8
)%%8 9
)%%9 :
,%%: ;
new&& 
(&& 
$str&& 
,&& 
user&& 
.&&  
DepartmentId&&  ,
?&&, -
.&&- .
ToString&&. 6
(&&6 7
)&&7 8
??&&9 ;
$str&&< >
)&&> ?
}'' 
;'' 
var)) 
key)) 
=)) 
new))  
SymmetricSecurityKey)) .
()). /
Encoding))/ 7
.))7 8
UTF8))8 <
.))< =
GetBytes))= E
())E F
_config))F M
[))M N
$str))N W
]))W X
!))X Y
)))Y Z
)))Z [
;))[ \
var** 
creds** 
=** 
new** 
SigningCredentials** .
(**. /
key**/ 2
,**2 3
SecurityAlgorithms**4 F
.**F G

HmacSha256**G Q
)**Q R
;**R S
var++ 
token++ 
=++ 
new++ 
JwtSecurityToken++ ,
(++, -
issuer,, 
:,, 
_config,, 
[,,  
$str,,  ,
],,, -
,,,- .
audience-- 
:-- 
_config-- !
[--! "
$str--" 0
]--0 1
,--1 2
claims.. 
:.. 
claims.. 
,.. 
expires// 
:// 
DateTime// !
.//! "
UtcNow//" (
.//( )
AddHours//) 1
(//1 2
$num//2 3
)//3 4
,//4 5
signingCredentials00 "
:00" #
creds00$ )
)00) *
;00* +
return22 
new22 
LoginResponse22 $
{33 
Token44 
=44 
new44 #
JwtSecurityTokenHandler44 3
(443 4
)444 5
.445 6

WriteToken446 @
(44@ A
token44A F
)44F G
,44G H
Role55 
=55 
user55 
.55 
Role55  
,55  !
DepartmentId66 
=66 
user66 #
.66# $
DepartmentId66$ 0
,660 1
Name77 
=77 
user77 
.77 
Name77  
}88 
;88 
}99 	
}:: 
};; Ì¡
_D:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Services\AllocationService.cs
	namespace		 	"
BudgetManagementSystem		
  
.		  !
Api		! $
.		$ %
Services		% -
{

 
public 

class 
AllocationService "
:# $
IAllocationService% 7
{ 
private 
readonly 
AppDbContext %
_db& )
;) *
private 
readonly  
INotificationService -
	_notifier. 7
;7 8
private 
readonly 
IHubContext $
<$ %
	BudgetHub% .
>. /
_hub0 4
;4 5
public 
AllocationService  
(  !
AppDbContext! -
db. 0
,0 1 
INotificationService2 F
notifierG O
,O P
IHubContextQ \
<\ ]
	BudgetHub] f
>f g
hubh k
)k l
{ 	
_db 
= 
db 
; 
	_notifier 
= 
notifier  
;  !
_hub 
= 
hub 
; 
} 	
public 
async 
Task 
< !
AllocationResponseDto /
>/ 0
CreateAsync1 <
(< =
AllocationCreateDto= P
dtoQ T
,T U
intV Y
userIdZ `
)` a
{ 	
var 
dep 
= 
await 
_db 
.  
Departments  +
.+ ,
	FindAsync, 5
(5 6
dto6 9
.9 :
DepartmentId: F
)F G
??H J
throwK P
newQ T
	ExceptionU ^
(^ _
$str_ u
)u v
;v w
var 
cat 
= 
await 
_db 
.  
BudgetCategories  0
.0 1
	FindAsync1 :
(: ;
dto; >
.> ?

CategoryId? I
)I J
??K M
throwN S
newT W
	ExceptionX a
(a b
$strb v
)v w
;w x
var 
currentAllocated  
=! "
await# (
_db) ,
., -
Allocations- 8
.8 9
Where9 >
(> ?
a? @
=>A C
aD E
.E F

CategoryIdF P
==Q S
dtoT W
.W X

CategoryIdX b
)b c
.c d
SumAsyncd l
(l m
am n
=>o q
ar s
.s t
Amountt z
)z {
;{ |
if 
( 
currentAllocated  
+! "
dto# &
.& '
Amount' -
>. /
cat0 3
.3 4
Limit4 9
)9 :
throw   
new   
	Exception   #
(  # $
$str  $ G
)  G H
;  H I
var"" 
entity"" 
="" 
new"" 

Allocation"" '
{## 
DepartmentId$$ 
=$$ 
dto$$ "
.$$" #
DepartmentId$$# /
,$$/ 0

CategoryId%% 
=%% 
dto%%  
.%%  !

CategoryId%%! +
,%%+ ,
Amount&& 
=&& 
dto&& 
.&& 
Amount&& #
}'' 
;'' 
_db(( 
.(( 
Allocations(( 
.(( 
Add(( 
(((  
entity((  &
)((& '
;((' (
await)) 
_db)) 
.)) 
SaveChangesAsync)) &
())& '
)))' (
;))( )
_db++ 
.++ 
	AuditLogs++ 
.++ 
Add++ 
(++ 
new++ !
AuditLog++" *
{,, 
UserId-- 
=-- 
userId-- 
,--  
Action.. 
=.. 
$str.. ,
,.., -
Details// 
=// 
$"// 
$str// !
{//! "
dep//" %
.//% &
Name//& *
}//* +
$str//+ 1
{//1 2
cat//2 5
.//5 6
Name//6 :
}//: ;
$str//; D
{//D E
dto//E H
.//H I
Amount//I O
}//O P
"//P Q
}00 
)00 
;00 
await11 
_db11 
.11 
SaveChangesAsync11 &
(11& '
)11' (
;11( )
await44 
_hub44 
.44 
Clients44 
.44 
Group44 $
(44$ %
$"44% '
$str44' +
{44+ ,
dto44, /
.44/ 0
DepartmentId440 <
}44< =
"44= >
)44> ?
.44? @
	SendAsync44@ I
(44I J
$str44J ]
)44] ^
;44^ _
return66 
ToDto66 
(66 
entity66 
,66  
cat66! $
.66$ %
	Timeframe66% .
)66. /
;66/ 0
}77 	
public99 
async99 
Task99 
<99 
IEnumerable99 %
<99% &!
AllocationResponseDto99& ;
>99; <
>99< = 
GetByDepartmentAsync99> R
(99R S
int99S V
departmentId99W c
)99c d
{:: 	
var;; 
list;; 
=;; 
await;; 
_db;;  
.;;  !
Allocations;;! ,
.<< 
Include<< 
(<< 
a<< 
=><< 
a<< 
.<<  
Category<<  (
)<<( )
.== 
Where== 
(== 
a== 
=>== 
a== 
.== 
DepartmentId== *
====+ -
departmentId==. :
)==: ;
.>> 
OrderByDescending>> "
(>>" #
a>># $
=>>>% '
a>>( )
.>>) *
	CreatedAt>>* 3
)>>3 4
.?? 
ToListAsync?? 
(?? 
)?? 
;?? 
returnAA 
listAA 
.AA 
SelectAA 
(AA 
aAA  
=>AA! #
ToDtoAA$ )
(AA) *
aAA* +
,AA+ ,
aAA- .
.AA. /
CategoryAA/ 7
.AA7 8
	TimeframeAA8 A
)AAA B
)AAB C
;AAC D
}BB 	
publicDD 
asyncDD 
TaskDD 
<DD  
DepartmentSummaryDtoDD .
>DD. /%
GetDepartmentSummaryAsyncDD0 I
(DDI J
intDDJ M
departmentIdDDN Z
)DDZ [
{EE 	
varFF 
depFF 
=FF 
awaitFF 
_dbFF 
.FF  
DepartmentsFF  +
.FF+ ,
	FindAsyncFF, 5
(FF5 6
departmentIdFF6 B
)FFB C
??FFD F
throwFFG L
newFFM P
	ExceptionFFQ Z
(FFZ [
$strFF[ q
)FFq r
;FFr s
varHH 
allocationsHH 
=HH 
awaitHH #
_dbHH$ '
.HH' (
AllocationsHH( 3
.HH3 4
IncludeHH4 ;
(HH; <
aHH< =
=>HH> @
aHHA B
.HHB C
CategoryHHC K
)HHK L
.II 
WhereII 
(II 
aII 
=>II 
aII 
.II 
DepartmentIdII *
==II+ -
departmentIdII. :
)II: ;
.JJ 
ToListAsyncJJ 
(JJ 
)JJ 
;JJ 
varLL 
	catGroupsLL 
=LL 
allocationsLL '
.LL' (
GroupByLL( /
(LL/ 0
aLL0 1
=>LL2 4
aLL5 6
.LL6 7
CategoryLL7 ?
)LL? @
;LL@ A
varMM 

categoriesMM 
=MM 
newMM  
ListMM! %
<MM% & 
CategoryBreakdownDtoMM& :
>MM: ;
(MM; <
)MM< =
;MM= >
decimalNN 

totalAllocNN 
=NN  
$numNN! "
,NN" #

totalSpentNN$ .
=NN/ 0
$numNN1 2
;NN2 3
foreachPP 
(PP 
varPP 
gPP 
inPP 
	catGroupsPP '
)PP' (
{QQ 
varRR 
allocRR 
=RR 
gRR 
.RR 
SumRR !
(RR! "
xRR" #
=>RR$ &
xRR' (
.RR( )
AmountRR) /
)RR/ 0
;RR0 1
varSS 
spentSS 
=SS 
gSS 
.SS 
SumSS !
(SS! "
xSS" #
=>SS$ &
xSS' (
.SS( )
SpentSS) .
)SS. /
;SS/ 0

totalAllocTT 
+=TT 
allocTT #
;TT# $

totalSpentUU 
+=UU 
spentUU #
;UU# $
varWW 
thresholdValueWW "
=WW# $
(WW% &
gWW& '
.WW' (
KeyWW( +
.WW+ ,
ThresholdPercentWW, <
/WW= >
$numWW? C
)WWC D
*WWE F
allocWWG L
;WWL M

categoriesXX 
.XX 
AddXX 
(XX 
newXX " 
CategoryBreakdownDtoXX# 7
{YY 

CategoryIdZZ 
=ZZ  
gZZ! "
.ZZ" #
KeyZZ# &
.ZZ& '
IdZZ' )
,ZZ) *
CategoryName[[  
=[[! "
g[[# $
.[[$ %
Key[[% (
.[[( )
Name[[) -
,[[- .

Allocation\\ 
=\\  
alloc\\! &
,\\& '
Spent]] 
=]] 
spent]] !
,]]! "
ThresholdPercent^^ $
=^^% &
g^^' (
.^^( )
Key^^) ,
.^^, -
ThresholdPercent^^- =
,^^= >
NearingLimit__  
=__! "
spent__# (
>=__) +
thresholdValue__, :
&&__; =
spent__> C
<__D E
alloc__F K
,__K L
Exceeded`` 
=`` 
spent`` $
>``% &
alloc``' ,
}aa 
)aa 
;aa 
}bb 
returndd 
newdd  
DepartmentSummaryDtodd +
{ee 
DepartmentIdff 
=ff 
departmentIdff +
,ff+ ,
DepartmentNamegg 
=gg  
depgg! $
.gg$ %
Namegg% )
,gg) *
TotalAllocationhh 
=hh  !

totalAllochh" ,
,hh, -

TotalSpentii 
=ii 

totalSpentii '
,ii' (

Categoriesjj 
=jj 

categoriesjj '
}kk 
;kk 
}ll 	
publicnn 
asyncnn 
Tasknn 
<nn  
ManagementSummaryDtonn .
>nn. /%
GetManagementSummaryAsyncnn0 I
(nnI J
intnnJ M
?nnM N

categoryIdnnO Y
=nnZ [
nullnn\ `
,nn` a
intnnb e
?nne f
departmentIdnng s
=nnt u
nullnnv z
)nnz {
{oo 	
varpp 
querypp 
=pp 
_dbpp 
.pp 
Allocationspp '
.pp' (
Includepp( /
(pp/ 0
app0 1
=>pp2 4
app5 6
.pp6 7
Categorypp7 ?
)pp? @
.pp@ A
IncludeppA H
(ppH I
appI J
=>ppK M
appN O
.ppO P

DepartmentppP Z
)ppZ [
.pp[ \
AsQueryablepp\ g
(ppg h
)pph i
;ppi j
ifqq 
(qq 

categoryIdqq 
.qq 
HasValueqq #
)qq# $
queryqq% *
=qq+ ,
queryqq- 2
.qq2 3
Whereqq3 8
(qq8 9
aqq9 :
=>qq; =
aqq> ?
.qq? @

CategoryIdqq@ J
==qqK M

categoryIdqqN X
.qqX Y
ValueqqY ^
)qq^ _
;qq_ `
ifrr 
(rr 
departmentIdrr 
.rr 
HasValuerr %
)rr% &
queryrr' ,
=rr- .
queryrr/ 4
.rr4 5
Whererr5 :
(rr: ;
arr; <
=>rr= ?
arr@ A
.rrA B
DepartmentIdrrB N
==rrO Q
departmentIdrrR ^
.rr^ _
Valuerr_ d
)rrd e
;rre f
vartt 
listtt 
=tt 
awaittt 
querytt "
.tt" #
ToListAsynctt# .
(tt. /
)tt/ 0
;tt0 1
varuu 
groupsuu 
=uu 
listuu 
.uu 
GroupByuu %
(uu% &
auu& '
=>uu( *
auu+ ,
.uu, -

Departmentuu- 7
)uu7 8
;uu8 9
varww 
departmentsww 
=ww 
newww !
Listww" &
<ww& ' 
DepartmentSummaryDtoww' ;
>ww; <
(ww< =
)ww= >
;ww> ?
decimalxx 

grandAllocxx 
=xx  
$numxx! "
,xx" #

grandSpentxx$ .
=xx/ 0
$numxx1 2
;xx2 3
foreachzz 
(zz 
varzz 
gzz 
inzz 
groupszz $
)zz$ %
{{{ 
var|| 
allocations|| 
=||  !
g||" #
.||# $
Sum||$ '
(||' (
x||( )
=>||* ,
x||- .
.||. /
Amount||/ 5
)||5 6
;||6 7
var}} 
spent}} 
=}} 
g}} 
.}} 
Sum}} !
(}}! "
x}}" #
=>}}$ &
x}}' (
.}}( )
Spent}}) .
)}}. /
;}}/ 0

grandAlloc~~ 
+=~~ 
allocations~~ )
;~~) *

grandSpent 
+= 
spent #
;# $
var
ÅÅ 
	catGroups
ÅÅ 
=
ÅÅ 
g
ÅÅ  !
.
ÅÅ! "
GroupBy
ÅÅ" )
(
ÅÅ) *
x
ÅÅ* +
=>
ÅÅ, .
x
ÅÅ/ 0
.
ÅÅ0 1
Category
ÅÅ1 9
)
ÅÅ9 :
;
ÅÅ: ;
var
ÇÇ 

categories
ÇÇ 
=
ÇÇ  
	catGroups
ÇÇ! *
.
ÇÇ* +
Select
ÇÇ+ 1
(
ÇÇ1 2
cg
ÇÇ2 4
=>
ÇÇ5 7
{
ÉÉ 
var
ÑÑ 
alloc
ÑÑ 
=
ÑÑ 
cg
ÑÑ  "
.
ÑÑ" #
Sum
ÑÑ# &
(
ÑÑ& '
x
ÑÑ' (
=>
ÑÑ) +
x
ÑÑ, -
.
ÑÑ- .
Amount
ÑÑ. 4
)
ÑÑ4 5
;
ÑÑ5 6
var
ÖÖ 
sp
ÖÖ 
=
ÖÖ 
cg
ÖÖ 
.
ÖÖ  
Sum
ÖÖ  #
(
ÖÖ# $
x
ÖÖ$ %
=>
ÖÖ& (
x
ÖÖ) *
.
ÖÖ* +
Spent
ÖÖ+ 0
)
ÖÖ0 1
;
ÖÖ1 2
var
ÜÜ 
thresholdVal
ÜÜ $
=
ÜÜ% &
(
ÜÜ' (
cg
ÜÜ( *
.
ÜÜ* +
Key
ÜÜ+ .
.
ÜÜ. /
ThresholdPercent
ÜÜ/ ?
/
ÜÜ@ A
$num
ÜÜB F
)
ÜÜF G
*
ÜÜH I
alloc
ÜÜJ O
;
ÜÜO P
return
áá 
new
áá "
CategoryBreakdownDto
áá 3
{
àà 

CategoryId
ââ "
=
ââ# $
cg
ââ% '
.
ââ' (
Key
ââ( +
.
ââ+ ,
Id
ââ, .
,
ââ. /
CategoryName
ää $
=
ää% &
cg
ää' )
.
ää) *
Key
ää* -
.
ää- .
Name
ää. 2
,
ää2 3

Allocation
ãã "
=
ãã# $
alloc
ãã% *
,
ãã* +
Spent
åå 
=
åå 
sp
åå  "
,
åå" #
ThresholdPercent
çç (
=
çç) *
cg
çç+ -
.
çç- .
Key
çç. 1
.
çç1 2
ThresholdPercent
çç2 B
,
ççB C
NearingLimit
éé $
=
éé% &
sp
éé' )
>=
éé* ,
thresholdVal
éé- 9
&&
éé: <
sp
éé= ?
<
éé@ A
alloc
ééB G
,
ééG H
Exceeded
èè  
=
èè! "
sp
èè# %
>
èè& '
alloc
èè( -
}
êê 
;
êê 
}
ëë 
)
ëë 
.
ëë 
ToList
ëë 
(
ëë 
)
ëë 
;
ëë 
departments
ìì 
.
ìì 
Add
ìì 
(
ìì  
new
ìì  #"
DepartmentSummaryDto
ìì$ 8
{
îî 
DepartmentId
ïï  
=
ïï! "
g
ïï# $
.
ïï$ %
Key
ïï% (
.
ïï( )
Id
ïï) +
,
ïï+ ,
DepartmentName
ññ "
=
ññ# $
g
ññ% &
.
ññ& '
Key
ññ' *
.
ññ* +
Name
ññ+ /
,
ññ/ 0
TotalAllocation
óó #
=
óó$ %
allocations
óó& 1
,
óó1 2

TotalSpent
òò 
=
òò  
spent
òò! &
,
òò& '

Categories
ôô 
=
ôô  

categories
ôô! +
}
öö 
)
öö 
;
öö 
}
õõ 
return
ùù 
new
ùù "
ManagementSummaryDto
ùù +
{
ûû 
Departments
üü 
=
üü 
departments
üü )
,
üü) *"
GrandTotalAllocation
†† $
=
††% &

grandAlloc
††' 1
,
††1 2
GrandTotalSpent
°° 
=
°°  !

grandSpent
°°" ,
}
¢¢ 
;
¢¢ 
}
££ 	
public
•• 
async
•• 
Task
•• 
UpdateSpentAsync
•• *
(
••* +
int
••+ .
allocationId
••/ ;
,
••; <
decimal
••= D
newSpent
••E M
,
••M N
int
••O R
userId
••S Y
)
••Y Z
{
¶¶ 	
var
ßß 

allocation
ßß 
=
ßß 
await
ßß "
_db
ßß# &
.
ßß& '
Allocations
ßß' 2
.
ßß2 3
Include
ßß3 :
(
ßß: ;
a
ßß; <
=>
ßß= ?
a
ßß@ A
.
ßßA B
Category
ßßB J
)
ßßJ K
.
ßßK L
Include
ßßL S
(
ßßS T
a
ßßT U
=>
ßßV X
a
ßßY Z
.
ßßZ [

Department
ßß[ e
)
ßße f
.
ßßf g!
FirstOrDefaultAsync
ßßg z
(
ßßz {
a
ßß{ |
=>
ßß} 
aßßÄ Å
.ßßÅ Ç
IdßßÇ Ñ
==ßßÖ á
allocationIdßßà î
)ßßî ï
??
®® 
throw
®® 
new
®® 
	Exception
®® &
(
®®& '
$str
®®' =
)
®®= >
;
®®> ?

allocation
™™ 
.
™™ 
Spent
™™ 
=
™™ 
newSpent
™™ '
;
™™' (
await
´´ 
_db
´´ 
.
´´ 
SaveChangesAsync
´´ &
(
´´& '
)
´´' (
;
´´( )
_db
≠≠ 
.
≠≠ 
	AuditLogs
≠≠ 
.
≠≠ 
Add
≠≠ 
(
≠≠ 
new
≠≠ !
AuditLog
≠≠" *
{
ÆÆ 
UserId
ØØ 
=
ØØ 
userId
ØØ 
,
ØØ  
Action
∞∞ 
=
∞∞ 
$str
∞∞ 1
,
∞∞1 2
Details
±± 
=
±± 
$"
±± 
$str
±± '
{
±±' (
allocationId
±±( 4
}
±±4 5
$str
±±5 <
{
±±< =
newSpent
±±= E
}
±±E F
"
±±F G
}
≤≤ 
)
≤≤ 
;
≤≤ 
await
≥≥ 
_db
≥≥ 
.
≥≥ 
SaveChangesAsync
≥≥ &
(
≥≥& '
)
≥≥' (
;
≥≥( )
var
∂∂ 
thresholdValue
∂∂ 
=
∂∂  

allocation
∂∂! +
.
∂∂+ ,
Amount
∂∂, 2
*
∂∂3 4
(
∂∂5 6

allocation
∂∂6 @
.
∂∂@ A
Category
∂∂A I
.
∂∂I J
ThresholdPercent
∂∂J Z
/
∂∂[ \
$num
∂∂] a
)
∂∂a b
;
∂∂b c
if
∑∑ 
(
∑∑ 

allocation
∑∑ 
.
∑∑ 
Spent
∑∑  
>=
∑∑! #
thresholdValue
∑∑$ 2
&&
∑∑3 5

allocation
∑∑6 @
.
∑∑@ A
Spent
∑∑A F
<
∑∑G H

allocation
∑∑I S
.
∑∑S T
Amount
∑∑T Z
)
∑∑Z [
{
∏∏ 
await
ππ 
	_notifier
ππ 
.
ππ  %
SendThresholdAlertAsync
ππ  7
(
ππ7 8

allocation
ππ8 B
.
ππB C
DepartmentId
ππC O
,
ππO P

allocation
ππQ [
.
ππ[ \

CategoryId
ππ\ f
,
ππf g
$"
∫∫ 
$str
∫∫ %
{
∫∫% &

allocation
∫∫& 0
.
∫∫0 1

Department
∫∫1 ;
.
∫∫; <
Name
∫∫< @
}
∫∫@ A
$str
∫∫A D
{
∫∫D E

allocation
∫∫E O
.
∫∫O P
Category
∫∫P X
.
∫∫X Y
Name
∫∫Y ]
}
∫∫] ^
"
∫∫^ _
)
∫∫_ `
;
∫∫` a
}
ªª 
else
ºº 
if
ºº 
(
ºº 

allocation
ºº 
.
ºº  
Spent
ºº  %
>
ºº& '

allocation
ºº( 2
.
ºº2 3
Amount
ºº3 9
)
ºº9 :
{
ΩΩ 
await
ææ 
	_notifier
ææ 
.
ææ  %
SendThresholdAlertAsync
ææ  7
(
ææ7 8

allocation
ææ8 B
.
ææB C
DepartmentId
ææC O
,
ææO P

allocation
ææQ [
.
ææ[ \

CategoryId
ææ\ f
,
ææf g
$"
øø 
$str
øø  
{
øø  !

allocation
øø! +
.
øø+ ,

Department
øø, 6
.
øø6 7
Name
øø7 ;
}
øø; <
$str
øø< ?
{
øø? @

allocation
øø@ J
.
øøJ K
Category
øøK S
.
øøS T
Name
øøT X
}
øøX Y
"
øøY Z
)
øøZ [
;
øø[ \
}
¿¿ 
await
¬¬ 
_hub
¬¬ 
.
¬¬ 
Clients
¬¬ 
.
¬¬ 
Group
¬¬ $
(
¬¬$ %
$"
¬¬% '
$str
¬¬' +
{
¬¬+ ,

allocation
¬¬, 6
.
¬¬6 7
DepartmentId
¬¬7 C
}
¬¬C D
"
¬¬D E
)
¬¬E F
.
¬¬F G
	SendAsync
¬¬G P
(
¬¬P Q
$str
¬¬Q e
)
¬¬e f
;
¬¬f g
}
√√ 	
private
≈≈ 
static
≈≈ #
AllocationResponseDto
≈≈ ,
ToDto
≈≈- 2
(
≈≈2 3

Allocation
≈≈3 =
a
≈≈> ?
,
≈≈? @
string
≈≈A G
	timeframe
≈≈H Q
)
≈≈Q R
=>
≈≈S U
new
≈≈V Y
(
≈≈Y Z
)
≈≈Z [
{
∆∆ 	
Id
«« 
=
«« 
a
«« 
.
«« 
Id
«« 
,
«« 
DepartmentId
»» 
=
»» 
a
»» 
.
»» 
DepartmentId
»» )
,
»») *

CategoryId
…… 
=
…… 
a
…… 
.
…… 

CategoryId
…… %
,
……% &
Amount
   
=
   
a
   
.
   
Amount
   
,
   
Spent
ÀÀ 
=
ÀÀ 
a
ÀÀ 
.
ÀÀ 
Spent
ÀÀ 
,
ÀÀ 
	CreatedAt
ÃÃ 
=
ÃÃ 
a
ÃÃ 
.
ÃÃ 
	CreatedAt
ÃÃ #
,
ÃÃ# $
	Timeframe
ÕÕ 
=
ÕÕ 
	timeframe
ÕÕ !
}
ŒŒ 	
;
ŒŒ	 

public
–– 
Task
–– 
<
–– #
AllocationResponseDto
–– )
>
––) *
UpdateAsync
––+ 6
(
––6 7
int
––7 :
id
––; =
,
––= >!
AllocationUpdateDto
––? R
dto
––S V
,
––V W
int
––X [
userId
––\ b
)
––b c
{
—— 	
throw
““ 
new
““ %
NotImplementedException
““ -
(
““- .
)
““. /
;
““/ 0
}
”” 	
public
’’ 
Task
’’ 
DeleteAsync
’’ 
(
’’  
int
’’  #
id
’’$ &
,
’’& '
int
’’( +
userId
’’, 2
)
’’2 3
{
÷÷ 	
throw
◊◊ 
new
◊◊ %
NotImplementedException
◊◊ -
(
◊◊- .
)
◊◊. /
;
◊◊/ 0
}
ÿÿ 	
}
ŸŸ 
}⁄⁄ Ÿ^
LD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddCors 
( 
options  
=>! #
{ 
options 
. 
	AddPolicy 
( 
$str %
,% &
policy' -
=>. 0
{ 
policy 
. 
WithOrigins 
( 
$str 2
)2 3
. 
AllowAnyHeader 
( 
) 
. 
AllowAnyMethod 
( 
) 
. 
AllowCredentials 
(  
)  !
;! "
} 
) 
; 
} 
) 
; 
builder 
. 
Services 
. 
AddDbContext 
< 
AppDbContext *
>* +
(+ ,
opts, 0
=>1 3
{ 
var 
cs 

= 
builder 
. 
Configuration "
." #
GetConnectionString# 6
(6 7
$str7 J
)J K
;K L
opts   
.   	
UseMySql  	 
(   
cs   
,   
ServerVersion   #
.  # $

AutoDetect  $ .
(  . /
cs  / 1
)  1 2
)  2 3
;  3 4
}!! 
)!! 
;!! 
var$$ 

jwtSection$$ 
=$$ 
builder$$ 
.$$ 
Configuration$$ &
.$$& '

GetSection$$' 1
($$1 2
$str$$2 7
)$$7 8
;$$8 9
var%% 

signingKey%% 
=%% 
new%%  
SymmetricSecurityKey%% )
(%%) *
Encoding%%* 2
.%%2 3
UTF8%%3 7
.%%7 8
GetBytes%%8 @
(%%@ A

jwtSection%%A K
[%%K L
$str%%L Q
]%%Q R
!%%R S
)%%S T
)%%T U
;%%U V
builder'' 
.'' 
Services'' 
.(( 
AddAuthentication(( 
((( 
JwtBearerDefaults(( (
.((( ) 
AuthenticationScheme(() =
)((= >
.)) 
AddJwtBearer)) 
()) 
opts)) 
=>)) 
{** 
opts++ 
.++ %
TokenValidationParameters++ &
=++' (
new++) ,%
TokenValidationParameters++- F
{,, 	
ValidateIssuer-- 
=-- 
true-- !
,--! "
ValidIssuer.. 
=.. 

jwtSection.. $
[..$ %
$str..% -
]..- .
,... /
ValidateAudience// 
=// 
true// #
,//# $
ValidAudience00 
=00 

jwtSection00 &
[00& '
$str00' 1
]001 2
,002 3$
ValidateIssuerSigningKey11 $
=11% &
true11' +
,11+ ,
IssuerSigningKey22 
=22 

signingKey22 )
,22) *
ValidateLifetime33 
=33 
true33 #
}44 	
;44	 

opts77 
.77 
Events77 
=77 
new77 
JwtBearerEvents77 )
{88 	
OnMessageReceived99 
=99 
ctx99  #
=>99$ &
{:: 
var;; 
accessToken;; 
=;;  !
ctx;;" %
.;;% &
Request;;& -
.;;- .
Query;;. 3
[;;3 4
$str;;4 B
];;B C
;;;C D
var<< 
path<< 
=<< 
ctx<< 
.<< 
HttpContext<< *
.<<* +
Request<<+ 2
.<<2 3
Path<<3 7
;<<7 8
if== 
(== 
!== 
string== 
.== 
IsNullOrEmpty== )
(==) *
accessToken==* 5
)==5 6
&&==7 9
path==: >
.==> ?
StartsWithSegments==? Q
(==Q R
$str==R `
)==` a
)==a b
{>> 
ctx?? 
.?? 
Token?? 
=?? 
accessToken??  +
;??+ ,
}@@ 
returnAA 
TaskAA 
.AA 
CompletedTaskAA )
;AA) *
}BB 
}CC 	
;CC	 

}DD 
)DD 
;DD 
builderFF 
.FF 
ServicesFF 
.FF 
AddAuthorizationFF !
(FF! "
)FF" #
;FF# $
builderII 
.II 
ServicesII 
.II 
	AddScopedII 
<II 
IAuthServiceII '
,II' (
AuthServiceII) 4
>II4 5
(II5 6
)II6 7
;II7 8
builderJJ 
.JJ 
ServicesJJ 
.JJ 
	AddScopedJJ 
<JJ 
ICategoryServiceJJ +
,JJ+ ,
CategoryServiceJJ- <
>JJ< =
(JJ= >
)JJ> ?
;JJ? @
builderKK 
.KK 
ServicesKK 
.KK 
	AddScopedKK 
<KK 
IAllocationServiceKK -
,KK- .
AllocationServiceKK/ @
>KK@ A
(KKA B
)KKB C
;KKC D
builderLL 
.LL 
ServicesLL 
.LL 
	AddScopedLL 
<LL 
IRequestServiceLL *
,LL* +
RequestServiceLL, :
>LL: ;
(LL; <
)LL< =
;LL= >
builderMM 
.MM 
ServicesMM 
.MM 
	AddScopedMM 
<MM  
INotificationServiceMM /
,MM/ 0
NotificationServiceMM1 D
>MMD E
(MME F
)MMF G
;MMG H
builderNN 
.NN 
ServicesNN 
.NN 
AddSingletonNN 
<NN 
PasswordHasherNN ,
>NN, -
(NN- .
)NN. /
;NN/ 0
builderQQ 
.QQ 
ServicesQQ 
.QQ 
AddControllersQQ 
(QQ  
)QQ  !
.QQ! "
AddJsonOptionsQQ" 0
(QQ0 1
oQQ1 2
=>QQ3 5
{RR 
oSS 
.SS !
JsonSerializerOptionsSS 
.SS  
PropertyNamingPolicySS 0
=SS1 2
nullSS3 7
;SS7 8
}TT 
)TT 
;TT 
builderWW 
.WW 
ServicesWW 
.WW 

AddSignalRWW 
(WW 
)WW 
;WW 
builderZZ 
.ZZ 
ServicesZZ 
.ZZ #
AddEndpointsApiExplorerZZ (
(ZZ( )
)ZZ) *
;ZZ* +
builder[[ 
.[[ 
Services[[ 
.[[ 
AddSwaggerGen[[ 
([[ 
)[[  
;[[  !
var^^ 
app^^ 
=^^ 	
builder^^
 
.^^ 
Build^^ 
(^^ 
)^^ 
;^^ 
builder`` 
.`` 
Services`` 
.`` 
	AddScoped`` 
<`` 
IUserService`` '
,``' (
UserService``) 4
>``4 5
(``5 6
)``6 7
;``7 8
usingcc 
(cc 
varcc 

scopecc 
=cc 
appcc 
.cc 
Servicescc 
.cc  
CreateScopecc  +
(cc+ ,
)cc, -
)cc- .
{dd 
varee 
dbee 

=ee 
scopeee 
.ee 
ServiceProvideree "
.ee" #
GetRequiredServiceee# 5
<ee5 6
AppDbContextee6 B
>eeB C
(eeC D
)eeD E
;eeE F
dbff 
.ff 
Databaseff 
.ff 
Migrateff 
(ff 
)ff 
;ff 
varhh 
hasherhh 
=hh 
scopehh 
.hh 
ServiceProviderhh &
.hh& '
GetRequiredServicehh' 9
<hh9 :
PasswordHasherhh: H
>hhH I
(hhI J
)hhJ K
;hhK L
ifii 
(ii 
!ii 	
dbii	 
.ii 
Usersii 
.ii 
Anyii 
(ii 
)ii 
)ii 
{jj 
varkk 
depkk 
=kk 
newkk 

Departmentkk  
{kk! "
Namekk# '
=kk( )
$strkk* 7
}kk8 9
;kk9 :
dbll 

.ll
 
Departmentsll 
.ll 
Addll 
(ll 
depll 
)ll 
;ll  
dbmm 

.mm
 
Usersmm 
.mm 
AddRangemm 
(mm 
newnn 
Usernn 
{oo 
Namepp 
=pp 
$strpp 
,pp 
Emailqq 
=qq 
$strqq (
,qq( )
Rolerr 
=rr 
UserRolerr 
.rr  
FinanceAdminrr  ,
,rr, -
PasswordHashss 
=ss 
hasherss %
.ss% &
Hashss& *
(ss* +
$strss+ 6
)ss6 7
}tt 
,tt 
newuu 
Useruu 
{vv 
Nameww 
=ww 
$strww !
,ww! "
Emailxx 
=xx 
$strxx &
,xx& '
Roleyy 
=yy 
UserRoleyy 
.yy  
DepartmentHeadyy  .
,yy. /

Departmentzz 
=zz 
depzz  
,zz  !
PasswordHash{{ 
={{ 
hasher{{ %
.{{% &
Hash{{& *
({{* +
$str{{+ 5
){{5 6
}|| 
,|| 
new}} 
User}} 
{~~ 
Name 
= 
$str 
, 
Email
ÄÄ 
=
ÄÄ 
$str
ÄÄ '
,
ÄÄ' (
Role
ÅÅ 
=
ÅÅ 
UserRole
ÅÅ 
.
ÅÅ  

Management
ÅÅ  *
,
ÅÅ* +
PasswordHash
ÇÇ 
=
ÇÇ 
hasher
ÇÇ %
.
ÇÇ% &
Hash
ÇÇ& *
(
ÇÇ* +
$str
ÇÇ+ 5
)
ÇÇ5 6
}
ÉÉ 
)
ÑÑ 	
;
ÑÑ	 

db
ÖÖ 

.
ÖÖ
 
SaveChanges
ÖÖ 
(
ÖÖ 
)
ÖÖ 
;
ÖÖ 
}
ÜÜ 
}áá 
appää 
.
ää 
UseMiddleware
ää 
<
ää %
ErrorHandlingMiddleware
ää )
>
ää) *
(
ää* +
)
ää+ ,
;
ää, -
appåå 
.
åå 

UseSwagger
åå 
(
åå 
)
åå 
;
åå 
appçç 
.
çç 
UseSwaggerUI
çç 
(
çç 
)
çç 
;
çç 
appèè 
.
èè !
UseHttpsRedirection
èè 
(
èè 
)
èè 
;
èè 
appíí 
.
íí 
UseCors
íí 
(
íí 
$str
íí 
)
íí 
;
íí 
appìì 
.
ìì 
UseCors
ìì 
(
ìì 
)
ìì 
;
ìì 
appïï 
.
ïï 
UseAuthentication
ïï 
(
ïï 
)
ïï 
;
ïï 
appññ 
.
ññ 
UseAuthorization
ññ 
(
ññ 
)
ññ 
;
ññ 
appòò 
.
òò 
MapControllers
òò 
(
òò 
)
òò 
;
òò 
appôô 
.
ôô 
MapHub
ôô 

<
ôô
 
	BudgetHub
ôô 
>
ôô 
(
ôô 
$str
ôô $
)
ôô$ %
;
ôô% &
appõõ 
.
õõ 
Run
õõ 
(
õõ 
)
õõ 	
;
õõ	 
ª
PD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Models\User.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Models% +
{ 
public 

class 
User 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[

 	
Required

	 
,

 
	MaxLength

 
(

 
$num

  
)

  !
]

! "
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
[ 	
Required	 
, 
EmailAddress 
,  
	MaxLength! *
(* +
$num+ .
). /
]/ 0
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
[ 	
Required	 
] 
public 
string 
PasswordHash "
{# $
get% (
;( )
set* -
;- .
}/ 0
=1 2
string3 9
.9 :
Empty: ?
;? @
[ 	
Required	 
] 
public 
UserRole 
Role 
{ 
get "
;" #
set$ '
;' (
}) *
public 
int 
? 
DepartmentId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

Department 
? 

Department %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
} 
} ï
XD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Models\Notification.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Models% +
{ 
public 

class 
Notification 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
int 
? 
UserId 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 

TargetRole  
{! "
get# &
;& '
set( +
;+ ,
}- .
=/ 0
string1 7
.7 8
Empty8 =
;= >
public 
string 
Title 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public		 
string		 
Message		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
=		, -
string		. 4
.		4 5
Empty		5 :
;		: ;
public

 
bool

 
IsRead

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
=

) *
false

+ 0
;

0 1
public 
DateTime 
	CreatedAt !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
DateTime2 :
.: ;
UtcNow; A
;A B
} 
} √	
VD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Models\Department.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Models% +
{ 
public 

class 

Department 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
,		 
	MaxLength		 
(		 
$num		  
)		  !
]		! "
public

 
string

 
Name

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
=

) *
string

+ 1
.

1 2
Empty

2 7
;

7 8
public 
ICollection 
< 

Allocation %
>% &
Allocations' 2
{3 4
get5 8
;8 9
set: =
;= >
}? @
=A B
newC F
ListG K
<K L

AllocationL V
>V W
(W X
)X Y
;Y Z
} 
} ∏
ZD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Models\BudgetCategory.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Models% +
{ 
public 

class 
BudgetCategory 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
,		 
	MaxLength		 
(		 
$num		  
)		  !
]		! "
public

 
string

 
Name

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
=

) *
string

+ 1
.

1 2
Empty

2 7
;

7 8
[ 	
Range	 
( 
$num 
, 
double 
. 
MaxValue !
)! "
]" #
public 
decimal 
Limit 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	
Required	 
, 
	MaxLength 
( 
$num 
)  
]  !
public 
string 
	Timeframe 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
$str0 9
;9 :
[ 	
Range	 
( 
$num 
, 
$num 
) 
] 
public 
int 
ThresholdPercent #
{$ %
get& )
;) *
set+ .
;. /
}0 1
=2 3
$num4 6
;6 7
public 
ICollection 
< 

Allocation %
>% &
Allocations' 2
{3 4
get5 8
;8 9
set: =
;= >
}? @
=A B
newC F
ListG K
<K L

AllocationL V
>V W
(W X
)X Y
;Y Z
} 
} ”

TD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Models\AuditLog.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Models% +
{ 
public 

class 
AuditLog 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
DateTime 
	Timestamp !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
DateTime2 :
.: ;
UtcNow; A
;A B
public 
int 
? 
UserId 
{ 
get  
;  !
set" %
;% &
}' (
public		 
string		 
Action		 
{		 
get		 "
;		" #
set		$ '
;		' (
}		) *
=		+ ,
string		- 3
.		3 4
Empty		4 9
;		9 :
public

 
string

 
Details

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
=

, -
string

. 4
.

4 5
Empty

5 :
;

: ;
} 
} â
VD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Models\Allocation.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Models% +
{ 
public 

class 

Allocation 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
]		 
public

 
int

 
DepartmentId

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
public 

Department 

Department $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
null5 9
!9 :
;: ;
[ 	
Required	 
] 
public 
int 

CategoryId 
{ 
get  #
;# $
set% (
;( )
}* +
public 
BudgetCategory 
Category &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
=5 6
null7 ;
!; <
;< =
[ 	
Range	 
( 
$num 
, 
double 
. 
MaxValue !
)! "
]" #
public 
decimal 
Amount 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
Range	 
( 
$num 
, 
double 
. 
MaxValue !
)! "
]" #
public 
decimal 
Spent 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
$num- .
;. /
public 
DateTime 
	CreatedAt !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
DateTime2 :
.: ;
UtcNow; A
;A B
public 
string 
	Timeframe 
=>  "
Category# +
.+ ,
	Timeframe, 5
;5 6
} 
} é
]D:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Models\AdjustmentRequest.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Models% +
{ 
public 

class 
AdjustmentRequest "
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[

 	
Required

	 
]

 
public 
int 
DepartmentId 
{  !
get" %
;% &
set' *
;* +
}, -
public 

Department 

Department $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
null5 9
!9 :
;: ;
[ 	
Required	 
] 
public 
int 

CategoryId 
{ 
get  #
;# $
set% (
;( )
}* +
public 
BudgetCategory 
Category &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
=5 6
null7 ;
!; <
;< =
[ 	
Required	 
, 
	MaxLength 
( 
$num  
)  !
]! "
public 
string 
Reason 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
string- 3
.3 4
Empty4 9
;9 :
[ 	
Range	 
( 
$num 
, 
double 
. 
MaxValue !
)! "
]" #
public 
decimal 
Amount 
{ 
get  #
;# $
set% (
;( )
}* +
public 
RequestStatus 
Status #
{$ %
get& )
;) *
set+ .
;. /
}0 1
=2 3
RequestStatus4 A
.A B
PendingB I
;I J
public 
string 
? 
ReviewerNote #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
DateTime 
	CreatedAt !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
DateTime2 :
.: ;
UtcNow; A
;A B
public 
DateTime 
? 

ReviewedAt #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
int 
? 
ReviewedByUserId $
{% &
get' *
;* +
set, /
;/ 0
}1 2
} 
}   ÛÈ
gD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Migrations\20250916042615_firstmig.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %

Migrations% /
{ 
public

 

partial

 
class

 
firstmig

 !
:

" #
	Migration

$ -
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
AlterDatabase *
(* +
)+ ,
. 

Annotation 
( 
$str +
,+ ,
$str- 6
)6 7
;7 8
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str !
,! "
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ C
,C D(
MySqlValueGenerationStrategyE a
.a b
IdentityColumnb p
)p q
,q r
	Timestamp 
= 
table  %
.% &
Column& ,
<, -
DateTime- 5
>5 6
(6 7
type7 ;
:; <
$str= J
,J K
nullableL T
:T U
falseV [
)[ \
,\ ]
UserId 
= 
table "
." #
Column# )
<) *
int* -
>- .
(. /
type/ 3
:3 4
$str5 :
,: ;
nullable< D
:D E
trueF J
)J K
,K L
Action 
= 
table "
." #
Column# )
<) *
string* 0
>0 1
(1 2
type2 6
:6 7
$str8 B
,B C
nullableD L
:L M
falseN S
)S T
. 

Annotation #
(# $
$str$ 3
,3 4
$str5 >
)> ?
,? @
Details 
= 
table #
.# $
Column$ *
<* +
string+ 1
>1 2
(2 3
type3 7
:7 8
$str9 C
,C D
nullableE M
:M N
falseO T
)T U
. 

Annotation #
(# $
$str$ 3
,3 4
$str5 >
)> ?
} 
, 
constraints 
: 
table "
=># %
{   
table!! 
.!! 

PrimaryKey!! $
(!!$ %
$str!!% 3
,!!3 4
x!!5 6
=>!!7 9
x!!: ;
.!!; <
Id!!< >
)!!> ?
;!!? @
}"" 
)"" 
.## 

Annotation## 
(## 
$str## +
,##+ ,
$str##- 6
)##6 7
;##7 8
migrationBuilder%% 
.%% 
CreateTable%% (
(%%( )
name&& 
:&& 
$str&& (
,&&( )
columns'' 
:'' 
table'' 
=>'' !
new''" %
{(( 
Id)) 
=)) 
table)) 
.)) 
Column)) %
<))% &
int))& )
>))) *
())* +
type))+ /
:))/ 0
$str))1 6
,))6 7
nullable))8 @
:))@ A
false))B G
)))G H
.** 

Annotation** #
(**# $
$str**$ C
,**C D(
MySqlValueGenerationStrategy**E a
.**a b
IdentityColumn**b p
)**p q
,**q r
Name++ 
=++ 
table++  
.++  !
Column++! '
<++' (
string++( .
>++. /
(++/ 0
type++0 4
:++4 5
$str++6 D
,++D E
	maxLength++F O
:++O P
$num++Q T
,++T U
nullable++V ^
:++^ _
false++` e
)++e f
.,, 

Annotation,, #
(,,# $
$str,,$ 3
,,,3 4
$str,,5 >
),,> ?
,,,? @
Limit-- 
=-- 
table-- !
.--! "
Column--" (
<--( )
decimal--) 0
>--0 1
(--1 2
type--2 6
:--6 7
$str--8 H
,--H I
nullable--J R
:--R S
false--T Y
)--Y Z
,--Z [
	Timeframe.. 
=.. 
table..  %
...% &
Column..& ,
<.., -
string..- 3
>..3 4
(..4 5
type..5 9
:..9 :
$str..; H
,..H I
	maxLength..J S
:..S T
$num..U W
,..W X
nullable..Y a
:..a b
false..c h
)..h i
.// 

Annotation// #
(//# $
$str//$ 3
,//3 4
$str//5 >
)//> ?
,//? @
ThresholdPercent00 $
=00% &
table00' ,
.00, -
Column00- 3
<003 4
int004 7
>007 8
(008 9
type009 =
:00= >
$str00? D
,00D E
nullable00F N
:00N O
false00P U
)00U V
}11 
,11 
constraints22 
:22 
table22 "
=>22# %
{33 
table44 
.44 

PrimaryKey44 $
(44$ %
$str44% :
,44: ;
x44< =
=>44> @
x44A B
.44B C
Id44C E
)44E F
;44F G
}55 
)55 
.66 

Annotation66 
(66 
$str66 +
,66+ ,
$str66- 6
)666 7
;667 8
migrationBuilder88 
.88 
CreateTable88 (
(88( )
name99 
:99 
$str99 #
,99# $
columns:: 
::: 
table:: 
=>:: !
new::" %
{;; 
Id<< 
=<< 
table<< 
.<< 
Column<< %
<<<% &
int<<& )
><<) *
(<<* +
type<<+ /
:<</ 0
$str<<1 6
,<<6 7
nullable<<8 @
:<<@ A
false<<B G
)<<G H
.== 

Annotation== #
(==# $
$str==$ C
,==C D(
MySqlValueGenerationStrategy==E a
.==a b
IdentityColumn==b p
)==p q
,==q r
Name>> 
=>> 
table>>  
.>>  !
Column>>! '
<>>' (
string>>( .
>>>. /
(>>/ 0
type>>0 4
:>>4 5
$str>>6 D
,>>D E
	maxLength>>F O
:>>O P
$num>>Q T
,>>T U
nullable>>V ^
:>>^ _
false>>` e
)>>e f
.?? 

Annotation?? #
(??# $
$str??$ 3
,??3 4
$str??5 >
)??> ?
}@@ 
,@@ 
constraintsAA 
:AA 
tableAA "
=>AA# %
{BB 
tableCC 
.CC 

PrimaryKeyCC $
(CC$ %
$strCC% 5
,CC5 6
xCC7 8
=>CC9 ;
xCC< =
.CC= >
IdCC> @
)CC@ A
;CCA B
}DD 
)DD 
.EE 

AnnotationEE 
(EE 
$strEE +
,EE+ ,
$strEE- 6
)EE6 7
;EE7 8
migrationBuilderGG 
.GG 
CreateTableGG (
(GG( )
nameHH 
:HH 
$strHH %
,HH% &
columnsII 
:II 
tableII 
=>II !
newII" %
{JJ 
IdKK 
=KK 
tableKK 
.KK 
ColumnKK %
<KK% &
intKK& )
>KK) *
(KK* +
typeKK+ /
:KK/ 0
$strKK1 6
,KK6 7
nullableKK8 @
:KK@ A
falseKKB G
)KKG H
.LL 

AnnotationLL #
(LL# $
$strLL$ C
,LLC D(
MySqlValueGenerationStrategyLLE a
.LLa b
IdentityColumnLLb p
)LLp q
,LLq r
UserIdMM 
=MM 
tableMM "
.MM" #
ColumnMM# )
<MM) *
intMM* -
>MM- .
(MM. /
typeMM/ 3
:MM3 4
$strMM5 :
,MM: ;
nullableMM< D
:MMD E
trueMMF J
)MMJ K
,MMK L

TargetRoleNN 
=NN  
tableNN! &
.NN& '
ColumnNN' -
<NN- .
stringNN. 4
>NN4 5
(NN5 6
typeNN6 :
:NN: ;
$strNN< F
,NNF G
nullableNNH P
:NNP Q
falseNNR W
)NNW X
.OO 

AnnotationOO #
(OO# $
$strOO$ 3
,OO3 4
$strOO5 >
)OO> ?
,OO? @
TitlePP 
=PP 
tablePP !
.PP! "
ColumnPP" (
<PP( )
stringPP) /
>PP/ 0
(PP0 1
typePP1 5
:PP5 6
$strPP7 A
,PPA B
nullablePPC K
:PPK L
falsePPM R
)PPR S
.QQ 

AnnotationQQ #
(QQ# $
$strQQ$ 3
,QQ3 4
$strQQ5 >
)QQ> ?
,QQ? @
MessageRR 
=RR 
tableRR #
.RR# $
ColumnRR$ *
<RR* +
stringRR+ 1
>RR1 2
(RR2 3
typeRR3 7
:RR7 8
$strRR9 C
,RRC D
nullableRRE M
:RRM N
falseRRO T
)RRT U
.SS 

AnnotationSS #
(SS# $
$strSS$ 3
,SS3 4
$strSS5 >
)SS> ?
,SS? @
IsReadTT 
=TT 
tableTT "
.TT" #
ColumnTT# )
<TT) *
boolTT* .
>TT. /
(TT/ 0
typeTT0 4
:TT4 5
$strTT6 >
,TT> ?
nullableTT@ H
:TTH I
falseTTJ O
)TTO P
,TTP Q
	CreatedAtUU 
=UU 
tableUU  %
.UU% &
ColumnUU& ,
<UU, -
DateTimeUU- 5
>UU5 6
(UU6 7
typeUU7 ;
:UU; <
$strUU= J
,UUJ K
nullableUUL T
:UUT U
falseUUV [
)UU[ \
}VV 
,VV 
constraintsWW 
:WW 
tableWW "
=>WW# %
{XX 
tableYY 
.YY 

PrimaryKeyYY $
(YY$ %
$strYY% 7
,YY7 8
xYY9 :
=>YY; =
xYY> ?
.YY? @
IdYY@ B
)YYB C
;YYC D
}ZZ 
)ZZ 
.[[ 

Annotation[[ 
([[ 
$str[[ +
,[[+ ,
$str[[- 6
)[[6 7
;[[7 8
migrationBuilder]] 
.]] 
CreateTable]] (
(]]( )
name^^ 
:^^ 
$str^^ *
,^^* +
columns__ 
:__ 
table__ 
=>__ !
new__" %
{`` 
Idaa 
=aa 
tableaa 
.aa 
Columnaa %
<aa% &
intaa& )
>aa) *
(aa* +
typeaa+ /
:aa/ 0
$straa1 6
,aa6 7
nullableaa8 @
:aa@ A
falseaaB G
)aaG H
.bb 

Annotationbb #
(bb# $
$strbb$ C
,bbC D(
MySqlValueGenerationStrategybbE a
.bba b
IdentityColumnbbb p
)bbp q
,bbq r
DepartmentIdcc  
=cc! "
tablecc# (
.cc( )
Columncc) /
<cc/ 0
intcc0 3
>cc3 4
(cc4 5
typecc5 9
:cc9 :
$strcc; @
,cc@ A
nullableccB J
:ccJ K
falseccL Q
)ccQ R
,ccR S

CategoryIddd 
=dd  
tabledd! &
.dd& '
Columndd' -
<dd- .
intdd. 1
>dd1 2
(dd2 3
typedd3 7
:dd7 8
$strdd9 >
,dd> ?
nullabledd@ H
:ddH I
falseddJ O
)ddO P
,ddP Q
Reasonee 
=ee 
tableee "
.ee" #
Columnee# )
<ee) *
stringee* 0
>ee0 1
(ee1 2
typeee2 6
:ee6 7
$stree8 F
,eeF G
	maxLengtheeH Q
:eeQ R
$numeeS V
,eeV W
nullableeeX `
:ee` a
falseeeb g
)eeg h
.ff 

Annotationff #
(ff# $
$strff$ 3
,ff3 4
$strff5 >
)ff> ?
,ff? @
Amountgg 
=gg 
tablegg "
.gg" #
Columngg# )
<gg) *
decimalgg* 1
>gg1 2
(gg2 3
typegg3 7
:gg7 8
$strgg9 I
,ggI J
nullableggK S
:ggS T
falseggU Z
)ggZ [
,gg[ \
Statushh 
=hh 
tablehh "
.hh" #
Columnhh# )
<hh) *
inthh* -
>hh- .
(hh. /
typehh/ 3
:hh3 4
$strhh5 :
,hh: ;
nullablehh< D
:hhD E
falsehhF K
)hhK L
,hhL M
ReviewerNoteii  
=ii! "
tableii# (
.ii( )
Columnii) /
<ii/ 0
stringii0 6
>ii6 7
(ii7 8
typeii8 <
:ii< =
$strii> H
,iiH I
nullableiiJ R
:iiR S
trueiiT X
)iiX Y
.jj 

Annotationjj #
(jj# $
$strjj$ 3
,jj3 4
$strjj5 >
)jj> ?
,jj? @
	CreatedAtkk 
=kk 
tablekk  %
.kk% &
Columnkk& ,
<kk, -
DateTimekk- 5
>kk5 6
(kk6 7
typekk7 ;
:kk; <
$strkk= J
,kkJ K
nullablekkL T
:kkT U
falsekkV [
)kk[ \
,kk\ ]

ReviewedAtll 
=ll  
tablell! &
.ll& '
Columnll' -
<ll- .
DateTimell. 6
>ll6 7
(ll7 8
typell8 <
:ll< =
$strll> K
,llK L
nullablellM U
:llU V
truellW [
)ll[ \
,ll\ ]
ReviewedByUserIdmm $
=mm% &
tablemm' ,
.mm, -
Columnmm- 3
<mm3 4
intmm4 7
>mm7 8
(mm8 9
typemm9 =
:mm= >
$strmm? D
,mmD E
nullablemmF N
:mmN O
truemmP T
)mmT U
}nn 
,nn 
constraintsoo 
:oo 
tableoo "
=>oo# %
{pp 
tableqq 
.qq 

PrimaryKeyqq $
(qq$ %
$strqq% <
,qq< =
xqq> ?
=>qq@ B
xqqC D
.qqD E
IdqqE G
)qqG H
;qqH I
tablerr 
.rr 

ForeignKeyrr $
(rr$ %
namess 
:ss 
$strss Q
,ssQ R
columntt 
:tt 
xtt  !
=>tt" $
xtt% &
.tt& '

CategoryIdtt' 1
,tt1 2
principalTableuu &
:uu& '
$struu( :
,uu: ;
principalColumnvv '
:vv' (
$strvv) -
,vv- .
onDeleteww  
:ww  !
ReferentialActionww" 3
.ww3 4
Cascadeww4 ;
)ww; <
;ww< =
tablexx 
.xx 

ForeignKeyxx $
(xx$ %
nameyy 
:yy 
$stryy N
,yyN O
columnzz 
:zz 
xzz  !
=>zz" $
xzz% &
.zz& '
DepartmentIdzz' 3
,zz3 4
principalTable{{ &
:{{& '
$str{{( 5
,{{5 6
principalColumn|| '
:||' (
$str||) -
,||- .
onDelete}}  
:}}  !
ReferentialAction}}" 3
.}}3 4
Cascade}}4 ;
)}}; <
;}}< =
}~~ 
)~~ 
. 

Annotation 
( 
$str +
,+ ,
$str- 6
)6 7
;7 8
migrationBuilder
ÅÅ 
.
ÅÅ 
CreateTable
ÅÅ (
(
ÅÅ( )
name
ÇÇ 
:
ÇÇ 
$str
ÇÇ #
,
ÇÇ# $
columns
ÉÉ 
:
ÉÉ 
table
ÉÉ 
=>
ÉÉ !
new
ÉÉ" %
{
ÑÑ 
Id
ÖÖ 
=
ÖÖ 
table
ÖÖ 
.
ÖÖ 
Column
ÖÖ %
<
ÖÖ% &
int
ÖÖ& )
>
ÖÖ) *
(
ÖÖ* +
type
ÖÖ+ /
:
ÖÖ/ 0
$str
ÖÖ1 6
,
ÖÖ6 7
nullable
ÖÖ8 @
:
ÖÖ@ A
false
ÖÖB G
)
ÖÖG H
.
ÜÜ 

Annotation
ÜÜ #
(
ÜÜ# $
$str
ÜÜ$ C
,
ÜÜC D*
MySqlValueGenerationStrategy
ÜÜE a
.
ÜÜa b
IdentityColumn
ÜÜb p
)
ÜÜp q
,
ÜÜq r
DepartmentId
áá  
=
áá! "
table
áá# (
.
áá( )
Column
áá) /
<
áá/ 0
int
áá0 3
>
áá3 4
(
áá4 5
type
áá5 9
:
áá9 :
$str
áá; @
,
áá@ A
nullable
ááB J
:
ááJ K
false
ááL Q
)
ááQ R
,
ááR S

CategoryId
àà 
=
àà  
table
àà! &
.
àà& '
Column
àà' -
<
àà- .
int
àà. 1
>
àà1 2
(
àà2 3
type
àà3 7
:
àà7 8
$str
àà9 >
,
àà> ?
nullable
àà@ H
:
ààH I
false
ààJ O
)
ààO P
,
ààP Q
Amount
ââ 
=
ââ 
table
ââ "
.
ââ" #
Column
ââ# )
<
ââ) *
decimal
ââ* 1
>
ââ1 2
(
ââ2 3
type
ââ3 7
:
ââ7 8
$str
ââ9 I
,
ââI J
nullable
ââK S
:
ââS T
false
ââU Z
)
ââZ [
,
ââ[ \
Spent
ää 
=
ää 
table
ää !
.
ää! "
Column
ää" (
<
ää( )
decimal
ää) 0
>
ää0 1
(
ää1 2
type
ää2 6
:
ää6 7
$str
ää8 H
,
ääH I
nullable
ääJ R
:
ääR S
false
ääT Y
)
ääY Z
,
ääZ [
	CreatedAt
ãã 
=
ãã 
table
ãã  %
.
ãã% &
Column
ãã& ,
<
ãã, -
DateTime
ãã- 5
>
ãã5 6
(
ãã6 7
type
ãã7 ;
:
ãã; <
$str
ãã= J
,
ããJ K
nullable
ããL T
:
ããT U
false
ããV [
)
ãã[ \
}
åå 
,
åå 
constraints
çç 
:
çç 
table
çç "
=>
çç# %
{
éé 
table
èè 
.
èè 

PrimaryKey
èè $
(
èè$ %
$str
èè% 5
,
èè5 6
x
èè7 8
=>
èè9 ;
x
èè< =
.
èè= >
Id
èè> @
)
èè@ A
;
èèA B
table
êê 
.
êê 

ForeignKey
êê $
(
êê$ %
name
ëë 
:
ëë 
$str
ëë J
,
ëëJ K
column
íí 
:
íí 
x
íí  !
=>
íí" $
x
íí% &
.
íí& '

CategoryId
íí' 1
,
íí1 2
principalTable
ìì &
:
ìì& '
$str
ìì( :
,
ìì: ;
principalColumn
îî '
:
îî' (
$str
îî) -
,
îî- .
onDelete
ïï  
:
ïï  !
ReferentialAction
ïï" 3
.
ïï3 4
Restrict
ïï4 <
)
ïï< =
;
ïï= >
table
ññ 
.
ññ 

ForeignKey
ññ $
(
ññ$ %
name
óó 
:
óó 
$str
óó G
,
óóG H
column
òò 
:
òò 
x
òò  !
=>
òò" $
x
òò% &
.
òò& '
DepartmentId
òò' 3
,
òò3 4
principalTable
ôô &
:
ôô& '
$str
ôô( 5
,
ôô5 6
principalColumn
öö '
:
öö' (
$str
öö) -
,
öö- .
onDelete
õõ  
:
õõ  !
ReferentialAction
õõ" 3
.
õõ3 4
Cascade
õõ4 ;
)
õõ; <
;
õõ< =
}
úú 
)
úú 
.
ùù 

Annotation
ùù 
(
ùù 
$str
ùù +
,
ùù+ ,
$str
ùù- 6
)
ùù6 7
;
ùù7 8
migrationBuilder
üü 
.
üü 
CreateTable
üü (
(
üü( )
name
†† 
:
†† 
$str
†† 
,
†† 
columns
°° 
:
°° 
table
°° 
=>
°° !
new
°°" %
{
¢¢ 
Id
££ 
=
££ 
table
££ 
.
££ 
Column
££ %
<
££% &
int
££& )
>
££) *
(
££* +
type
££+ /
:
££/ 0
$str
££1 6
,
££6 7
nullable
££8 @
:
££@ A
false
££B G
)
££G H
.
§§ 

Annotation
§§ #
(
§§# $
$str
§§$ C
,
§§C D*
MySqlValueGenerationStrategy
§§E a
.
§§a b
IdentityColumn
§§b p
)
§§p q
,
§§q r
Name
•• 
=
•• 
table
••  
.
••  !
Column
••! '
<
••' (
string
••( .
>
••. /
(
••/ 0
type
••0 4
:
••4 5
$str
••6 D
,
••D E
	maxLength
••F O
:
••O P
$num
••Q T
,
••T U
nullable
••V ^
:
••^ _
false
••` e
)
••e f
.
¶¶ 

Annotation
¶¶ #
(
¶¶# $
$str
¶¶$ 3
,
¶¶3 4
$str
¶¶5 >
)
¶¶> ?
,
¶¶? @
Email
ßß 
=
ßß 
table
ßß !
.
ßß! "
Column
ßß" (
<
ßß( )
string
ßß) /
>
ßß/ 0
(
ßß0 1
type
ßß1 5
:
ßß5 6
$str
ßß7 E
,
ßßE F
	maxLength
ßßG P
:
ßßP Q
$num
ßßR U
,
ßßU V
nullable
ßßW _
:
ßß_ `
false
ßßa f
)
ßßf g
.
®® 

Annotation
®® #
(
®®# $
$str
®®$ 3
,
®®3 4
$str
®®5 >
)
®®> ?
,
®®? @
PasswordHash
©©  
=
©©! "
table
©©# (
.
©©( )
Column
©©) /
<
©©/ 0
string
©©0 6
>
©©6 7
(
©©7 8
type
©©8 <
:
©©< =
$str
©©> H
,
©©H I
nullable
©©J R
:
©©R S
false
©©T Y
)
©©Y Z
.
™™ 

Annotation
™™ #
(
™™# $
$str
™™$ 3
,
™™3 4
$str
™™5 >
)
™™> ?
,
™™? @
Role
´´ 
=
´´ 
table
´´  
.
´´  !
Column
´´! '
<
´´' (
int
´´( +
>
´´+ ,
(
´´, -
type
´´- 1
:
´´1 2
$str
´´3 8
,
´´8 9
nullable
´´: B
:
´´B C
false
´´D I
)
´´I J
,
´´J K
DepartmentId
¨¨  
=
¨¨! "
table
¨¨# (
.
¨¨( )
Column
¨¨) /
<
¨¨/ 0
int
¨¨0 3
>
¨¨3 4
(
¨¨4 5
type
¨¨5 9
:
¨¨9 :
$str
¨¨; @
,
¨¨@ A
nullable
¨¨B J
:
¨¨J K
true
¨¨L P
)
¨¨P Q
}
≠≠ 
,
≠≠ 
constraints
ÆÆ 
:
ÆÆ 
table
ÆÆ "
=>
ÆÆ# %
{
ØØ 
table
∞∞ 
.
∞∞ 

PrimaryKey
∞∞ $
(
∞∞$ %
$str
∞∞% /
,
∞∞/ 0
x
∞∞1 2
=>
∞∞3 5
x
∞∞6 7
.
∞∞7 8
Id
∞∞8 :
)
∞∞: ;
;
∞∞; <
table
±± 
.
±± 

ForeignKey
±± $
(
±±$ %
name
≤≤ 
:
≤≤ 
$str
≤≤ A
,
≤≤A B
column
≥≥ 
:
≥≥ 
x
≥≥  !
=>
≥≥" $
x
≥≥% &
.
≥≥& '
DepartmentId
≥≥' 3
,
≥≥3 4
principalTable
¥¥ &
:
¥¥& '
$str
¥¥( 5
,
¥¥5 6
principalColumn
µµ '
:
µµ' (
$str
µµ) -
)
µµ- .
;
µµ. /
}
∂∂ 
)
∂∂ 
.
∑∑ 

Annotation
∑∑ 
(
∑∑ 
$str
∑∑ +
,
∑∑+ ,
$str
∑∑- 6
)
∑∑6 7
;
∑∑7 8
migrationBuilder
ππ 
.
ππ 
CreateIndex
ππ (
(
ππ( )
name
∫∫ 
:
∫∫ 
$str
∫∫ 8
,
∫∫8 9
table
ªª 
:
ªª 
$str
ªª +
,
ªª+ ,
column
ºº 
:
ºº 
$str
ºº $
)
ºº$ %
;
ºº% &
migrationBuilder
ææ 
.
ææ 
CreateIndex
ææ (
(
ææ( )
name
øø 
:
øø 
$str
øø :
,
øø: ;
table
¿¿ 
:
¿¿ 
$str
¿¿ +
,
¿¿+ ,
column
¡¡ 
:
¡¡ 
$str
¡¡ &
)
¡¡& '
;
¡¡' (
migrationBuilder
√√ 
.
√√ 
CreateIndex
√√ (
(
√√( )
name
ƒƒ 
:
ƒƒ 
$str
ƒƒ 1
,
ƒƒ1 2
table
≈≈ 
:
≈≈ 
$str
≈≈ $
,
≈≈$ %
column
∆∆ 
:
∆∆ 
$str
∆∆ $
)
∆∆$ %
;
∆∆% &
migrationBuilder
»» 
.
»» 
CreateIndex
»» (
(
»»( )
name
…… 
:
…… 
$str
…… 3
,
……3 4
table
   
:
   
$str
   $
,
  $ %
column
ÀÀ 
:
ÀÀ 
$str
ÀÀ &
)
ÀÀ& '
;
ÀÀ' (
migrationBuilder
ÕÕ 
.
ÕÕ 
CreateIndex
ÕÕ (
(
ÕÕ( )
name
ŒŒ 
:
ŒŒ 
$str
ŒŒ :
,
ŒŒ: ;
table
œœ 
:
œœ 
$str
œœ )
,
œœ) *
columns
–– 
:
–– 
new
–– 
[
–– 
]
–– 
{
––  
$str
––! '
,
––' (
$str
––) 4
}
––5 6
,
––6 7
unique
—— 
:
—— 
true
—— 
)
—— 
;
—— 
migrationBuilder
”” 
.
”” 
CreateIndex
”” (
(
””( )
name
‘‘ 
:
‘‘ 
$str
‘‘ +
,
‘‘+ ,
table
’’ 
:
’’ 
$str
’’ $
,
’’$ %
column
÷÷ 
:
÷÷ 
$str
÷÷ 
,
÷÷ 
unique
◊◊ 
:
◊◊ 
true
◊◊ 
)
◊◊ 
;
◊◊ 
migrationBuilder
ŸŸ 
.
ŸŸ 
CreateIndex
ŸŸ (
(
ŸŸ( )
name
⁄⁄ 
:
⁄⁄ 
$str
⁄⁄ -
,
⁄⁄- .
table
€€ 
:
€€ 
$str
€€ 
,
€€ 
column
‹‹ 
:
‹‹ 
$str
‹‹ &
)
‹‹& '
;
‹‹' (
migrationBuilder
ﬁﬁ 
.
ﬁﬁ 
CreateIndex
ﬁﬁ (
(
ﬁﬁ( )
name
ﬂﬂ 
:
ﬂﬂ 
$str
ﬂﬂ &
,
ﬂﬂ& '
table
‡‡ 
:
‡‡ 
$str
‡‡ 
,
‡‡ 
column
·· 
:
·· 
$str
·· 
,
··  
unique
‚‚ 
:
‚‚ 
true
‚‚ 
)
‚‚ 
;
‚‚ 
}
„„ 	
	protected
ÊÊ 
override
ÊÊ 
void
ÊÊ 
Down
ÊÊ  $
(
ÊÊ$ %
MigrationBuilder
ÊÊ% 5
migrationBuilder
ÊÊ6 F
)
ÊÊF G
{
ÁÁ 	
migrationBuilder
ËË 
.
ËË 
	DropTable
ËË &
(
ËË& '
name
ÈÈ 
:
ÈÈ 
$str
ÈÈ *
)
ÈÈ* +
;
ÈÈ+ ,
migrationBuilder
ÎÎ 
.
ÎÎ 
	DropTable
ÎÎ &
(
ÎÎ& '
name
ÏÏ 
:
ÏÏ 
$str
ÏÏ #
)
ÏÏ# $
;
ÏÏ$ %
migrationBuilder
ÓÓ 
.
ÓÓ 
	DropTable
ÓÓ &
(
ÓÓ& '
name
ÔÔ 
:
ÔÔ 
$str
ÔÔ !
)
ÔÔ! "
;
ÔÔ" #
migrationBuilder
ÒÒ 
.
ÒÒ 
	DropTable
ÒÒ &
(
ÒÒ& '
name
ÚÚ 
:
ÚÚ 
$str
ÚÚ %
)
ÚÚ% &
;
ÚÚ& '
migrationBuilder
ÙÙ 
.
ÙÙ 
	DropTable
ÙÙ &
(
ÙÙ& '
name
ıı 
:
ıı 
$str
ıı 
)
ıı 
;
ıı 
migrationBuilder
˜˜ 
.
˜˜ 
	DropTable
˜˜ &
(
˜˜& '
name
¯¯ 
:
¯¯ 
$str
¯¯ (
)
¯¯( )
;
¯¯) *
migrationBuilder
˙˙ 
.
˙˙ 
	DropTable
˙˙ &
(
˙˙& '
name
˚˚ 
:
˚˚ 
$str
˚˚ #
)
˚˚# $
;
˚˚$ %
}
¸¸ 	
}
˝˝ 
}˛˛ Ë
gD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Middleware\ErrorHandlingMiddleware.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %

Middleware% /
{ 
public 

class #
ErrorHandlingMiddleware (
{ 
private		 
readonly		 
RequestDelegate		 (
_next		) .
;		. /
private

 
readonly

 
ILogger

  
<

  !#
ErrorHandlingMiddleware

! 8
>

8 9
_logger

: A
;

A B
public #
ErrorHandlingMiddleware &
(& '
RequestDelegate' 6
next7 ;
,; <
ILogger= D
<D E#
ErrorHandlingMiddlewareE \
>\ ]
logger^ d
)d e
{ 	
_next 
= 
next 
; 
_logger 
= 
logger 
; 
} 	
public 
async 
Task 
Invoke  
(  !
HttpContext! ,
context- 4
)4 5
{ 	
try 
{ 
await 
_next 
( 
context #
)# $
;$ %
} 
catch 
( 
	Exception 
ex 
)  
{ 
_logger 
. 
LogError  
(  !
ex! #
,# $
$str% :
): ;
;; <
context 
. 
Response  
.  !

StatusCode! +
=, -
(. /
int/ 2
)2 3
HttpStatusCode3 A
.A B

BadRequestB L
;L M
context 
. 
Response  
.  !
ContentType! ,
=- .
$str/ A
;A B
var 
resp 
= 
ApiResponse &
<& '
object' -
>- .
.. /
Fail/ 3
(3 4
$str4 G
,G H
newI L
{M N
exO Q
.Q R
MessageR Y
}Z [
)[ \
;\ ]
await 
context 
. 
Response &
.& '

WriteAsync' 1
(1 2
JsonSerializer2 @
.@ A
	SerializeA J
(J K
respK O
)O P
)P Q
;Q R
} 
}   	
}!! 
}"" Ö
\D:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Interfaces\IUserService.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %

Interfaces% /
{ 
public 

	interface 
IUserService !
{ 
Task 
< 
IEnumerable 
< 
UserResponseDto (
>( )
>) *
GetAllAsync+ 6
(6 7
)7 8
;8 9
Task 
< 
UserResponseDto 
? 
> 
GetByIdAsync +
(+ ,
int, /
id0 2
)2 3
;3 4
Task		 
<		 
UserResponseDto		 
>		 
CreateAsync		 )
(		) *
UserCreateDto		* 7
dto		8 ;
,		; <
int		= @
createdByUserId		A P
)		P Q
;		Q R
Task

 
<

 
UserResponseDto

 
>

 
UpdateAsync

 )
(

) *
UserUpdateDto

* 7
dto

8 ;
,

; <
int

= @
updatedByUserId

A P
)

P Q
;

Q R
Task 
DeleteAsync 
( 
int 
id 
,  
int! $
deletedByUserId% 4
)4 5
;5 6
Task 
< 
bool 
> 
ActivateUserAsync $
($ %
int% (
id) +
,+ ,
int- 0
activatedByUserId1 B
)B C
;C D
} 
} ‚

_D:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Interfaces\IRequestService.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %

Interfaces% /
{ 
public 

	interface 
IRequestService $
{ 
Task 
< (
AdjustmentRequestResponseDto )
>) *
CreateAsync+ 6
(6 7&
AdjustmentRequestCreateDto7 Q
dtoR U
,U V
intW Z
userId[ a
)a b
;b c
Task 
< (
AdjustmentRequestResponseDto )
>) *
ReviewAsync+ 6
(6 7
AdjustmentReviewDto7 J
dtoK N
,N O
intP S
reviewerUserIdT b
)b c
;c d
Task		 
<		 
IEnumerable		 
<		 (
AdjustmentRequestResponseDto		 5
>		5 6
>		6 7
GetPendingAsync		8 G
(		G H
)		H I
;		I J
Task

 
<

 
IEnumerable

 
<

 (
AdjustmentRequestResponseDto

 5
>

5 6
>

6 7 
GetByDepartmentAsync

8 L
(

L M
int

M P
departmentId

Q ]
)

] ^
;

^ _
} 
} π

dD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Interfaces\INotificationService.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %

Interfaces% /
{ 
public 

	interface  
INotificationService )
{ 
Task 
SendEmailAsync 
( 
string "
to# %
,% &
string' -
subject. 5
,5 6
string7 =
htmlBody> F
)F G
;G H
Task 
NotifyUserAsync 
( 
int  
userId! '
,' (
string) /
title0 5
,5 6
string7 =
message> E
)E F
;F G
Task 
NotifyRoleAsync 
( 
string #
role$ (
,( )
string* 0
title1 6
,6 7
string8 >
message? F
)F G
;G H
Task #
SendThresholdAlertAsync $
($ %
int% (
departmentId) 5
,5 6
int7 :

categoryId; E
,E F
stringG M
detailsN U
)U V
;V W
}		 
}

 ‘	
`D:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Interfaces\ICategoryService.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %

Interfaces% /
{ 
public 

	interface 
ICategoryService %
{ 
Task 
< 
CategoryResponseDto  
>  !
CreateAsync" -
(- .
CategoryCreateDto. ?
dto@ C
,C D
intE H
userIdI O
)O P
;P Q
Task 
< 
CategoryResponseDto  
>  !
UpdateAsync" -
(- .
CategoryUpdateDto. ?
dto@ C
,C D
intE H
userIdI O
)O P
;P Q
Task		 
DeleteAsync		 
(		 
int		 
id		 
,		  
int		! $
userId		% +
)		+ ,
;		, -
Task

 
<

 
IEnumerable

 
<

 
CategoryResponseDto

 ,
>

, -
>

- .
GetAllAsync

/ :
(

: ;
)

; <
;

< =
} 
} ö
\D:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Interfaces\IAuthService.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %

Interfaces% /
{ 
public 

	interface 
IAuthService !
{ 
Task 
< 
LoginResponse 
> 

LoginAsync &
(& '
LoginRequest' 3
request4 ;
); <
;< =
} 
}		 ˆ
bD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Interfaces\IAllocationService.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %

Interfaces% /
{ 
public 

	interface 
IAllocationService '
{ 
Task 
< !
AllocationResponseDto "
>" #
CreateAsync$ /
(/ 0
AllocationCreateDto0 C
dtoD G
,G H
intI L
userIdM S
)S T
;T U
Task 
< 
IEnumerable 
< !
AllocationResponseDto .
>. /
>/ 0 
GetByDepartmentAsync1 E
(E F
intF I
departmentIdJ V
)V W
;W X
Task		 
<		  
DepartmentSummaryDto		 !
>		! "%
GetDepartmentSummaryAsync		# <
(		< =
int		= @
departmentId		A M
)		M N
;		N O
Task

 
<

  
ManagementSummaryDto

 !
>

! "%
GetManagementSummaryAsync

# <
(

< =
int

= @
?

@ A

categoryId

B L
=

M N
null

O S
,

S T
int

U X
?

X Y
departmentId

Z f
=

g h
null

i m
)

m n
;

n o
Task 
UpdateSpentAsync 
( 
int !
allocationId" .
,. /
decimal0 7
newSpent8 @
,@ A
intB E
userIdF L
)L M
;M N
Task 
< !
AllocationResponseDto "
>" #
UpdateAsync$ /
(/ 0
int0 3
id4 6
,6 7
AllocationUpdateDto8 K
dtoL O
,O P
intQ T
userIdU [
)[ \
;\ ]
Task	 
DeleteAsync 
( 
int 
id  
,  !
int" %
userId& ,
), -
;- .
} 
} ∞
SD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Hubs\BudgetHub.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Hubs% )
{ 
[ 
	Authorize 
] 
public 

class 
	BudgetHub 
: 
Hub  
{ 
public		 
override		 
Task		 
OnConnectedAsync		 -
(		- .
)		. /
{

 	
return 
base 
. 
OnConnectedAsync (
(( )
)) *
;* +
} 	
} 
} ‚
[D:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Helpers\PasswordHasher.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Helpers% ,
{ 
public 

class 
PasswordHasher 
{ 
public 
string 
Hash 
( 
string !
password" *
)* +
{		 	
byte

 
[

 
]

 
salt

 
=

 !
RandomNumberGenerator

 /
.

/ 0
GetBytes

0 8
(

8 9
$num

9 ;
)

; <
;

< =
var 
hash 
= 
KeyDerivation $
.$ %
Pbkdf2% +
(+ ,
password, 4
,4 5
salt6 :
,: ;
KeyDerivationPrf< L
.L M

HMACSHA256M W
,W X
$numY _
,_ `
$numa c
)c d
;d e
return 
$" 
{ 
Convert 
. 
ToBase64String ,
(, -
salt- 1
)1 2
}2 3
$str3 4
{4 5
Convert5 <
.< =
ToBase64String= K
(K L
hashL P
)P Q
}Q R
"R S
;S T
} 	
public 
bool 
Verify 
( 
string !
password" *
,* +
string, 2
hash3 7
)7 8
{ 	
var 
parts 
= 
hash 
. 
Split "
(" #
$char# &
)& '
;' (
if 
( 
parts 
. 
Length 
!= 
$num  !
)! "
return# )
false* /
;/ 0
var 
salt 
= 
Convert 
. 
FromBase64String /
(/ 0
parts0 5
[5 6
$num6 7
]7 8
)8 9
;9 :
var 
expected 
= 
Convert "
." #
FromBase64String# 3
(3 4
parts4 9
[9 :
$num: ;
]; <
)< =
;= >
var 
actual 
= 
KeyDerivation &
.& '
Pbkdf2' -
(- .
password. 6
,6 7
salt8 <
,< =
KeyDerivationPrf> N
.N O

HMACSHA256O Y
,Y Z
$num[ a
,a b
$numc e
)e f
;f g
return #
CryptographicOperations *
.* +
FixedTimeEquals+ :
(: ;
actual; A
,A B
expectedC K
)K L
;L M
} 	
} 
} Í
XD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Helpers\ApiResponse.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Helpers% ,
{ 
public 

class 
ApiResponse 
< 
T 
> 
{ 
public 
bool 
Success 
{ 
get !
;! "
set# &
;& '
}( )
=* +
true, 0
;0 1
public 
string 
? 
Message 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
T 
? 
Data 
{ 
get 
; 
set !
;! "
}# $
public 
object 
? 
Errors 
{ 
get  #
;# $
set% (
;( )
}* +
public

 
static

 
ApiResponse

 !
<

! "
T

" #
>

# $
Ok

% '
(

' (
T

( )
data

* .
,

. /
string

0 6
?

6 7
message

8 ?
=

@ A
null

B F
)

F G
=>

H J
new 
( 
) 
{ 
Success 
= 
true "
," #
Data$ (
=) *
data+ /
,/ 0
Message1 8
=9 :
message; B
}C D
;D E
public 
static 
ApiResponse !
<! "
T" #
># $
Fail% )
() *
string* 0
message1 8
,8 9
object: @
?@ A
errorsB H
=I J
nullK O
)O P
=>Q S
new 
( 
) 
{ 
Success 
= 
false #
,# $
Message% ,
=- .
message/ 6
,6 7
Errors8 >
=? @
errorsA G
}H I
;I J
} 
} ì
SD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Enums\UserRole.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Enums% *
{ 
public 

enum 
UserRole 
{ 
FinanceAdmin 
= 
$num 
, 
DepartmentHead 
= 
$num 
, 

Management 
= 
$num 
} 
}		 ê
XD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Enums\RequestStatus.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Enums% *
{ 
public 

enum 
RequestStatus 
{ 
Pending 
= 
$num 
, 
Approved 
= 
$num 
, 
Rejected 
= 
$num 
} 
}		 «
WD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\DTOs\UserUpdateDto.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
DTOs% )
{ 
public 

class 
UserUpdateDto 
{ 
[ 	
Required	 
] 
public		 
int		 
Id		 
{		 
get		 
;		 
set		  
;		  !
}		" #
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
, 
MinimumLength (
=) *
$num+ ,
), -
]- .
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
[ 	
Required	 
] 
[ 	
EmailAddress	 
] 
[ 	
StringLength	 
( 
$num 
) 
] 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
[ 	
StringLength	 
( 
$num 
, 
MinimumLength (
=) *
$num+ ,
), -
]- .
public 
string 
? 
Password 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
Required	 
] 
[ 	
Range	 
( 
$num 
, 
$num 
, 
ErrorMessage !
=" #
$str$ l
)l m
]m n
public 
int 
Role 
{ 
get 
; 
set "
;" #
}$ %
public 
int 
? 
DepartmentId  
{! "
get# &
;& '
set( +
;+ ,
}- .
} 
} Ø
YD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\DTOs\UserResponseDto.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
DTOs% )
{ 
public 
class 
UserResponseDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public		 
int		 
Role		 
{		 
get		 
;		 
set		 "
;		" #
}		$ %
public

 
int

 
?

 
DepartmentId

  
{

! "
get

# &
;

& '
set

( +
;

+ ,
}

- .
public 
string 
? 
DepartmentName %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
} 
} ˘
WD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\DTOs\UserCreateDto.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
DTOs% )
{ 
public 	
class
 
UserCreateDto 
{ 
[ 	
Required	 
] 
[		 	
StringLength			 
(		 
$num		 
,		 
MinimumLength		 (
=		) *
$num		+ ,
)		, -
]		- .
public

 
string

 
Name

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
=

) *
string

+ 1
.

1 2
Empty

2 7
;

7 8
[ 	
Required	 
] 
[ 	
EmailAddress	 
] 
[ 	
StringLength	 
( 
$num 
) 
] 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
, 
MinimumLength (
=) *
$num+ ,
), -
]- .
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
[ 	
Required	 
] 
[ 	
Range	 
( 
$num 
, 
$num 
, 
ErrorMessage !
=" #
$str$ l
)l m
]m n
public 
int 
Role 
{ 
get 
; 
set "
;" #
}$ %
public 
int 
? 
DepartmentId  
{! "
get# &
;& '
set( +
;+ ,
}- .
} 
} ≈
UD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\DTOs\RequestDtos.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
DTOs% )
{ 
public 

class &
AdjustmentRequestCreateDto +
{ 
[ 	
Required	 
] 
public 
int 
DepartmentId *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
[		 	
Required			 
]		 
public		 
int		 

CategoryId		 (
{		) *
get		+ .
;		. /
set		0 3
;		3 4
}		5 6
[

 	
Required

	 
,

 
	MaxLength

 
(

 
$num

  
)

  !
]

! "
public

# )
string

* 0
Reason

1 7
{

8 9
get

: =
;

= >
set

? B
;

B C
}

D E
=

F G
string

H N
.

N O
Empty

O T
;

T U
[ 	
Range	 
( 
$num 
, 
double 
. 
MaxValue !
)! "
]" #
public$ *
decimal+ 2
Amount3 9
{: ;
get< ?
;? @
setA D
;D E
}F G
} 
public 

class 
AdjustmentReviewDto $
{ 
[ 	
Required	 
] 
public 
int 
	RequestId '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
[ 	
Required	 
] 
public 
bool 
Approve &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
string 
? 
ReviewerNote #
{$ %
get& )
;) *
set+ .
;. /
}0 1
} 
public 

class (
AdjustmentRequestResponseDto -
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
int 
DepartmentId 
{  !
get" %
;% &
set' *
;* +
}, -
public 
int 

CategoryId 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
Reason 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
string- 3
.3 4
Empty4 9
;9 :
public 
decimal 
Amount 
{ 
get  #
;# $
set% (
;( )
}* +
public 
RequestStatus 
Status #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
? 
ReviewerNote #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
DateTime 
	CreatedAt !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
DateTime 
? 

ReviewedAt #
{$ %
get& )
;) *
set+ .
;. /
}0 1
}   
}!! ım
XD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\DTOs\ManagementDtos.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
DTOs% )
{ 
public 

class "
ManagementDashboardDto '
{ 
public  
ManagementSummaryDto #
Summary$ +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
=: ;
new< ?
(? @
)@ A
;A B
public 
int  
PendingRequestsCount '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public		 
IEnumerable		 
<		 
RecentRequestDto		 +
>		+ ,
RecentRequests		- ;
{		< =
get		> A
;		A B
set		C F
;		F G
}		H I
=		J K
new		L O
List		P T
<		T U
RecentRequestDto		U e
>		e f
(		f g
)		g h
;		h i
public

 
IEnumerable

 
<

 
BudgetAlertDto

 )
>

) *
BudgetAlerts

+ 7
{

8 9
get

: =
;

= >
set

? B
;

B C
}

D E
=

F G
new

H K
List

L P
<

P Q
BudgetAlertDto

Q _
>

_ `
(

` a
)

a b
;

b c
public 
IEnumerable 
< 
UtilizationTrendDto .
>. /
UtilizationTrends0 A
{B C
getD G
;G H
setI L
;L M
}N O
=P Q
newR U
ListV Z
<Z [
UtilizationTrendDto[ n
>n o
(o p
)p q
;q r
public 
int 
TotalDepartments #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
int &
HighUtilizationDepartments -
{. /
get0 3
;3 4
set5 8
;8 9
}: ;
} 
public 

class 
RecentRequestDto !
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
DepartmentName $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
string5 ;
.; <
Empty< A
;A B
public 
string 
CategoryName "
{# $
get% (
;( )
set* -
;- .
}/ 0
=1 2
string3 9
.9 :
Empty: ?
;? @
public 
decimal 
Amount 
{ 
get  #
;# $
set% (
;( )
}* +
public 
RequestStatus 
Status #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
DateTime 
	CreatedAt !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
DateTime 
? 

ReviewedAt #
{$ %
get& )
;) *
set+ .
;. /
}0 1
} 
public 

class 
BudgetAlertDto 
{ 
public 
int 
DepartmentId 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
DepartmentName $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
string5 ;
.; <
Empty< A
;A B
public 
int 

CategoryId 
{ 
get  #
;# $
set% (
;( )
}* +
public   
string   
CategoryName   "
{  # $
get  % (
;  ( )
set  * -
;  - .
}  / 0
=  1 2
string  3 9
.  9 :
Empty  : ?
;  ? @
public!! 
decimal!! 
AllocatedAmount!! &
{!!' (
get!!) ,
;!!, -
set!!. 1
;!!1 2
}!!3 4
public"" 
decimal"" 
SpentAmount"" "
{""# $
get""% (
;""( )
set""* -
;""- .
}""/ 0
public## 
decimal## !
UtilizationPercentage## ,
{##- .
get##/ 2
;##2 3
set##4 7
;##7 8
}##9 :
public$$ 
int$$ 
ThresholdPercentage$$ &
{$$' (
get$$) ,
;$$, -
set$$. 1
;$$1 2
}$$3 4
public%% 
string%% 
	AlertType%% 
{%%  !
get%%" %
;%%% &
set%%' *
;%%* +
}%%, -
=%%. /
string%%0 6
.%%6 7
Empty%%7 <
;%%< =
public&& 
string&& 
Severity&& 
{&&  
get&&! $
;&&$ %
set&&& )
;&&) *
}&&+ ,
=&&- .
string&&/ 5
.&&5 6
Empty&&6 ;
;&&; <
}'' 
public)) 

class)) 
UtilizationTrendDto)) $
{** 
public++ 
int++ 
DepartmentId++ 
{++  !
get++" %
;++% &
set++' *
;++* +
}++, -
public,, 
string,, 
DepartmentName,, $
{,,% &
get,,' *
;,,* +
set,,, /
;,,/ 0
},,1 2
=,,3 4
string,,5 ;
.,,; <
Empty,,< A
;,,A B
public-- 
decimal-- !
UtilizationPercentage-- ,
{--- .
get--/ 2
;--2 3
set--4 7
;--7 8
}--9 :
public.. 
decimal.. 
TotalAllocation.. &
{..' (
get..) ,
;.., -
set... 1
;..1 2
}..3 4
public// 
decimal// 

TotalSpent// !
{//" #
get//$ '
;//' (
set//) ,
;//, -
}//. /
public00 
bool00 
IsHighUtilization00 %
{00& '
get00( +
;00+ ,
set00- 0
;000 1
}002 3
}11 
public33 

class33 $
DepartmentPerformanceDto33 )
{44 
public55 
int55 
DepartmentId55 
{55  !
get55" %
;55% &
set55' *
;55* +
}55, -
public66 
string66 
DepartmentName66 $
{66% &
get66' *
;66* +
set66, /
;66/ 0
}661 2
=663 4
string665 ;
.66; <
Empty66< A
;66A B
public77 
decimal77 
TotalAllocation77 &
{77' (
get77) ,
;77, -
set77. 1
;771 2
}773 4
public88 
decimal88 

TotalSpent88 !
{88" #
get88$ '
;88' (
set88) ,
;88, -
}88. /
public99 
decimal99 !
UtilizationPercentage99 ,
{99- .
get99/ 2
;992 3
set994 7
;997 8
}999 :
public:: 
int:: 
CategoriesCount:: "
{::# $
get::% (
;::( )
set::* -
;::- .
}::/ 0
public;; 
int;; "
CategoriesNearingLimit;; )
{;;* +
get;;, /
;;;/ 0
set;;1 4
;;;4 5
};;6 7
public<< 
int<< 
CategoriesExceeded<< %
{<<& '
get<<( +
;<<+ ,
set<<- 0
;<<0 1
}<<2 3
public== 
decimal== 
PerformanceScore== '
{==( )
get==* -
;==- .
set==/ 2
;==2 3
}==4 5
}>> 
public@@ 

class@@ 
AllocationTrendDto@@ #
{AA 
publicBB 
intBB 
YearBB 
{BB 
getBB 
;BB 
setBB "
;BB" #
}BB$ %
publicCC 
intCC 
MonthCC 
{CC 
getCC 
;CC 
setCC  #
;CC# $
}CC% &
publicDD 
intDD 
DepartmentIdDD 
{DD  !
getDD" %
;DD% &
setDD' *
;DD* +
}DD, -
publicEE 
stringEE 
DepartmentNameEE $
{EE% &
getEE' *
;EE* +
setEE, /
;EE/ 0
}EE1 2
=EE3 4
stringEE5 ;
.EE; <
EmptyEE< A
;EEA B
publicFF 
decimalFF 
TotalAllocatedFF %
{FF& '
getFF( +
;FF+ ,
setFF- 0
;FF0 1
}FF2 3
publicGG 
decimalGG 

TotalSpentGG !
{GG" #
getGG$ '
;GG' (
setGG) ,
;GG, -
}GG. /
publicHH 
intHH 
AllocationCountHH "
{HH# $
getHH% (
;HH( )
setHH* -
;HH- .
}HH/ 0
}II 
publicKK 

classKK 
CategoryAnalysisDtoKK $
{LL 
publicMM 
intMM 

CategoryIdMM 
{MM 
getMM  #
;MM# $
setMM% (
;MM( )
}MM* +
publicNN 
stringNN 
CategoryNameNN "
{NN# $
getNN% (
;NN( )
setNN* -
;NN- .
}NN/ 0
=NN1 2
stringNN3 9
.NN9 :
EmptyNN: ?
;NN? @
publicOO 
decimalOO 
CategoryLimitOO $
{OO% &
getOO' *
;OO* +
setOO, /
;OO/ 0
}OO1 2
publicPP 
decimalPP 
TotalAllocatedPP %
{PP& '
getPP( +
;PP+ ,
setPP- 0
;PP0 1
}PP2 3
publicQQ 
decimalQQ 

TotalSpentQQ !
{QQ" #
getQQ$ '
;QQ' (
setQQ) ,
;QQ, -
}QQ. /
publicRR 
intRR 
DepartmentCountRR "
{RR# $
getRR% (
;RR( )
setRR* -
;RR- .
}RR/ 0
publicSS 
decimalSS !
UtilizationPercentageSS ,
{SS- .
getSS/ 2
;SS2 3
setSS4 7
;SS7 8
}SS9 :
publicTT 
decimalTT 
RemainingLimitTT %
{TT& '
getTT( +
;TT+ ,
setTT- 0
;TT0 1
}TT2 3
}UU 
publicWW 

classWW 
RequestAnalyticsDtoWW $
{XX 
publicYY 
intYY 
TotalRequestsYY  
{YY! "
getYY# &
;YY& '
setYY( +
;YY+ ,
}YY- .
publicZZ 
intZZ 
ApprovedRequestsZZ #
{ZZ$ %
getZZ& )
;ZZ) *
setZZ+ .
;ZZ. /
}ZZ0 1
public[[ 
int[[ 
RejectedRequests[[ #
{[[$ %
get[[& )
;[[) *
set[[+ .
;[[. /
}[[0 1
public\\ 
int\\ 
PendingRequests\\ "
{\\# $
get\\% (
;\\( )
set\\* -
;\\- .
}\\/ 0
public]] 
decimal]]  
TotalAmountRequested]] +
{]], -
get]]. 1
;]]1 2
set]]3 6
;]]6 7
}]]8 9
public^^ 
decimal^^ 
TotalAmountApproved^^ *
{^^+ ,
get^^- 0
;^^0 1
set^^2 5
;^^5 6
}^^7 8
public__ 
double__ 
ApprovalRate__ "
{__# $
get__% (
;__( )
set__* -
;__- .
}__/ 0
public`` 
decimal``  
AverageRequestAmount`` +
{``, -
get``. 1
;``1 2
set``3 6
;``6 7
}``8 9
publicaa 
IEnumerableaa 
<aa '
DepartmentRequestSummaryDtoaa 6
>aa6 7$
TopRequestingDepartmentsaa8 P
{aaQ R
getaaS V
;aaV W
setaaX [
;aa[ \
}aa] ^
=aa_ `
newaaa d
Listaae i
<aai j(
DepartmentRequestSummaryDto	aaj Ö
>
aaÖ Ü
(
aaÜ á
)
aaá à
;
aaà â
}bb 
publicdd 

classdd '
DepartmentRequestSummaryDtodd ,
{ee 
publicff 
intff 
DepartmentIdff 
{ff  !
getff" %
;ff% &
setff' *
;ff* +
}ff, -
publicgg 
stringgg 
DepartmentNamegg $
{gg% &
getgg' *
;gg* +
setgg, /
;gg/ 0
}gg1 2
=gg3 4
stringgg5 ;
.gg; <
Emptygg< A
;ggA B
publichh 
inthh 
RequestCounthh 
{hh  !
gethh" %
;hh% &
sethh' *
;hh* +
}hh, -
publicii 
decimalii  
TotalAmountRequestedii +
{ii, -
getii. 1
;ii1 2
setii3 6
;ii6 7
}ii8 9
publicjj 
intjj 
ApprovedCountjj  
{jj! "
getjj# &
;jj& '
setjj( +
;jj+ ,
}jj- .
}kk 
}ll ”
WD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\DTOs\DashboardDtos.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
DTOs% )
{ 
public 

class  
DepartmentSummaryDto %
{ 
public 
int 
DepartmentId 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
DepartmentName $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
string5 ;
.; <
Empty< A
;A B
public 
decimal 
TotalAllocation &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
decimal 

TotalSpent !
{" #
get$ '
;' (
set) ,
;, -
}. /
public		 
decimal		 
Balance		 
=>		 !
TotalAllocation		" 1
-		2 3

TotalSpent		4 >
;		> ?
public

 
IEnumerable

 
<

  
CategoryBreakdownDto

 /
>

/ 0

Categories

1 ;
{

< =
get

> A
;

A B
set

C F
;

F G
}

H I
=

J K
new

L O
List

P T
<

T U 
CategoryBreakdownDto

U i
>

i j
(

j k
)

k l
;

l m
} 
public 

class  
CategoryBreakdownDto %
{ 
public 
int 

CategoryId 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
CategoryName "
{# $
get% (
;( )
set* -
;- .
}/ 0
=1 2
string3 9
.9 :
Empty: ?
;? @
public 
decimal 

Allocation !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
decimal 
Spent 
{ 
get "
;" #
set$ '
;' (
}) *
public 
decimal 
Balance 
=> !

Allocation" ,
-- .
Spent/ 4
;4 5
public 
int 
ThresholdPercent #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
bool 
NearingLimit  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
bool 
Exceeded 
{ 
get "
;" #
set$ '
;' (
}) *
} 
public 

class  
ManagementSummaryDto %
{ 
public 
IEnumerable 
<  
DepartmentSummaryDto /
>/ 0
Departments1 <
{= >
get? B
;B C
setD G
;G H
}I J
=K L
newM P
ListQ U
<U V 
DepartmentSummaryDtoV j
>j k
(k l
)l m
;m n
public 
decimal  
GrandTotalAllocation +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
public 
decimal 
GrandTotalSpent &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
decimal 
GrandBalance #
=>$ & 
GrandTotalAllocation' ;
-< =
GrandTotalSpent> M
;M N
} 
}   ß	
TD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\DTOs\CommonDtos.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
DTOs% )
{ 
public 

class 
PagedResult 
< 
T 
> 
{ 
public 
IEnumerable 
< 
T 
> 
Items #
{$ %
get& )
;) *
set+ .
;. /
}0 1
=2 3

Enumerable4 >
.> ?
Empty? D
<D E
TE F
>F G
(G H
)H I
;I J
public 
int 
Total 
{ 
get 
; 
set  #
;# $
}% &
public 
int 
Page 
{ 
get 
; 
set "
;" #
}$ %
public 
int 
PageSize 
{ 
get !
;! "
set# &
;& '
}( )
}		 
}

 †
VD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\DTOs\CategoryDtos.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
DTOs% )
{ 
public 

class 
CategoryCreateDto "
{ 
[ 	
Required	 
, 
	MaxLength 
( 
$num  
)  !
]! "
public# )
string* 0
Name1 5
{6 7
get8 ;
;; <
set= @
;@ A
}B C
=D E
stringF L
.L M
EmptyM R
;R S
[ 	
Range	 
( 
$num 
, 
double 
. 
MaxValue !
)! "
]" #
public$ *
decimal+ 2
Limit3 8
{9 :
get; >
;> ?
set@ C
;C D
}E F
[		 	
Required			 
,		 
	MaxLength		 
(		 
$num		 
)		  
]		  !
public		" (
string		) /
	Timeframe		0 9
{		: ;
get		< ?
;		? @
set		A D
;		D E
}		F G
=		H I
$str		J S
;		S T
[

 	
Range

	 
(

 
$num

 
,

 
$num

 
)

 
]

 
public

 
int

 "
ThresholdPercent

# 3
{

4 5
get

6 9
;

9 :
set

; >
;

> ?
}

@ A
=

B C
$num

D F
;

F G
} 
public 

class 
CategoryUpdateDto "
:# $
CategoryCreateDto% 6
{ 
[ 	
Required	 
] 
public 
int 
Id  
{! "
get# &
;& '
set( +
;+ ,
}- .
} 
public 

class 
CategoryResponseDto $
:% &
CategoryUpdateDto' 8
{9 :
}: ;
} ¥
RD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\DTOs\AuthDtos.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
DTOs% )
{ 
public 

class 
LoginRequest 
{ 
[ 	
Required	 
, 
EmailAddress 
]  
public! '
string( .
Email/ 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
=C D
stringE K
.K L
EmptyL Q
;Q R
[		 	
Required			 
]		 
public		 
string		  
Password		! )
{		* +
get		, /
;		/ 0
set		1 4
;		4 5
}		6 7
=		8 9
string		: @
.		@ A
Empty		A F
;		F G
}

 
public 

class 
LoginResponse 
{ 
public 
string 
Token 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public 
UserRole 
Role 
{ 
get "
;" #
set$ '
;' (
}) *
public 
int 
? 
DepartmentId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
} 
} ®«
XD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\DTOs\AllocationDtos.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
DTOs% )
{ 
public 

class 
AllocationCreateDto $
{		 
[

 	
Required

	 
(

 
ErrorMessage

 
=

  
$str

! <
)

< =
]

= >
[ 	
Range	 
( 
$num 
, 
int 
. 
MaxValue 
, 
ErrorMessage  ,
=- .
$str/ X
)X Y
]Y Z
public 
int 
DepartmentId 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
Required	 
( 
ErrorMessage 
=  
$str! :
): ;
]; <
[ 	
Range	 
( 
$num 
, 
int 
. 
MaxValue 
, 
ErrorMessage  ,
=- .
$str/ V
)V W
]W X
public 
int 

CategoryId 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 5
)5 6
]6 7
[ 	
Range	 
( 
$num 
, 
double 
. 
MaxValue $
,$ %
ErrorMessage& 2
=3 4
$str5 T
)T U
]U V
public 
decimal 
Amount 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
StringLength	 
( 
$num 
, 
ErrorMessage &
=' (
$str) P
)P Q
]Q R
public 
string 
	Timeframe 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
$str0 9
;9 :
} 
public 

class 
AllocationUpdateDto $
{ 
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 5
)5 6
]6 7
[   	
Range  	 
(   
$num   
,   
double   
.   
MaxValue   $
,  $ %
ErrorMessage  & 2
=  3 4
$str  5 T
)  T U
]  U V
public!! 
decimal!! 
Amount!! 
{!! 
get!!  #
;!!# $
set!!% (
;!!( )
}!!* +
[## 	
StringLength##	 
(## 
$num## 
,## 
ErrorMessage## &
=##' (
$str##) P
)##P Q
]##Q R
public$$ 
string$$ 
?$$ 
	Timeframe$$  
{$$! "
get$$# &
;$$& '
set$$( +
;$$+ ,
}$$- .
=$$/ 0
$str$$1 :
;$$: ;
}%% 
public** 

class** 
UpdateSpentDto** 
{++ 
[,, 	
Required,,	 
(,, 
ErrorMessage,, 
=,,  
$str,,! ;
),,; <
],,< =
[-- 	
Range--	 
(-- 
$num-- 
,-- 
double-- 
.-- 
MaxValue-- !
,--! "
ErrorMessage--# /
=--0 1
$str--2 c
)--c d
]--d e
public.. 
decimal.. 
SpentAmount.. "
{..# $
get..% (
;..( )
set..* -
;..- .
}../ 0
}// 
public44 

class44 !
AllocationResponseDto44 &
{55 
public66 
int66 
Id66 
{66 
get66 
;66 
set66  
;66  !
}66" #
public77 
int77 
DepartmentId77 
{77  !
get77" %
;77% &
set77' *
;77* +
}77, -
public88 
string88 
DepartmentName88 $
{88% &
get88' *
;88* +
set88, /
;88/ 0
}881 2
=883 4
string885 ;
.88; <
Empty88< A
;88A B
public99 
int99 

CategoryId99 
{99 
get99  #
;99# $
set99% (
;99( )
}99* +
public:: 
string:: 
CategoryName:: "
{::# $
get::% (
;::( )
set::* -
;::- .
}::/ 0
=::1 2
string::3 9
.::9 :
Empty::: ?
;::? @
public;; 
decimal;; 
Amount;; 
{;; 
get;;  #
;;;# $
set;;% (
;;;( )
};;* +
public<< 
decimal<< 
Spent<< 
{<< 
get<< "
;<<" #
set<<$ '
;<<' (
}<<) *
public== 
decimal== 
Balance== 
=>== !
Amount==" (
-==) *
Spent==+ 0
;==0 1
public>> 
decimal>> !
UtilizationPercentage>> ,
=>>>- /
Amount>>0 6
>>>7 8
$num>>9 :
?>>; <
Math>>= A
.>>A B
Round>>B G
(>>G H
(>>H I
Spent>>I N
/>>O P
Amount>>Q W
)>>W X
*>>Y Z
$num>>[ ^
,>>^ _
$num>>` a
)>>a b
:>>c d
$num>>e f
;>>f g
public?? 
bool?? 
IsOverBudget??  
=>??! #
Spent??$ )
>??* +
Amount??, 2
;??2 3
public@@ 
bool@@ 
IsNearLimit@@ 
=>@@  "!
UtilizationPercentage@@# 8
>=@@9 ;
$num@@< >
&&@@? A
!@@B C
IsOverBudget@@C O
;@@O P
publicAA 
stringAA 
	TimeframeAA 
{AA  !
getAA" %
;AA% &
setAA' *
;AA* +
}AA, -
=AA. /
stringAA0 6
.AA6 7
EmptyAA7 <
;AA< =
publicBB 
DateTimeBB 
	CreatedAtBB !
{BB" #
getBB$ '
;BB' (
setBB) ,
;BB, -
}BB. /
publicCC 
DateTimeCC 
?CC 
	UpdatedAtCC "
{CC# $
getCC% (
;CC( )
setCC* -
;CC- .
}CC/ 0
publicDD 
stringDD 
StatusDD 
=>DD 
IsOverBudgetDD  ,
?DD- .
$strDD/ <
:DD= >
IsNearLimitEE *
?EE+ ,
$strEE- 9
:EE: ;
$strFF )
;FF) *
}GG 
publicLL 

classLL  
AllocationSummaryDtoLL %
{MM 
publicNN 
intNN 
DepartmentIdNN 
{NN  !
getNN" %
;NN% &
setNN' *
;NN* +
}NN, -
publicOO 
stringOO 
DepartmentNameOO $
{OO% &
getOO' *
;OO* +
setOO, /
;OO/ 0
}OO1 2
=OO3 4
stringOO5 ;
.OO; <
EmptyOO< A
;OOA B
publicPP 
intPP 
TotalCategoriesPP "
{PP# $
getPP% (
;PP( )
setPP* -
;PP- .
}PP/ 0
publicQQ 
decimalQQ 
TotalAllocatedQQ %
{QQ& '
getQQ( +
;QQ+ ,
setQQ- 0
;QQ0 1
}QQ2 3
publicRR 
decimalRR 

TotalSpentRR !
{RR" #
getRR$ '
;RR' (
setRR) ,
;RR, -
}RR. /
publicSS 
decimalSS 
TotalRemainingSS %
{SS& '
getSS( +
;SS+ ,
setSS- 0
;SS0 1
}SS2 3
publicTT 
decimalTT !
UtilizationPercentageTT ,
{TT- .
getTT/ 2
;TT2 3
setTT4 7
;TT7 8
}TT9 :
publicUU 
intUU  
CategoriesOverBudgetUU '
{UU( )
getUU* -
;UU- .
setUU/ 2
;UU2 3
}UU4 5
publicVV 
intVV 
CategoriesNearLimitVV &
{VV' (
getVV) ,
;VV, -
setVV. 1
;VV1 2
}VV3 4
publicWW 
intWW 
CategoriesOnTrackWW $
{WW% &
getWW' *
;WW* +
setWW, /
;WW/ 0
}WW1 2
publicXX 
DateTimeXX 
LastUpdatedXX #
{XX$ %
getXX& )
;XX) *
setXX+ .
;XX. /
}XX0 1
publicYY 
ListYY 
<YY !
AllocationResponseDtoYY )
>YY) *

CategoriesYY+ 5
{YY6 7
getYY8 ;
;YY; <
setYY= @
;YY@ A
}YYB C
=YYD E
newYYF I
(YYI J
)YYJ K
;YYK L
}ZZ 
public__ 

class__ #
BulkAllocationUpdateDto__ (
{`` 
publicaa 
Listaa 
<aa 
AllocationBulkItemaa &
>aa& '
Allocationsaa( 3
{aa4 5
getaa6 9
;aa9 :
setaa; >
;aa> ?
}aa@ A
=aaB C
newaaD G
(aaG H
)aaH I
;aaI J
}bb 
publicgg 

classgg 
AllocationBulkItemgg #
{hh 
[ii 	
Requiredii	 
]ii 
[jj 	
Rangejj	 
(jj 
$numjj 
,jj 
intjj 
.jj 
MaxValuejj 
,jj 
ErrorMessagejj  ,
=jj- .
$strjj/ X
)jjX Y
]jjY Z
publickk 
intkk 
AllocationIdkk 
{kk  !
getkk" %
;kk% &
setkk' *
;kk* +
}kk, -
[mm 	
Requiredmm	 
]mm 
[nn 	
Rangenn	 
(nn 
$numnn 
,nn 
doublenn 
.nn 
MaxValuenn $
,nn$ %
ErrorMessagenn& 2
=nn3 4
$strnn5 T
)nnT U
]nnU V
publicoo 
decimaloo 
Amountoo 
{oo 
getoo  #
;oo# $
setoo% (
;oo( )
}oo* +
[qq 	
Rangeqq	 
(qq 
$numqq 
,qq 
doubleqq 
.qq 
MaxValueqq !
,qq! "
ErrorMessageqq# /
=qq0 1
$strqq2 c
)qqc d
]qqd e
publicrr 
decimalrr 
?rr 
Spentrr 
{rr 
getrr  #
;rr# $
setrr% (
;rr( )
}rr* +
}ss 
publicxx 

classxx  
AllocationHistoryDtoxx %
{yy 
publiczz 
intzz 
Idzz 
{zz 
getzz 
;zz 
setzz  
;zz  !
}zz" #
public{{ 
int{{ 
AllocationId{{ 
{{{  !
get{{" %
;{{% &
set{{' *
;{{* +
}{{, -
public|| 
string|| 
Action|| 
{|| 
get|| "
;||" #
set||$ '
;||' (
}||) *
=||+ ,
string||- 3
.||3 4
Empty||4 9
;||9 :
public}} 
decimal}} 
?}} 
PreviousAmount}} &
{}}' (
get}}) ,
;}}, -
set}}. 1
;}}1 2
}}}3 4
public~~ 
decimal~~ 
?~~ 
	NewAmount~~ !
{~~" #
get~~$ '
;~~' (
set~~) ,
;~~, -
}~~. /
public 
decimal 
? 
PreviousSpent %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public
ÄÄ 
decimal
ÄÄ 
?
ÄÄ 
NewSpent
ÄÄ  
{
ÄÄ! "
get
ÄÄ# &
;
ÄÄ& '
set
ÄÄ( +
;
ÄÄ+ ,
}
ÄÄ- .
public
ÅÅ 
string
ÅÅ 
	ChangedBy
ÅÅ 
{
ÅÅ  !
get
ÅÅ" %
;
ÅÅ% &
set
ÅÅ' *
;
ÅÅ* +
}
ÅÅ, -
=
ÅÅ. /
string
ÅÅ0 6
.
ÅÅ6 7
Empty
ÅÅ7 <
;
ÅÅ< =
public
ÇÇ 
string
ÇÇ 
UserRole
ÇÇ 
{
ÇÇ  
get
ÇÇ! $
;
ÇÇ$ %
set
ÇÇ& )
;
ÇÇ) *
}
ÇÇ+ ,
=
ÇÇ- .
string
ÇÇ/ 5
.
ÇÇ5 6
Empty
ÇÇ6 ;
;
ÇÇ; <
public
ÉÉ 
DateTime
ÉÉ 
	ChangedAt
ÉÉ !
{
ÉÉ" #
get
ÉÉ$ '
;
ÉÉ' (
set
ÉÉ) ,
;
ÉÉ, -
}
ÉÉ. /
public
ÑÑ 
string
ÑÑ 
Notes
ÑÑ 
{
ÑÑ 
get
ÑÑ !
;
ÑÑ! "
set
ÑÑ# &
;
ÑÑ& '
}
ÑÑ( )
=
ÑÑ* +
string
ÑÑ, 2
.
ÑÑ2 3
Empty
ÑÑ3 8
;
ÑÑ8 9
}
ÖÖ 
public
ää 

class
ää !
AllocationFilterDto
ää $
{
ãã 
public
åå 
int
åå 
?
åå 
DepartmentId
åå  
{
åå! "
get
åå# &
;
åå& '
set
åå( +
;
åå+ ,
}
åå- .
public
çç 
int
çç 
?
çç 

CategoryId
çç 
{
çç  
get
çç! $
;
çç$ %
set
çç& )
;
çç) *
}
çç+ ,
public
éé 
string
éé 
?
éé 
	Timeframe
éé  
{
éé! "
get
éé# &
;
éé& '
set
éé( +
;
éé+ ,
}
éé- .
public
èè 
decimal
èè 
?
èè 
	MinAmount
èè !
{
èè" #
get
èè$ '
;
èè' (
set
èè) ,
;
èè, -
}
èè. /
public
êê 
decimal
êê 
?
êê 
	MaxAmount
êê !
{
êê" #
get
êê$ '
;
êê' (
set
êê) ,
;
êê, -
}
êê. /
public
ëë 
bool
ëë 
?
ëë 
IsOverBudget
ëë !
{
ëë" #
get
ëë$ '
;
ëë' (
set
ëë) ,
;
ëë, -
}
ëë. /
public
íí 
bool
íí 
?
íí 
IsNearLimit
íí  
{
íí! "
get
íí# &
;
íí& '
set
íí( +
;
íí+ ,
}
íí- .
public
ìì 
DateTime
ìì 
?
ìì 
CreatedFrom
ìì $
{
ìì% &
get
ìì' *
;
ìì* +
set
ìì, /
;
ìì/ 0
}
ìì1 2
public
îî 
DateTime
îî 
?
îî 
	CreatedTo
îî "
{
îî# $
get
îî% (
;
îî( )
set
îî* -
;
îî- .
}
îî/ 0
public
ïï 
string
ïï 
?
ïï 
SortBy
ïï 
{
ïï 
get
ïï  #
;
ïï# $
set
ïï% (
;
ïï( )
}
ïï* +
=
ïï, -
$str
ïï. 9
;
ïï9 :
public
ññ 
string
ññ 
?
ññ 
SortDirection
ññ $
{
ññ% &
get
ññ' *
;
ññ* +
set
ññ, /
;
ññ/ 0
}
ññ1 2
=
ññ3 4
$str
ññ5 ;
;
ññ; <
public
óó 
int
óó 

PageNumber
óó 
{
óó 
get
óó  #
;
óó# $
set
óó% (
;
óó( )
}
óó* +
=
óó, -
$num
óó. /
;
óó/ 0
public
òò 
int
òò 
PageSize
òò 
{
òò 
get
òò !
;
òò! "
set
òò# &
;
òò& '
}
òò( )
=
òò* +
$num
òò, .
;
òò. /
}
ôô 
public
ûû 

class
ûû ,
PaginatedAllocationResponseDto
ûû /
{
üü 
public
†† 
List
†† 
<
†† #
AllocationResponseDto
†† )
>
††) *
Items
††+ 0
{
††1 2
get
††3 6
;
††6 7
set
††8 ;
;
††; <
}
††= >
=
††? @
new
††A D
(
††D E
)
††E F
;
††F G
public
°° 
int
°° 

TotalCount
°° 
{
°° 
get
°°  #
;
°°# $
set
°°% (
;
°°( )
}
°°* +
public
¢¢ 
int
¢¢ 

PageNumber
¢¢ 
{
¢¢ 
get
¢¢  #
;
¢¢# $
set
¢¢% (
;
¢¢( )
}
¢¢* +
public
££ 
int
££ 
PageSize
££ 
{
££ 
get
££ !
;
££! "
set
££# &
;
££& '
}
££( )
public
§§ 
int
§§ 

TotalPages
§§ 
=>
§§  
(
§§! "
int
§§" %
)
§§% &
Math
§§& *
.
§§* +
Ceiling
§§+ 2
(
§§2 3
(
§§3 4
double
§§4 :
)
§§: ;

TotalCount
§§; E
/
§§F G
PageSize
§§H P
)
§§P Q
;
§§Q R
public
•• 
bool
•• 
HasPreviousPage
•• #
=>
••$ &

PageNumber
••' 1
>
••2 3
$num
••4 5
;
••5 6
public
¶¶ 
bool
¶¶ 
HasNextPage
¶¶ 
=>
¶¶  "

PageNumber
¶¶# -
<
¶¶. /

TotalPages
¶¶0 :
;
¶¶: ;
}
ßß 
public
¨¨ 

class
¨¨ 
CopyAllocationDto
¨¨ "
{
≠≠ 
[
ÆÆ 	
Required
ÆÆ	 
]
ÆÆ 
[
ØØ 	
Range
ØØ	 
(
ØØ 
$num
ØØ 
,
ØØ 
int
ØØ 
.
ØØ 
MaxValue
ØØ 
,
ØØ 
ErrorMessage
ØØ  ,
=
ØØ- .
$str
ØØ/ _
)
ØØ_ `
]
ØØ` a
public
∞∞ 
int
∞∞  
SourceDepartmentId
∞∞ %
{
∞∞& '
get
∞∞( +
;
∞∞+ ,
set
∞∞- 0
;
∞∞0 1
}
∞∞2 3
[
≤≤ 	
Required
≤≤	 
]
≤≤ 
[
≥≥ 	
Range
≥≥	 
(
≥≥ 
$num
≥≥ 
,
≥≥ 
int
≥≥ 
.
≥≥ 
MaxValue
≥≥ 
,
≥≥ 
ErrorMessage
≥≥  ,
=
≥≥- .
$str
≥≥/ _
)
≥≥_ `
]
≥≥` a
public
¥¥ 
int
¥¥  
TargetDepartmentId
¥¥ %
{
¥¥& '
get
¥¥( +
;
¥¥+ ,
set
¥¥- 0
;
¥¥0 1
}
¥¥2 3
public
∂∂ 
List
∂∂ 
<
∂∂ 
int
∂∂ 
>
∂∂ 
?
∂∂ 
CategoryIds
∂∂ %
{
∂∂& '
get
∂∂( +
;
∂∂+ ,
set
∂∂- 0
;
∂∂0 1
}
∂∂2 3
[
∏∏ 	
Range
∏∏	 
(
∏∏ 
$num
∏∏ 
,
∏∏ 
$num
∏∏ 
,
∏∏ 
ErrorMessage
∏∏ %
=
∏∏& '
$str
∏∏( W
)
∏∏W X
]
∏∏X Y
public
ππ 
decimal
ππ 
AmountMultiplier
ππ '
{
ππ( )
get
ππ* -
;
ππ- .
set
ππ/ 2
;
ππ2 3
}
ππ4 5
=
ππ6 7
$num
ππ8 <
;
ππ< =
public
ªª 
bool
ªª 
CopySpentAmounts
ªª $
{
ªª% &
get
ªª' *
;
ªª* +
set
ªª, /
;
ªª/ 0
}
ªª1 2
=
ªª3 4
false
ªª5 :
;
ªª: ;
}
ºº 
public
¡¡ 

class
¡¡ %
AllocationComparisonDto
¡¡ (
{
¬¬ 
public
√√ 
int
√√ 

CategoryId
√√ 
{
√√ 
get
√√  #
;
√√# $
set
√√% (
;
√√( )
}
√√* +
public
ƒƒ 
string
ƒƒ 
CategoryName
ƒƒ "
{
ƒƒ# $
get
ƒƒ% (
;
ƒƒ( )
set
ƒƒ* -
;
ƒƒ- .
}
ƒƒ/ 0
=
ƒƒ1 2
string
ƒƒ3 9
.
ƒƒ9 :
Empty
ƒƒ: ?
;
ƒƒ? @
public
≈≈ 
List
≈≈ 
<
≈≈ )
DepartmentAllocationCompare
≈≈ /
>
≈≈/ 0
Departments
≈≈1 <
{
≈≈= >
get
≈≈? B
;
≈≈B C
set
≈≈D G
;
≈≈G H
}
≈≈I J
=
≈≈K L
new
≈≈M P
(
≈≈P Q
)
≈≈Q R
;
≈≈R S
}
∆∆ 
public
ÀÀ 

class
ÀÀ )
DepartmentAllocationCompare
ÀÀ ,
{
ÃÃ 
public
ÕÕ 
int
ÕÕ 
DepartmentId
ÕÕ 
{
ÕÕ  !
get
ÕÕ" %
;
ÕÕ% &
set
ÕÕ' *
;
ÕÕ* +
}
ÕÕ, -
public
ŒŒ 
string
ŒŒ 
DepartmentName
ŒŒ $
{
ŒŒ% &
get
ŒŒ' *
;
ŒŒ* +
set
ŒŒ, /
;
ŒŒ/ 0
}
ŒŒ1 2
=
ŒŒ3 4
string
ŒŒ5 ;
.
ŒŒ; <
Empty
ŒŒ< A
;
ŒŒA B
public
œœ 
decimal
œœ 
Amount
œœ 
{
œœ 
get
œœ  #
;
œœ# $
set
œœ% (
;
œœ( )
}
œœ* +
public
–– 
decimal
–– 
Spent
–– 
{
–– 
get
–– "
;
––" #
set
––$ '
;
––' (
}
––) *
public
—— 
decimal
—— #
UtilizationPercentage
—— ,
{
——- .
get
——/ 2
;
——2 3
set
——4 7
;
——7 8
}
——9 :
public
““ 
string
““ 
Status
““ 
{
““ 
get
““ "
;
““" #
set
““$ '
;
““' (
}
““) *
=
““+ ,
string
““- 3
.
““3 4
Empty
““4 9
;
““9 :
}
”” 
public
ÿÿ 

class
ÿÿ $
AllocationThresholdDto
ÿÿ '
{
ŸŸ 
public
⁄⁄ 
int
⁄⁄ 
AllocationId
⁄⁄ 
{
⁄⁄  !
get
⁄⁄" %
;
⁄⁄% &
set
⁄⁄' *
;
⁄⁄* +
}
⁄⁄, -
[
‹‹ 	
Range
‹‹	 
(
‹‹ 
$num
‹‹ 
,
‹‹ 
$num
‹‹ 
,
‹‹ 
ErrorMessage
‹‹ #
=
‹‹$ %
$str
‹‹& U
)
‹‹U V
]
‹‹V W
public
›› 
decimal
›› %
WarningThresholdPercent
›› .
{
››/ 0
get
››1 4
;
››4 5
set
››6 9
;
››9 :
}
››; <
=
››= >
$num
››? A
;
››A B
[
ﬂﬂ 	
Range
ﬂﬂ	 
(
ﬂﬂ 
$num
ﬂﬂ 
,
ﬂﬂ 
$num
ﬂﬂ 
,
ﬂﬂ 
ErrorMessage
ﬂﬂ $
=
ﬂﬂ% &
$str
ﬂﬂ' X
)
ﬂﬂX Y
]
ﬂﬂY Z
public
‡‡ 
decimal
‡‡ &
CriticalThresholdPercent
‡‡ /
{
‡‡0 1
get
‡‡2 5
;
‡‡5 6
set
‡‡7 :
;
‡‡: ;
}
‡‡< =
=
‡‡> ?
$num
‡‡@ B
;
‡‡B C
public
‚‚ 
bool
‚‚ 
EnableEmailAlerts
‚‚ %
{
‚‚& '
get
‚‚( +
;
‚‚+ ,
set
‚‚- 0
;
‚‚0 1
}
‚‚2 3
=
‚‚4 5
true
‚‚6 :
;
‚‚: ;
public
„„ 
bool
„„ '
EnableSystemNotifications
„„ -
{
„„. /
get
„„0 3
;
„„3 4
set
„„5 8
;
„„8 9
}
„„: ;
=
„„< =
true
„„> B
;
„„B C
}
‰‰ 
public
ÈÈ 

class
ÈÈ !
AllocationExportDto
ÈÈ $
{
ÍÍ 
public
ÎÎ 
int
ÎÎ 
?
ÎÎ 
DepartmentId
ÎÎ  
{
ÎÎ! "
get
ÎÎ# &
;
ÎÎ& '
set
ÎÎ( +
;
ÎÎ+ ,
}
ÎÎ- .
public
ÏÏ 
DateTime
ÏÏ 
?
ÏÏ 
FromDate
ÏÏ !
{
ÏÏ" #
get
ÏÏ$ '
;
ÏÏ' (
set
ÏÏ) ,
;
ÏÏ, -
}
ÏÏ. /
public
ÌÌ 
DateTime
ÌÌ 
?
ÌÌ 
ToDate
ÌÌ 
{
ÌÌ  !
get
ÌÌ" %
;
ÌÌ% &
set
ÌÌ' *
;
ÌÌ* +
}
ÌÌ, -
public
ÓÓ 
string
ÓÓ 
ExportFormat
ÓÓ "
{
ÓÓ# $
get
ÓÓ% (
;
ÓÓ( )
set
ÓÓ* -
;
ÓÓ- .
}
ÓÓ/ 0
=
ÓÓ1 2
$str
ÓÓ3 :
;
ÓÓ: ;
public
ÔÔ 
bool
ÔÔ !
IncludeSpentDetails
ÔÔ '
{
ÔÔ( )
get
ÔÔ* -
;
ÔÔ- .
set
ÔÔ/ 2
;
ÔÔ2 3
}
ÔÔ4 5
=
ÔÔ6 7
true
ÔÔ8 <
;
ÔÔ< =
public
 
bool
 
IncludeHistory
 "
{
# $
get
% (
;
( )
set
* -
;
- .
}
/ 0
=
1 2
false
3 8
;
8 9
}
ÒÒ 
}ÚÚ †/
VD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Data\AppDbContext.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Data% )
{ 
public 

class 
AppDbContext 
: 
	DbContext  )
{ 
public 
AppDbContext 
( 
DbContextOptions ,
<, -
AppDbContext- 9
>9 :
options; B
)B C
:D E
baseF J
(J K
optionsK R
)R S
{T U
}U V
public

 
DbSet

 
<

 
User

 
>

 
Users

  
=>

! #
Set

$ '
<

' (
User

( ,
>

, -
(

- .
)

. /
;

/ 0
public 
DbSet 
< 

Department 
>  
Departments! ,
=>- /
Set0 3
<3 4

Department4 >
>> ?
(? @
)@ A
;A B
public 
DbSet 
< 
BudgetCategory #
># $
BudgetCategories% 5
=>6 8
Set9 <
<< =
BudgetCategory= K
>K L
(L M
)M N
;N O
public 
DbSet 
< 

Allocation 
>  
Allocations! ,
=>- /
Set0 3
<3 4

Allocation4 >
>> ?
(? @
)@ A
;A B
public 
DbSet 
< 
AdjustmentRequest &
>& '
AdjustmentRequests( :
=>; =
Set> A
<A B
AdjustmentRequestB S
>S T
(T U
)U V
;V W
public 
DbSet 
< 
AuditLog 
> 
	AuditLogs (
=>) +
Set, /
</ 0
AuditLog0 8
>8 9
(9 :
): ;
;; <
public 
DbSet 
< 
Notification !
>! "
Notifications# 0
=>1 3
Set4 7
<7 8
Notification8 D
>D E
(E F
)F G
;G H
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
modelBuilder 
. 
Entity 
<  
User  $
>$ %
(% &
)& '
. 
HasIndex 
( 
u 
=> 
u  
.  !
Email! &
)& '
.' (
IsUnique( 0
(0 1
)1 2
;2 3
modelBuilder 
. 
Entity 
<  

Department  *
>* +
(+ ,
), -
. 
HasIndex 
( 
d 
=> 
d  
.  !
Name! %
)% &
.& '
IsUnique' /
(/ 0
)0 1
;1 2
modelBuilder 
. 
Entity 
<  
BudgetCategory  .
>. /
(/ 0
)0 1
. 
HasIndex 
( 
c 
=> 
new "
{# $
c% &
.& '
Name' +
,+ ,
c- .
.. /
	Timeframe/ 8
}9 :
): ;
.; <
IsUnique< D
(D E
)E F
;F G
modelBuilder 
. 
Entity 
<  

Allocation  *
>* +
(+ ,
), -
. 
HasOne 
( 
a 
=> 
a 
. 

Department )
)) *
. 
WithMany 
( 
d 
=> 
d  
.  !
Allocations! ,
), -
.   
HasForeignKey   
(   
a    
=>  ! #
a  $ %
.  % &
DepartmentId  & 2
)  2 3
.!! 
OnDelete!! 
(!! 
DeleteBehavior!! (
.!!( )
Cascade!!) 0
)!!0 1
;!!1 2
modelBuilder## 
.## 
Entity## 
<##  

Allocation##  *
>##* +
(##+ ,
)##, -
.$$ 
HasOne$$ 
($$ 
a$$ 
=>$$ 
a$$ 
.$$ 
Category$$ '
)$$' (
.%% 
WithMany%% 
(%% 
c%% 
=>%% 
c%%  
.%%  !
Allocations%%! ,
)%%, -
.&& 
HasForeignKey&& 
(&& 
a&&  
=>&&! #
a&&$ %
.&&% &

CategoryId&&& 0
)&&0 1
.'' 
OnDelete'' 
('' 
DeleteBehavior'' (
.''( )
Restrict'') 1
)''1 2
;''2 3
modelBuilder)) 
.)) 
Entity)) 
<))  
AdjustmentRequest))  1
>))1 2
())2 3
)))3 4
.** 
HasOne** 
(** 
r** 
=>** 
r** 
.** 

Department** )
)**) *
.++ 
WithMany++ 
(++ 
)++ 
.,, 
HasForeignKey,, 
(,, 
r,,  
=>,,! #
r,,$ %
.,,% &
DepartmentId,,& 2
),,2 3
;,,3 4
base.. 
... 
OnModelCreating..  
(..  !
modelBuilder..! -
)..- .
;... /
}// 	
}00 
}11 òÉ
`D:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Controllers\UsersController.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Controllers% 0
{		 
[

 
ApiController

 
]

 
[ 
Route 

(
 
$str 
) 
] 
[ 
	Authorize 
] 
public 

class 
UsersController  
:! "
ControllerBase# 1
{ 
private 
readonly 
IUserService %
_service& .
;. /
private 
readonly 
ILogger  
<  !
UsersController! 0
>0 1
_logger2 9
;9 :
public 
UsersController 
( 
IUserService +
service, 3
,3 4
ILogger5 <
<< =
UsersController= L
>L M
loggerN T
)T U
{ 	
_service 
= 
service 
; 
_logger 
= 
logger 
; 
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
ApiResponse' 2
<2 3
IEnumerable3 >
<> ?
UserResponseDto? N
>N O
>O P
>P Q
>Q R
GetAllS Y
(Y Z
)Z [
{ 	
try 
{ 
var 
userRole 
= 
User #
.# $
FindFirstValue$ 2
(2 3

ClaimTypes3 =
.= >
Role> B
)B C
;C D
if   
(   
userRole   
!=   
$str    #
)  # $
{!! 
return"" 

StatusCode"" %
(""% &
$num""& )
,"") *
ApiResponse""+ 6
<""6 7
IEnumerable""7 B
<""B C
UserResponseDto""C R
>""R S
>""S T
.""T U
Fail""U Y
(""Y Z
$str	""Z ê
)
""ê ë
)
""ë í
;
""í ì
}## 
var%% 
users%% 
=%% 
await%% !
_service%%" *
.%%* +
GetAllAsync%%+ 6
(%%6 7
)%%7 8
;%%8 9
return&& 
Ok&& 
(&& 
ApiResponse&& %
<&&% &
IEnumerable&&& 1
<&&1 2
UserResponseDto&&2 A
>&&A B
>&&B C
.&&C D
Ok&&D F
(&&F G
users&&G L
)&&L M
)&&M N
;&&N O
}'' 
catch(( 
((( 
	Exception(( 
ex(( 
)((  
{)) 
_logger** 
.** 
LogError**  
(**  !
ex**! #
,**# $
$str**% =
)**= >
;**> ?
return++ 

StatusCode++ !
(++! "
$num++" %
,++% &
ApiResponse++' 2
<++2 3
IEnumerable++3 >
<++> ?
UserResponseDto++? N
>++N O
>++O P
.++P Q
Fail++Q U
(++U V
$str++V p
)++p q
)++q r
;++r s
},, 
}-- 	
[00 	
HttpGet00	 
(00 
$str00 
)00 
]00 
public11 
async11 
Task11 
<11 
ActionResult11 &
<11& '
ApiResponse11' 2
<112 3
UserResponseDto113 B
>11B C
>11C D
>11D E
GetById11F M
(11M N
[11N O
	FromRoute11O X
]11X Y
int11Z ]
id11^ `
)11` a
{22 	
try33 
{44 
var55 
userRole55 
=55 
User55 #
.55# $
FindFirstValue55$ 2
(552 3

ClaimTypes553 =
.55= >
Role55> B
)55B C
;55C D
if66 
(66 
userRole66 
!=66 
$str66  #
)66# $
{77 
return88 

StatusCode88 %
(88% &
$num88& )
,88) *
ApiResponse88+ 6
<886 7
UserResponseDto887 F
>88F G
.88G H
Fail88H L
(88L M
$str	88M à
)
88à â
)
88â ä
;
88ä ã
}99 
var;; 
user;; 
=;; 
await;;  
_service;;! )
.;;) *
GetByIdAsync;;* 6
(;;6 7
id;;7 9
);;9 :
;;;: ;
if<< 
(<< 
user<< 
==<< 
null<<  
)<<  !
{== 
return>> 
NotFound>> #
(>># $
ApiResponse>>$ /
<>>/ 0
UserResponseDto>>0 ?
>>>? @
.>>@ A
Fail>>A E
(>>E F
$str>>F V
)>>V W
)>>W X
;>>X Y
}?? 
return@@ 
Ok@@ 
(@@ 
ApiResponse@@ %
<@@% &
UserResponseDto@@& 5
>@@5 6
.@@6 7
Ok@@7 9
(@@9 :
user@@: >
)@@> ?
)@@? @
;@@@ A
}AA 
catchBB 
(BB 
	ExceptionBB 
exBB 
)BB  
{CC 
_loggerDD 
.DD 
LogErrorDD  
(DD  !
exDD! #
,DD# $
$strDD% E
,DDE F
idDDG I
)DDI J
;DDJ K
returnEE 

StatusCodeEE !
(EE! "
$numEE" %
,EE% &
ApiResponseEE' 2
<EE2 3
UserResponseDtoEE3 B
>EEB C
.EEC D
FailEED H
(EEH I
$strEEI b
)EEb c
)EEc d
;EEd e
}FF 
}GG 	
[JJ 	
HttpPostJJ	 
]JJ 
publicKK 
asyncKK 
TaskKK 
<KK 
ActionResultKK &
<KK& '
ApiResponseKK' 2
<KK2 3
UserResponseDtoKK3 B
>KKB C
>KKC D
>KKD E
CreateKKF L
(KKL M
[KKM N
FromBodyKKN V
]KKV W
UserCreateDtoKKX e
dtoKKf i
)KKi j
{LL 	
tryMM 
{NN 
varOO 
userRoleOO 
=OO 
UserOO #
.OO# $
FindFirstValueOO$ 2
(OO2 3

ClaimTypesOO3 =
.OO= >
RoleOO> B
)OOB C
;OOC D
ifPP 
(PP 
userRolePP 
!=PP 
$strPP  #
)PP# $
{QQ 
returnRR 

StatusCodeRR %
(RR% &
$numRR& )
,RR) *
ApiResponseRR+ 6
<RR6 7
UserResponseDtoRR7 F
>RRF G
.RRG H
FailRRH L
(RRL M
$str	RRM É
)
RRÉ Ñ
)
RRÑ Ö
;
RRÖ Ü
}SS 
ifUU 
(UU 
!UU 

ModelStateUU 
.UU  
IsValidUU  '
)UU' (
returnVV 

BadRequestVV %
(VV% &
ApiResponseVV& 1
<VV1 2
UserResponseDtoVV2 A
>VVA B
.VVB C
FailVVC G
(VVG H
$strVVH [
,VV[ \

ModelStateVV] g
)VVg h
)VVh i
;VVi j
varXX 
userIdXX 
=XX 
intXX  
.XX  !
ParseXX! &
(XX& '
UserXX' +
.XX+ ,
FindFirstValueXX, :
(XX: ;

ClaimTypesXX; E
.XXE F
NameIdentifierXXF T
)XXT U
!XXU V
)XXV W
;XXW X
varYY 
resultYY 
=YY 
awaitYY "
_serviceYY# +
.YY+ ,
CreateAsyncYY, 7
(YY7 8
dtoYY8 ;
,YY; <
userIdYY= C
)YYC D
;YYD E
returnZZ 
OkZZ 
(ZZ 
ApiResponseZZ %
<ZZ% &
UserResponseDtoZZ& 5
>ZZ5 6
.ZZ6 7
OkZZ7 9
(ZZ9 :
resultZZ: @
,ZZ@ A
$strZZB ]
)ZZ] ^
)ZZ^ _
;ZZ_ `
}[[ 
catch\\ 
(\\ %
InvalidOperationException\\ ,
ex\\- /
)\\/ 0
{]] 
return^^ 

BadRequest^^ !
(^^! "
ApiResponse^^" -
<^^- .
UserResponseDto^^. =
>^^= >
.^^> ?
Fail^^? C
(^^C D
ex^^D F
.^^F G
Message^^G N
)^^N O
)^^O P
;^^P Q
}__ 
catch`` 
(`` 
	Exception`` 
ex`` 
)``  
{aa 
_loggerbb 
.bb 
LogErrorbb  
(bb  !
exbb! #
,bb# $
$strbb% :
)bb: ;
;bb; <
returncc 

StatusCodecc !
(cc! "
$numcc" %
,cc% &
ApiResponsecc' 2
<cc2 3
UserResponseDtocc3 B
>ccB C
.ccC D
FailccD H
(ccH I
$strccI `
)cc` a
)cca b
;ccb c
}dd 
}ee 	
[hh 	
HttpPuthh	 
(hh 
$strhh 
)hh 
]hh 
publicii 
asyncii 
Taskii 
<ii 
ActionResultii &
<ii& '
ApiResponseii' 2
<ii2 3
UserResponseDtoii3 B
>iiB C
>iiC D
>iiD E
UpdateiiF L
(iiL M
[iiM N
	FromRouteiiN W
]iiW X
intiiY \
idii] _
,ii_ `
[iia b
FromBodyiib j
]iij k
UserUpdateDtoiil y
dtoiiz }
)ii} ~
{jj 	
trykk 
{ll 
varmm 
userRolemm 
=mm 
Usermm #
.mm# $
FindFirstValuemm$ 2
(mm2 3

ClaimTypesmm3 =
.mm= >
Rolemm> B
)mmB C
;mmC D
ifnn 
(nn 
userRolenn 
!=nn 
$strnn  #
)nn# $
{oo 
returnpp 

StatusCodepp %
(pp% &
$numpp& )
,pp) *
ApiResponsepp+ 6
<pp6 7
UserResponseDtopp7 F
>ppF G
.ppG H
FailppH L
(ppL M
$str	ppM É
)
ppÉ Ñ
)
ppÑ Ö
;
ppÖ Ü
}qq 
ifss 
(ss 
idss 
!=ss 
dtoss 
.ss 
Idss  
)ss  !
returntt 

BadRequesttt %
(tt% &
ApiResponsett& 1
<tt1 2
UserResponseDtott2 A
>ttA B
.ttB C
FailttC G
(ttG H
$strttH \
)tt\ ]
)tt] ^
;tt^ _
ifvv 
(vv 
!vv 

ModelStatevv 
.vv  
IsValidvv  '
)vv' (
returnww 

BadRequestww %
(ww% &
ApiResponseww& 1
<ww1 2
UserResponseDtoww2 A
>wwA B
.wwB C
FailwwC G
(wwG H
$strwwH [
,ww[ \

ModelStateww] g
)wwg h
)wwh i
;wwi j
varyy 
userIdyy 
=yy 
intyy  
.yy  !
Parseyy! &
(yy& '
Useryy' +
.yy+ ,
FindFirstValueyy, :
(yy: ;

ClaimTypesyy; E
.yyE F
NameIdentifieryyF T
)yyT U
!yyU V
)yyV W
;yyW X
varzz 
resultzz 
=zz 
awaitzz "
_servicezz# +
.zz+ ,
UpdateAsynczz, 7
(zz7 8
dtozz8 ;
,zz; <
userIdzz= C
)zzC D
;zzD E
return{{ 
Ok{{ 
({{ 
ApiResponse{{ %
<{{% &
UserResponseDto{{& 5
>{{5 6
.{{6 7
Ok{{7 9
({{9 :
result{{: @
,{{@ A
$str{{B ]
){{] ^
){{^ _
;{{_ `
}|| 
catch}} 
(}} %
InvalidOperationException}} ,
ex}}- /
)}}/ 0
{~~ 
return 

BadRequest !
(! "
ApiResponse" -
<- .
UserResponseDto. =
>= >
.> ?
Fail? C
(C D
exD F
.F G
MessageG N
)N O
)O P
;P Q
}
ÄÄ 
catch
ÅÅ 
(
ÅÅ 
	Exception
ÅÅ 
ex
ÅÅ 
)
ÅÅ  
{
ÇÇ 
_logger
ÉÉ 
.
ÉÉ 
LogError
ÉÉ  
(
ÉÉ  !
ex
ÉÉ! #
,
ÉÉ# $
$str
ÉÉ% C
,
ÉÉC D
id
ÉÉE G
)
ÉÉG H
;
ÉÉH I
return
ÑÑ 

StatusCode
ÑÑ !
(
ÑÑ! "
$num
ÑÑ" %
,
ÑÑ% &
ApiResponse
ÑÑ' 2
<
ÑÑ2 3
UserResponseDto
ÑÑ3 B
>
ÑÑB C
.
ÑÑC D
Fail
ÑÑD H
(
ÑÑH I
$str
ÑÑI `
)
ÑÑ` a
)
ÑÑa b
;
ÑÑb c
}
ÖÖ 
}
ÜÜ 	
[
ââ 	

HttpDelete
ââ	 
(
ââ 
$str
ââ 
)
ââ 
]
ââ  
public
ää 
async
ää 
Task
ää 
<
ää 
ActionResult
ää &
<
ää& '
ApiResponse
ää' 2
<
ää2 3
object
ää3 9
>
ää9 :
>
ää: ;
>
ää; <
Delete
ää= C
(
ääC D
[
ääD E
	FromRoute
ääE N
]
ääN O
int
ääP S
id
ääT V
)
ääV W
{
ãã 	
try
åå 
{
çç 
var
éé 
userRole
éé 
=
éé 
User
éé #
.
éé# $
FindFirstValue
éé$ 2
(
éé2 3

ClaimTypes
éé3 =
.
éé= >
Role
éé> B
)
ééB C
;
ééC D
if
èè 
(
èè 
userRole
èè 
!=
èè 
$str
èè  #
)
èè# $
{
êê 
return
ëë 

StatusCode
ëë %
(
ëë% &
$num
ëë& )
,
ëë) *
ApiResponse
ëë+ 6
<
ëë6 7
object
ëë7 =
>
ëë= >
.
ëë> ?
Fail
ëë? C
(
ëëC D
$str
ëëD z
)
ëëz {
)
ëë{ |
;
ëë| }
}
íí 
var
îî 
userId
îî 
=
îî 
int
îî  
.
îî  !
Parse
îî! &
(
îî& '
User
îî' +
.
îî+ ,
FindFirstValue
îî, :
(
îî: ;

ClaimTypes
îî; E
.
îîE F
NameIdentifier
îîF T
)
îîT U
!
îîU V
)
îîV W
;
îîW X
await
ïï 
_service
ïï 
.
ïï 
DeleteAsync
ïï *
(
ïï* +
id
ïï+ -
,
ïï- .
userId
ïï/ 5
)
ïï5 6
;
ïï6 7
return
ññ 
Ok
ññ 
(
ññ 
ApiResponse
ññ %
<
ññ% &
object
ññ& ,
>
ññ, -
.
ññ- .
Ok
ññ. 0
(
ññ0 1
new
ññ1 4
{
ññ5 6
id
ññ7 9
}
ññ: ;
,
ññ; <
$str
ññ= X
)
ññX Y
)
ññY Z
;
ññZ [
}
óó 
catch
òò 
(
òò '
InvalidOperationException
òò ,
ex
òò- /
)
òò/ 0
{
ôô 
return
öö 

BadRequest
öö !
(
öö! "
ApiResponse
öö" -
<
öö- .
object
öö. 4
>
öö4 5
.
öö5 6
Fail
öö6 :
(
öö: ;
ex
öö; =
.
öö= >
Message
öö> E
)
ööE F
)
ööF G
;
ööG H
}
õõ 
catch
úú 
(
úú 
	Exception
úú 
ex
úú 
)
úú  
{
ùù 
_logger
ûû 
.
ûû 
LogError
ûû  
(
ûû  !
ex
ûû! #
,
ûû# $
$str
ûû% C
,
ûûC D
id
ûûE G
)
ûûG H
;
ûûH I
return
üü 

StatusCode
üü !
(
üü! "
$num
üü" %
,
üü% &
ApiResponse
üü' 2
<
üü2 3
object
üü3 9
>
üü9 :
.
üü: ;
Fail
üü; ?
(
üü? @
$str
üü@ W
)
üüW X
)
üüX Y
;
üüY Z
}
†† 
}
°° 	
}
¢¢ 
}££ ï9
cD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Controllers\RequestsController.cs
	namespace		 	"
BudgetManagementSystem		
  
.		  !
Api		! $
.		$ %
Controllers		% 0
{

 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
RequestsController #
:$ %
ControllerBase& 4
{ 
private 
readonly 
IRequestService (
_service) 1
;1 2
public 
RequestsController !
(! "
IRequestService" 1
service2 9
)9 :
=>; =
_service> F
=G H
serviceI P
;P Q
[ 	
HttpPost	 
] 
[ 	
	Authorize	 
( 
Roles 
= 
nameof !
(! "
UserRole" *
.* +
DepartmentHead+ 9
)9 :
): ;
]; <
public 
async 
Task 
< 
ActionResult &
<& '
ApiResponse' 2
<2 3(
AdjustmentRequestResponseDto3 O
>O P
>P Q
>Q R
CreateS Y
(Y Z
[Z [
FromBody[ c
]c d&
AdjustmentRequestCreateDtoe 
dto
Ä É
)
É Ñ
{ 	
if 
( 
! 

ModelState 
. 
IsValid #
)# $
return% +

BadRequest, 6
(6 7
ApiResponse7 B
<B C(
AdjustmentRequestResponseDtoC _
>_ `
.` a
Faila e
(e f
$strf y
,y z

ModelState	{ Ö
)
Ö Ü
)
Ü á
;
á à
var 
userId 
= 
int 
. 
Parse "
(" #
User# '
.' (
FindFirstValue( 6
(6 7

ClaimTypes7 A
.A B
NameIdentifierB P
)P Q
!Q R
)R S
;S T
var 
result 
= 
await 
_service '
.' (
CreateAsync( 3
(3 4
dto4 7
,7 8
userId9 ?
)? @
;@ A
return 
Ok 
( 
ApiResponse !
<! "(
AdjustmentRequestResponseDto" >
>> ?
.? @
Ok@ B
(B C
resultC I
,I J
$strK ^
)^ _
)_ `
;` a
} 	
[ 	
HttpPost	 
( 
$str 
) 
] 
[ 	
	Authorize	 
( 
Roles 
= 
nameof !
(! "
UserRole" *
.* +
FinanceAdmin+ 7
)7 8
)8 9
]9 :
public 
async 
Task 
< 
ActionResult &
<& '
ApiResponse' 2
<2 3(
AdjustmentRequestResponseDto3 O
>O P
>P Q
>Q R
ReviewS Y
(Y Z
[Z [
FromBody[ c
]c d
AdjustmentReviewDtoe x
dtoy |
)| }
{   	
var!! 
userId!! 
=!! 
int!! 
.!! 
Parse!! "
(!!" #
User!!# '
.!!' (
FindFirstValue!!( 6
(!!6 7

ClaimTypes!!7 A
.!!A B
NameIdentifier!!B P
)!!P Q
!!!Q R
)!!R S
;!!S T
var"" 
result"" 
="" 
await"" 
_service"" '
.""' (
ReviewAsync""( 3
(""3 4
dto""4 7
,""7 8
userId""9 ?
)""? @
;""@ A
var## 
message## 
=## 
result##  
.##  !
Status##! '
==##( *
RequestStatus##+ 8
.##8 9
Approved##9 A
?##B C
$str##D V
:##W X
$str##Y k
;##k l
return$$ 
Ok$$ 
($$ 
ApiResponse$$ !
<$$! "(
AdjustmentRequestResponseDto$$" >
>$$> ?
.$$? @
Ok$$@ B
($$B C
result$$C I
,$$I J
message$$K R
)$$R S
)$$S T
;$$T U
}%% 	
['' 	
HttpGet''	 
('' 
$str'' 
)'' 
]'' 
[(( 	
	Authorize((	 
((( 
Roles(( 
=(( 
$"(( 
{(( 
nameof(( $
((($ %
UserRole((% -
.((- .
FinanceAdmin((. :
)((: ;
}((; <
$str((< =
{((= >
nameof((> D
(((D E
UserRole((E M
.((M N

Management((N X
)((X Y
}((Y Z
"((Z [
)(([ \
]((\ ]
public)) 
async)) 
Task)) 
<)) 
ActionResult)) &
<))& '
ApiResponse))' 2
<))2 3
IEnumerable))3 >
<))> ?(
AdjustmentRequestResponseDto))? [
>))[ \
>))\ ]
>))] ^
>))^ _
Pending))` g
())g h
)))h i
{** 	
var++ 
list++ 
=++ 
await++ 
_service++ %
.++% &
GetPendingAsync++& 5
(++5 6
)++6 7
;++7 8
return,, 
Ok,, 
(,, 
ApiResponse,, !
<,,! "
IEnumerable,," -
<,,- .(
AdjustmentRequestResponseDto,,. J
>,,J K
>,,K L
.,,L M
Ok,,M O
(,,O P
list,,P T
),,T U
),,U V
;,,V W
}-- 	
[00 	
HttpGet00	 
(00 
$str00 0
)000 1
]001 2
[11 	
	Authorize11	 
]11 
public22 
async22 
Task22 
<22 
ActionResult22 &
<22& '
ApiResponse22' 2
<222 3
IEnumerable223 >
<22> ?(
AdjustmentRequestResponseDto22? [
>22[ \
>22\ ]
>22] ^
>22^ _
ByDepartment22` l
(22l m
[22m n
	FromRoute22n w
]22w x
int22y |
departmentId	22} â
)
22â ä
{33 	
var44 
list44 
=44 
await44 
_service44 %
.44% & 
GetByDepartmentAsync44& :
(44: ;
departmentId44; G
)44G H
;44H I
return55 
Ok55 
(55 
ApiResponse55 !
<55! "
IEnumerable55" -
<55- .(
AdjustmentRequestResponseDto55. J
>55J K
>55K L
.55L M
Ok55M O
(55O P
list55P T
)55T U
)55U V
;55V W
}66 	
}77 
}88 ˘%
hD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Controllers\NotificationsController.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Controllers% 0
{ 
[		 
ApiController		 
]		 
[

 
Route

 

(


 
$str

 
)

 
]

  
[ 
	Authorize 
] 
public 

class #
NotificationsController (
:) *
ControllerBase+ 9
{ 
private 
readonly 
AppDbContext %
_db& )
;) *
public #
NotificationsController &
(& '
AppDbContext' 3
db4 6
)6 7
=>8 :
_db; >
=? @
dbA C
;C D
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
ApiResponse' 2
<2 3
object3 9
>9 :
>: ;
>; <
GetMy= B
(B C
)C D
{ 	
var 
userId 
= 
int 
. 
Parse "
(" #
User# '
.' (
	FindFirst( 1
(1 2
System2 8
.8 9
Security9 A
.A B
ClaimsB H
.H I

ClaimTypesI S
.S T
NameIdentifierT b
)b c
!c d
.d e
Valuee j
)j k
;k l
var 
items 
= 
await 
_db !
.! "
Notifications" /
./ 0
Where0 5
(5 6
n6 7
=>8 :
n; <
.< =
UserId= C
==D F
userIdG M
)M N
.N O
OrderByDescendingO `
(` a
na b
=>c e
nf g
.g h
	CreatedAth q
)q r
.r s
Takes w
(w x
$numx {
){ |
.| }
ToListAsync	} à
(
à â
)
â ä
;
ä ã
return 
Ok 
( 
ApiResponse !
<! "
object" (
>( )
.) *
Ok* ,
(, -
items- 2
)2 3
)3 4
;4 5
} 	
[ 	
HttpPost	 
( 
$str !
)! "
]" #
public 
async 
Task 
< 
ActionResult &
<& '
ApiResponse' 2
<2 3
object3 9
>9 :
>: ;
>; <
MarkRead= E
(E F
[F G
	FromRouteG P
]P Q
intR U
idV X
)X Y
{ 	
var 
userId 
= 
int 
. 
Parse "
(" #
User# '
.' (
	FindFirst( 1
(1 2
System2 8
.8 9
Security9 A
.A B
ClaimsB H
.H I

ClaimTypesI S
.S T
NameIdentifierT b
)b c
!c d
.d e
Valuee j
)j k
;k l
var 
n 
= 
await 
_db 
. 
Notifications +
.+ ,
FirstOrDefaultAsync, ?
(? @
n@ A
=>B D
nE F
.F G
IdG I
==J L
idM O
&&P R
nS T
.T U
UserIdU [
==\ ^
userId_ e
)e f
;f g
if 
( 
n 
== 
null 
) 
return !
NotFound" *
(* +
ApiResponse+ 6
<6 7
object7 =
>= >
.> ?
Fail? C
(C D
$strD \
)\ ]
)] ^
;^ _
n   
.   
IsRead   
=   
true   
;   
await!! 
_db!! 
.!! 
SaveChangesAsync!! &
(!!& '
)!!' (
;!!( )
return"" 
Ok"" 
("" 
ApiResponse"" !
<""! "
object""" (
>""( )
."") *
Ok""* ,
("", -
new""- 0
{""1 2
id""3 5
}""6 7
,""7 8
$str""9 I
)""I J
)""J K
;""K L
}## 	
}$$ 
}%% õÖ
eD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Controllers\ManagementController.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Controllers% 0
{ 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
[ 
	Authorize 
( 
Roles 
= 
$" 
{ 
nameof  
(  !
UserRole! )
.) *

Management* 4
)4 5
}5 6
$str6 7
{7 8
nameof8 >
(> ?
UserRole? G
.G H
FinanceAdminH T
)T U
}U V
"V W
)W X
]X Y
public 

class  
ManagementController %
:& '
ControllerBase( 6
{ 
private 
readonly 
IAllocationService +
_allocationService, >
;> ?
private 
readonly 
IRequestService (
_requestService) 8
;8 9
private 
readonly 
AppDbContext %
_db& )
;) *
public  
ManagementController #
(# $
IAllocationService 
allocationService 0
,0 1
IRequestService 
requestService *
,* +
AppDbContext 
db 
) 
{ 	
_allocationService 
=  
allocationService! 2
;2 3
_requestService 
= 
requestService ,
;, -
_db 
= 
db 
; 
} 	
[   	
HttpGet  	 
(   
$str   
)   
]   
public!! 
async!! 
Task!! 
<!! 
ActionResult!! &
<!!& '
ApiResponse!!' 2
<!!2 3"
ManagementDashboardDto!!3 I
>!!I J
>!!J K
>!!K L
GetDashboard!!M Y
(!!Y Z
["" 
	FromQuery"" 
]"" 
int"" 
?"" 

categoryId"" '
,""' (
[## 
	FromQuery## 
]## 
int## 
?## 
departmentId## )
)##) *
{$$ 	
var%% 
summary%% 
=%% 
await%% 
_allocationService%%  2
.%%2 3%
GetManagementSummaryAsync%%3 L
(%%L M

categoryId%%M W
,%%W X
departmentId%%Y e
)%%e f
;%%f g
var&& 
pendingRequests&& 
=&&  !
await&&" '
_requestService&&( 7
.&&7 8
GetPendingAsync&&8 G
(&&G H
)&&H I
;&&I J
var'' 
pendingCount'' 
='' 
pendingRequests'' .
.''. /
Count''/ 4
(''4 5
)''5 6
;''6 7
var)) 
recentRequests)) 
=))  
await))! &
_db))' *
.))* +
AdjustmentRequests))+ =
.** 
Include** 
(** 
r** 
=>** 
r** 
.**  

Department**  *
)*** +
.++ 
Include++ 
(++ 
r++ 
=>++ 
r++ 
.++  
Category++  (
)++( )
.,, 
OrderByDescending,, "
(,," #
r,,# $
=>,,% '
r,,( )
.,,) *
	CreatedAt,,* 3
),,3 4
.-- 
Take-- 
(-- 
$num-- 
)-- 
... 
Select.. 
(.. 
r.. 
=>.. 
new..  
RecentRequestDto..! 1
{// 
Id00 
=00 
r00 
.00 
Id00 
,00 
DepartmentName11 "
=11# $
r11% &
.11& '

Department11' 1
.111 2
Name112 6
,116 7
CategoryName22  
=22! "
r22# $
.22$ %
Category22% -
.22- .
Name22. 2
,222 3
Amount33 
=33 
r33 
.33 
Amount33 %
,33% &
Status44 
=44 
r44 
.44 
Status44 %
,44% &
	CreatedAt55 
=55 
r55  !
.55! "
	CreatedAt55" +
,55+ ,

ReviewedAt66 
=66  
r66! "
.66" #

ReviewedAt66# -
}77 
)77 
.88 
ToListAsync88 
(88 
)88 
;88 
var:: 
alerts:: 
=:: 
await::  
GetBudgetAlertsAsync:: 3
(::3 4
)::4 5
;::5 6
var<< 
utilizationTrends<< !
=<<" #
summary<<$ +
.<<+ ,
Departments<<, 7
.== 
Where== 
(== 
d== 
=>== 
d== 
.== 
TotalAllocation== -
>==. /
$num==0 1
)==1 2
.>> 
Select>> 
(>> 
d>> 
=>>> 
new>>  
UtilizationTrendDto>>! 4
{?? 
DepartmentId@@  
=@@! "
d@@# $
.@@$ %
DepartmentId@@% 1
,@@1 2
DepartmentNameAA "
=AA# $
dAA% &
.AA& '
DepartmentNameAA' 5
,AA5 6!
UtilizationPercentageBB )
=BB* +
MathBB, 0
.BB0 1
RoundBB1 6
(BB6 7
(BB7 8
dBB8 9
.BB9 :

TotalSpentBB: D
/BBE F
dBBG H
.BBH I
TotalAllocationBBI X
)BBX Y
*BBZ [
$numBB\ _
,BB_ `
$numBBa b
)BBb c
,BBc d
TotalAllocationCC #
=CC$ %
dCC& '
.CC' (
TotalAllocationCC( 7
,CC7 8

TotalSpentDD 
=DD  
dDD! "
.DD" #

TotalSpentDD# -
,DD- .
IsHighUtilizationEE %
=EE& '
(EE( )
dEE) *
.EE* +

TotalSpentEE+ 5
/EE6 7
dEE8 9
.EE9 :
TotalAllocationEE: I
)EEI J
>=EEK M
$numEEN R
}FF 
)FF 
.GG 
OrderByDescendingGG "
(GG" #
uGG# $
=>GG% '
uGG( )
.GG) *!
UtilizationPercentageGG* ?
)GG? @
.HH 
ToListHH 
(HH 
)HH 
;HH 
varJJ 
	dashboardJJ 
=JJ 
newJJ "
ManagementDashboardDtoJJ  6
{KK 
SummaryLL 
=LL 
summaryLL !
,LL! " 
PendingRequestsCountMM $
=MM% &
pendingCountMM' 3
,MM3 4
RecentRequestsNN 
=NN  
recentRequestsNN! /
,NN/ 0
BudgetAlertsOO 
=OO 
alertsOO %
,OO% &
UtilizationTrendsPP !
=PP" #
utilizationTrendsPP$ 5
,PP5 6
TotalDepartmentsQQ  
=QQ! "
summaryQQ# *
.QQ* +
DepartmentsQQ+ 6
.QQ6 7
CountQQ7 <
(QQ< =
)QQ= >
,QQ> ?&
HighUtilizationDepartmentsRR *
=RR+ ,
utilizationTrendsRR- >
.RR> ?
CountRR? D
(RRD E
uRRE F
=>RRG I
uRRJ K
.RRK L
IsHighUtilizationRRL ]
)RR] ^
}SS 
;SS 
returnUU 
OkUU 
(UU 
ApiResponseUU !
<UU! ""
ManagementDashboardDtoUU" 8
>UU8 9
.UU9 :
OkUU: <
(UU< =
	dashboardUU= F
)UUF G
)UUG H
;UUH I
}VV 	
[XX 	
HttpGetXX	 
(XX 
$strXX *
)XX* +
]XX+ ,
publicYY 
asyncYY 
TaskYY 
<YY 
ActionResultYY &
<YY& '
ApiResponseYY' 2
<YY2 3
IEnumerableYY3 >
<YY> ?$
DepartmentPerformanceDtoYY? W
>YYW X
>YYX Y
>YYY Z
>YYZ [$
GetDepartmentPerformanceYY\ t
(YYt u
)YYu v
{ZZ 	
var[[ 
summary[[ 
=[[ 
await[[ 
_allocationService[[  2
.[[2 3%
GetManagementSummaryAsync[[3 L
([[L M
)[[M N
;[[N O
var]] 
performance]] 
=]] 
summary]] %
.]]% &
Departments]]& 1
.]]1 2
Select]]2 8
(]]8 9
d]]9 :
=>]]; =
new]]> A$
DepartmentPerformanceDto]]B Z
{^^ 
DepartmentId__ 
=__ 
d__  
.__  !
DepartmentId__! -
,__- .
DepartmentName`` 
=``  
d``! "
.``" #
DepartmentName``# 1
,``1 2
TotalAllocationaa 
=aa  !
daa" #
.aa# $
TotalAllocationaa$ 3
,aa3 4

TotalSpentbb 
=bb 
dbb 
.bb 

TotalSpentbb )
,bb) *!
UtilizationPercentagecc %
=cc& '
dcc( )
.cc) *
TotalAllocationcc* 9
>cc: ;
$numcc< =
?cc> ?
Mathcc@ D
.ccD E
RoundccE J
(ccJ K
(ccK L
dccL M
.ccM N

TotalSpentccN X
/ccY Z
dcc[ \
.cc\ ]
TotalAllocationcc] l
)ccl m
*ccn o
$numccp s
,ccs t
$numccu v
)ccv w
:ccx y
$numccz {
,cc{ |
CategoriesCountdd 
=dd  !
ddd" #
.dd# $

Categoriesdd$ .
.dd. /
Countdd/ 4
(dd4 5
)dd5 6
,dd6 7"
CategoriesNearingLimitee &
=ee' (
dee) *
.ee* +

Categoriesee+ 5
.ee5 6
Countee6 ;
(ee; <
cee< =
=>ee> @
ceeA B
.eeB C
NearingLimiteeC O
)eeO P
,eeP Q
CategoriesExceededff "
=ff# $
dff% &
.ff& '

Categoriesff' 1
.ff1 2
Countff2 7
(ff7 8
cff8 9
=>ff: <
cff= >
.ff> ?
Exceededff? G
)ffG H
,ffH I
PerformanceScoregg  
=gg! "%
CalculatePerformanceScoregg# <
(gg< =
dgg= >
)gg> ?
}hh 
)hh 
.hh 
OrderByDescendinghh  
(hh  !
phh! "
=>hh# %
phh& '
.hh' (
PerformanceScorehh( 8
)hh8 9
.hh9 :
ToListhh: @
(hh@ A
)hhA B
;hhB C
returnjj 
Okjj 
(jj 
ApiResponsejj !
<jj! "
IEnumerablejj" -
<jj- .$
DepartmentPerformanceDtojj. F
>jjF G
>jjG H
.jjH I
OkjjI K
(jjK L
performancejjL W
)jjW X
)jjX Y
;jjY Z
}kk 	
[mm 	
HttpGetmm	 
(mm 
$strmm %
)mm% &
]mm& '
publicnn 
asyncnn 
Tasknn 
<nn 
ActionResultnn &
<nn& '
ApiResponsenn' 2
<nn2 3
IEnumerablenn3 >
<nn> ?
AllocationTrendDtonn? Q
>nnQ R
>nnR S
>nnS T
>nnT U
GetAllocationTrendsnnV i
(nni j
[oo 
	FromQueryoo 
]oo 
intoo 
monthsoo "
=oo# $
$numoo% &
)oo& '
{pp 	
varqq 
	startDateqq 
=qq 
DateTimeqq $
.qq$ %
UtcNowqq% +
.qq+ ,
	AddMonthsqq, 5
(qq5 6
-qq6 7
monthsqq7 =
)qq= >
;qq> ?
varss 
trendsss 
=ss 
awaitss 
_dbss "
.ss" #
Allocationsss# .
.tt 
Includett 
(tt 
att 
=>tt 
att 
.tt  

Departmenttt  *
)tt* +
.uu 
Includeuu 
(uu 
auu 
=>uu 
auu 
.uu  
Categoryuu  (
)uu( )
.vv 
Wherevv 
(vv 
avv 
=>vv 
avv 
.vv 
	CreatedAtvv '
>=vv( *
	startDatevv+ 4
)vv4 5
.ww 
GroupByww 
(ww 
aww 
=>ww 
newww !
{ww" #
aww$ %
.ww% &
	CreatedAtww& /
.ww/ 0
Yearww0 4
,ww4 5
aww6 7
.ww7 8
	CreatedAtww8 A
.wwA B
MonthwwB G
,wwG H
awwI J
.wwJ K
DepartmentIdwwK W
,wwW X
awwY Z
.wwZ [

Departmentww[ e
.wwe f
Namewwf j
}wwk l
)wwl m
.xx 
Selectxx 
(xx 
gxx 
=>xx 
newxx  
AllocationTrendDtoxx! 3
{yy 
Yearzz 
=zz 
gzz 
.zz 
Keyzz  
.zz  !
Yearzz! %
,zz% &
Month{{ 
={{ 
g{{ 
.{{ 
Key{{ !
.{{! "
Month{{" '
,{{' (
DepartmentId||  
=||! "
g||# $
.||$ %
Key||% (
.||( )
DepartmentId||) 5
,||5 6
DepartmentName}} "
=}}# $
g}}% &
.}}& '
Key}}' *
.}}* +
Name}}+ /
,}}/ 0
TotalAllocated~~ "
=~~# $
g~~% &
.~~& '
Sum~~' *
(~~* +
a~~+ ,
=>~~- /
a~~0 1
.~~1 2
Amount~~2 8
)~~8 9
,~~9 :

TotalSpent 
=  
g! "
." #
Sum# &
(& '
a' (
=>) +
a, -
.- .
Spent. 3
)3 4
,4 5
AllocationCount
ÄÄ #
=
ÄÄ$ %
g
ÄÄ& '
.
ÄÄ' (
Count
ÄÄ( -
(
ÄÄ- .
)
ÄÄ. /
}
ÅÅ 
)
ÅÅ 
.
ÇÇ 
OrderBy
ÇÇ 
(
ÇÇ 
t
ÇÇ 
=>
ÇÇ 
t
ÇÇ 
.
ÇÇ  
Year
ÇÇ  $
)
ÇÇ$ %
.
ÇÇ% &
ThenBy
ÇÇ& ,
(
ÇÇ, -
t
ÇÇ- .
=>
ÇÇ/ 1
t
ÇÇ2 3
.
ÇÇ3 4
Month
ÇÇ4 9
)
ÇÇ9 :
.
ÉÉ 
ToListAsync
ÉÉ 
(
ÉÉ 
)
ÉÉ 
;
ÉÉ 
return
ÖÖ 
Ok
ÖÖ 
(
ÖÖ 
ApiResponse
ÖÖ !
<
ÖÖ! "
IEnumerable
ÖÖ" -
<
ÖÖ- . 
AllocationTrendDto
ÖÖ. @
>
ÖÖ@ A
>
ÖÖA B
.
ÖÖB C
Ok
ÖÖC E
(
ÖÖE F
trends
ÖÖF L
)
ÖÖL M
)
ÖÖM N
;
ÖÖN O
}
ÜÜ 	
[
àà 	
HttpGet
àà	 
(
àà 
$str
àà &
)
àà& '
]
àà' (
public
ââ 
async
ââ 
Task
ââ 
<
ââ 
ActionResult
ââ &
<
ââ& '
ApiResponse
ââ' 2
<
ââ2 3
IEnumerable
ââ3 >
<
ââ> ?!
CategoryAnalysisDto
ââ? R
>
ââR S
>
ââS T
>
ââT U
>
ââU V!
GetCategoryAnalysis
ââW j
(
ââj k
)
ââk l
{
ää 	
var
ãã 
analysis
ãã 
=
ãã 
await
ãã  
_db
ãã! $
.
ãã$ %
Allocations
ãã% 0
.
åå 
Include
åå 
(
åå 
a
åå 
=>
åå 
a
åå 
.
åå  
Category
åå  (
)
åå( )
.
çç 
GroupBy
çç 
(
çç 
a
çç 
=>
çç 
new
çç !
{
çç" #
a
çç$ %
.
çç% &

CategoryId
çç& 0
,
çç0 1
a
çç2 3
.
çç3 4
Category
çç4 <
.
çç< =
Name
çç= A
,
ççA B
a
ççC D
.
ççD E
Category
ççE M
.
ççM N
Limit
ççN S
}
ççT U
)
ççU V
.
éé 
Select
éé 
(
éé 
g
éé 
=>
éé 
new
éé  !
CategoryAnalysisDto
éé! 4
{
èè 

CategoryId
êê 
=
êê  
g
êê! "
.
êê" #
Key
êê# &
.
êê& '

CategoryId
êê' 1
,
êê1 2
CategoryName
ëë  
=
ëë! "
g
ëë# $
.
ëë$ %
Key
ëë% (
.
ëë( )
Name
ëë) -
,
ëë- .
CategoryLimit
íí !
=
íí" #
g
íí$ %
.
íí% &
Key
íí& )
.
íí) *
Limit
íí* /
,
íí/ 0
TotalAllocated
ìì "
=
ìì# $
g
ìì% &
.
ìì& '
Sum
ìì' *
(
ìì* +
a
ìì+ ,
=>
ìì- /
a
ìì0 1
.
ìì1 2
Amount
ìì2 8
)
ìì8 9
,
ìì9 :

TotalSpent
îî 
=
îî  
g
îî! "
.
îî" #
Sum
îî# &
(
îî& '
a
îî' (
=>
îî) +
a
îî, -
.
îî- .
Spent
îî. 3
)
îî3 4
,
îî4 5
DepartmentCount
ïï #
=
ïï$ %
g
ïï& '
.
ïï' (
Select
ïï( .
(
ïï. /
a
ïï/ 0
=>
ïï1 3
a
ïï4 5
.
ïï5 6
DepartmentId
ïï6 B
)
ïïB C
.
ïïC D
Distinct
ïïD L
(
ïïL M
)
ïïM N
.
ïïN O
Count
ïïO T
(
ïïT U
)
ïïU V
,
ïïV W#
UtilizationPercentage
ññ )
=
ññ* +
g
ññ, -
.
ññ- .
Sum
ññ. 1
(
ññ1 2
a
ññ2 3
=>
ññ4 6
a
ññ7 8
.
ññ8 9
Amount
ññ9 ?
)
ññ? @
>
ññA B
$num
ññC D
?
ññE F
Math
ññG K
.
ññK L
Round
ññL Q
(
ññQ R
(
ññR S
g
ññS T
.
ññT U
Sum
ññU X
(
ññX Y
a
ññY Z
=>
ññ[ ]
a
ññ^ _
.
ññ_ `
Spent
ññ` e
)
ññe f
/
ññg h
g
ññi j
.
ññj k
Sum
ññk n
(
ññn o
a
ñño p
=>
ññq s
a
ññt u
.
ññu v
Amount
ññv |
)
ññ| }
)
ññ} ~
*ññ Ä
$numññÅ Ñ
,ññÑ Ö
$numññÜ á
)ññá à
:ññâ ä
$numññã å
,ññå ç
RemainingLimit
óó "
=
óó# $
g
óó% &
.
óó& '
Key
óó' *
.
óó* +
Limit
óó+ 0
-
óó1 2
g
óó3 4
.
óó4 5
Sum
óó5 8
(
óó8 9
a
óó9 :
=>
óó; =
a
óó> ?
.
óó? @
Amount
óó@ F
)
óóF G
}
òò 
)
òò 
.
ôô 
OrderByDescending
ôô "
(
ôô" #
c
ôô# $
=>
ôô% '
c
ôô( )
.
ôô) *
TotalAllocated
ôô* 8
)
ôô8 9
.
öö 
ToListAsync
öö 
(
öö 
)
öö 
;
öö 
return
úú 
Ok
úú 
(
úú 
ApiResponse
úú !
<
úú! "
IEnumerable
úú" -
<
úú- .!
CategoryAnalysisDto
úú. A
>
úúA B
>
úúB C
.
úúC D
Ok
úúD F
(
úúF G
analysis
úúG O
)
úúO P
)
úúP Q
;
úúQ R
}
ùù 	
[
üü 	
HttpGet
üü	 
(
üü 
$str
üü %
)
üü% &
]
üü& '
public
†† 
async
†† 
Task
†† 
<
†† 
ActionResult
†† &
<
††& '
ApiResponse
††' 2
<
††2 3!
RequestAnalyticsDto
††3 F
>
††F G
>
††G H
>
††H I!
GetRequestAnalytics
††J ]
(
††] ^
[
°° 
	FromQuery
°° 
]
°° 
int
°° 
days
°°  
=
°°! "
$num
°°# %
)
°°% &
{
¢¢ 	
var
££ 
	startDate
££ 
=
££ 
DateTime
££ $
.
££$ %
UtcNow
££% +
.
££+ ,
AddDays
££, 3
(
££3 4
-
££4 5
days
££5 9
)
££9 :
;
££: ;
var
•• 
requests
•• 
=
•• 
await
••  
_db
••! $
.
••$ % 
AdjustmentRequests
••% 7
.
¶¶ 
Include
¶¶ 
(
¶¶ 
r
¶¶ 
=>
¶¶ 
r
¶¶ 
.
¶¶  

Department
¶¶  *
)
¶¶* +
.
ßß 
Include
ßß 
(
ßß 
r
ßß 
=>
ßß 
r
ßß 
.
ßß  
Category
ßß  (
)
ßß( )
.
®® 
Where
®® 
(
®® 
r
®® 
=>
®® 
r
®® 
.
®® 
	CreatedAt
®® '
>=
®®( *
	startDate
®®+ 4
)
®®4 5
.
©© 
ToListAsync
©© 
(
©© 
)
©© 
;
©© 
var
´´ 
	analytics
´´ 
=
´´ 
new
´´ !
RequestAnalyticsDto
´´  3
{
¨¨ 
TotalRequests
≠≠ 
=
≠≠ 
requests
≠≠  (
.
≠≠( )
Count
≠≠) .
,
≠≠. /
ApprovedRequests
ÆÆ  
=
ÆÆ! "
requests
ÆÆ# +
.
ÆÆ+ ,
Count
ÆÆ, 1
(
ÆÆ1 2
r
ÆÆ2 3
=>
ÆÆ4 6
r
ÆÆ7 8
.
ÆÆ8 9
Status
ÆÆ9 ?
==
ÆÆ@ B
RequestStatus
ÆÆC P
.
ÆÆP Q
Approved
ÆÆQ Y
)
ÆÆY Z
,
ÆÆZ [
RejectedRequests
ØØ  
=
ØØ! "
requests
ØØ# +
.
ØØ+ ,
Count
ØØ, 1
(
ØØ1 2
r
ØØ2 3
=>
ØØ4 6
r
ØØ7 8
.
ØØ8 9
Status
ØØ9 ?
==
ØØ@ B
RequestStatus
ØØC P
.
ØØP Q
Rejected
ØØQ Y
)
ØØY Z
,
ØØZ [
PendingRequests
∞∞ 
=
∞∞  !
requests
∞∞" *
.
∞∞* +
Count
∞∞+ 0
(
∞∞0 1
r
∞∞1 2
=>
∞∞3 5
r
∞∞6 7
.
∞∞7 8
Status
∞∞8 >
==
∞∞? A
RequestStatus
∞∞B O
.
∞∞O P
Pending
∞∞P W
)
∞∞W X
,
∞∞X Y"
TotalAmountRequested
±± $
=
±±% &
requests
±±' /
.
±±/ 0
Sum
±±0 3
(
±±3 4
r
±±4 5
=>
±±6 8
r
±±9 :
.
±±: ;
Amount
±±; A
)
±±A B
,
±±B C!
TotalAmountApproved
≤≤ #
=
≤≤$ %
requests
≤≤& .
.
≤≤. /
Where
≤≤/ 4
(
≤≤4 5
r
≤≤5 6
=>
≤≤7 9
r
≤≤: ;
.
≤≤; <
Status
≤≤< B
==
≤≤C E
RequestStatus
≤≤F S
.
≤≤S T
Approved
≤≤T \
)
≤≤\ ]
.
≤≤] ^
Sum
≤≤^ a
(
≤≤a b
r
≤≤b c
=>
≤≤d f
r
≤≤g h
.
≤≤h i
Amount
≤≤i o
)
≤≤o p
,
≤≤p q
ApprovalRate
≥≥ 
=
≥≥ 
requests
≥≥ '
.
≥≥' (
Count
≥≥( -
>
≥≥. /
$num
≥≥0 1
?
≥≥2 3
Math
≥≥4 8
.
≥≥8 9
Round
≥≥9 >
(
≥≥> ?
(
≥≥? @
double
≥≥@ F
)
≥≥F G
requests
≥≥G O
.
≥≥O P
Count
≥≥P U
(
≥≥U V
r
≥≥V W
=>
≥≥X Z
r
≥≥[ \
.
≥≥\ ]
Status
≥≥] c
==
≥≥d f
RequestStatus
≥≥g t
.
≥≥t u
Approved
≥≥u }
)
≥≥} ~
/≥≥ Ä
requests≥≥Å â
.≥≥â ä
Count≥≥ä è
*≥≥ê ë
$num≥≥í ï
,≥≥ï ñ
$num≥≥ó ò
)≥≥ò ô
:≥≥ö õ
$num≥≥ú ù
,≥≥ù û"
AverageRequestAmount
¥¥ $
=
¥¥% &
requests
¥¥' /
.
¥¥/ 0
Count
¥¥0 5
>
¥¥6 7
$num
¥¥8 9
?
¥¥: ;
Math
¥¥< @
.
¥¥@ A
Round
¥¥A F
(
¥¥F G
requests
¥¥G O
.
¥¥O P
Average
¥¥P W
(
¥¥W X
r
¥¥X Y
=>
¥¥Z \
r
¥¥] ^
.
¥¥^ _
Amount
¥¥_ e
)
¥¥e f
,
¥¥f g
$num
¥¥h i
)
¥¥i j
:
¥¥k l
$num
¥¥m n
,
¥¥n o&
TopRequestingDepartments
µµ (
=
µµ) *
requests
µµ+ 3
.
∂∂ 
GroupBy
∂∂ 
(
∂∂ 
r
∂∂ 
=>
∂∂ !
new
∂∂" %
{
∂∂& '
r
∂∂( )
.
∂∂) *
DepartmentId
∂∂* 6
,
∂∂6 7
r
∂∂8 9
.
∂∂9 :

Department
∂∂: D
.
∂∂D E
Name
∂∂E I
}
∂∂J K
)
∂∂K L
.
∑∑ 
Select
∑∑ 
(
∑∑ 
g
∑∑ 
=>
∑∑  
new
∑∑! $)
DepartmentRequestSummaryDto
∑∑% @
{
∏∏ 
DepartmentId
ππ $
=
ππ% &
g
ππ' (
.
ππ( )
Key
ππ) ,
.
ππ, -
DepartmentId
ππ- 9
,
ππ9 :
DepartmentName
∫∫ &
=
∫∫' (
g
∫∫) *
.
∫∫* +
Key
∫∫+ .
.
∫∫. /
Name
∫∫/ 3
,
∫∫3 4
RequestCount
ªª $
=
ªª% &
g
ªª' (
.
ªª( )
Count
ªª) .
(
ªª. /
)
ªª/ 0
,
ªª0 1"
TotalAmountRequested
ºº ,
=
ºº- .
g
ºº/ 0
.
ºº0 1
Sum
ºº1 4
(
ºº4 5
r
ºº5 6
=>
ºº7 9
r
ºº: ;
.
ºº; <
Amount
ºº< B
)
ººB C
,
ººC D
ApprovedCount
ΩΩ %
=
ΩΩ& '
g
ΩΩ( )
.
ΩΩ) *
Count
ΩΩ* /
(
ΩΩ/ 0
r
ΩΩ0 1
=>
ΩΩ2 4
r
ΩΩ5 6
.
ΩΩ6 7
Status
ΩΩ7 =
==
ΩΩ> @
RequestStatus
ΩΩA N
.
ΩΩN O
Approved
ΩΩO W
)
ΩΩW X
}
ææ 
)
ææ 
.
øø 
OrderByDescending
øø &
(
øø& '
d
øø' (
=>
øø) +
d
øø, -
.
øø- .
RequestCount
øø. :
)
øø: ;
.
¿¿ 
Take
¿¿ 
(
¿¿ 
$num
¿¿ 
)
¿¿ 
.
¡¡ 
ToList
¡¡ 
(
¡¡ 
)
¡¡ 
}
¬¬ 
;
¬¬ 
return
ƒƒ 
Ok
ƒƒ 
(
ƒƒ 
ApiResponse
ƒƒ !
<
ƒƒ! "!
RequestAnalyticsDto
ƒƒ" 5
>
ƒƒ5 6
.
ƒƒ6 7
Ok
ƒƒ7 9
(
ƒƒ9 :
	analytics
ƒƒ: C
)
ƒƒC D
)
ƒƒD E
;
ƒƒE F
}
≈≈ 	
private
«« 
async
«« 
Task
«« 
<
«« 
IEnumerable
«« &
<
««& '
BudgetAlertDto
««' 5
>
««5 6
>
««6 7"
GetBudgetAlertsAsync
««8 L
(
««L M
)
««M N
{
»» 	
var
…… 
allocations
…… 
=
…… 
await
…… #
_db
……$ '
.
……' (
Allocations
……( 3
.
   
Include
   
(
   
a
   
=>
   
a
   
.
    

Department
    *
)
  * +
.
ÀÀ 
Include
ÀÀ 
(
ÀÀ 
a
ÀÀ 
=>
ÀÀ 
a
ÀÀ 
.
ÀÀ  
Category
ÀÀ  (
)
ÀÀ( )
.
ÃÃ 
ToListAsync
ÃÃ 
(
ÃÃ 
)
ÃÃ 
;
ÃÃ 
var
ŒŒ 
alerts
ŒŒ 
=
ŒŒ 
new
ŒŒ 
List
ŒŒ !
<
ŒŒ! "
BudgetAlertDto
ŒŒ" 0
>
ŒŒ0 1
(
ŒŒ1 2
)
ŒŒ2 3
;
ŒŒ3 4
foreach
–– 
(
–– 
var
–– 

allocation
–– #
in
––$ &
allocations
––' 2
)
––2 3
{
—— 
var
““ #
utilizationPercentage
““ )
=
““* +

allocation
““, 6
.
““6 7
Amount
““7 =
>
““> ?
$num
““@ A
?
““B C
(
““D E

allocation
““E O
.
““O P
Spent
““P U
/
““V W

allocation
““X b
.
““b c
Amount
““c i
)
““i j
*
““k l
$num
““m p
:
““q r
$num
““s t
;
““t u
var
”” !
thresholdPercentage
”” '
=
””( )

allocation
””* 4
.
””4 5
Category
””5 =
.
””= >
ThresholdPercent
””> N
;
””N O
if
’’ 
(
’’ #
utilizationPercentage
’’ )
>=
’’* ,!
thresholdPercentage
’’- @
)
’’@ A
{
÷÷ 
alerts
◊◊ 
.
◊◊ 
Add
◊◊ 
(
◊◊ 
new
◊◊ "
BudgetAlertDto
◊◊# 1
{
ÿÿ 
DepartmentId
ŸŸ $
=
ŸŸ% &

allocation
ŸŸ' 1
.
ŸŸ1 2
DepartmentId
ŸŸ2 >
,
ŸŸ> ?
DepartmentName
⁄⁄ &
=
⁄⁄' (

allocation
⁄⁄) 3
.
⁄⁄3 4

Department
⁄⁄4 >
.
⁄⁄> ?
Name
⁄⁄? C
,
⁄⁄C D

CategoryId
€€ "
=
€€# $

allocation
€€% /
.
€€/ 0

CategoryId
€€0 :
,
€€: ;
CategoryName
‹‹ $
=
‹‹% &

allocation
‹‹' 1
.
‹‹1 2
Category
‹‹2 :
.
‹‹: ;
Name
‹‹; ?
,
‹‹? @
AllocatedAmount
›› '
=
››( )

allocation
››* 4
.
››4 5
Amount
››5 ;
,
››; <
SpentAmount
ﬁﬁ #
=
ﬁﬁ$ %

allocation
ﬁﬁ& 0
.
ﬁﬁ0 1
Spent
ﬁﬁ1 6
,
ﬁﬁ6 7#
UtilizationPercentage
ﬂﬂ -
=
ﬂﬂ. /
Math
ﬂﬂ0 4
.
ﬂﬂ4 5
Round
ﬂﬂ5 :
(
ﬂﬂ: ;#
utilizationPercentage
ﬂﬂ; P
,
ﬂﬂP Q
$num
ﬂﬂR S
)
ﬂﬂS T
,
ﬂﬂT U!
ThresholdPercentage
‡‡ +
=
‡‡, -!
thresholdPercentage
‡‡. A
,
‡‡A B
	AlertType
·· !
=
··" ##
utilizationPercentage
··$ 9
>
··: ;
$num
··< ?
?
··@ A
$str
··B L
:
··M N
$str
··O ]
,
··] ^
Severity
‚‚  
=
‚‚! "#
utilizationPercentage
‚‚# 8
>
‚‚9 :
$num
‚‚; >
?
‚‚? @
$str
‚‚A G
:
‚‚H I#
utilizationPercentage
‚‚J _
>=
‚‚` b
$num
‚‚c e
?
‚‚f g
$str
‚‚h p
:
‚‚q r
$str
‚‚s x
}
„„ 
)
„„ 
;
„„ 
}
‰‰ 
}
ÂÂ 
return
ÁÁ 
alerts
ÁÁ 
.
ÁÁ 
OrderByDescending
ÁÁ +
(
ÁÁ+ ,
a
ÁÁ, -
=>
ÁÁ. 0
a
ÁÁ1 2
.
ÁÁ2 3#
UtilizationPercentage
ÁÁ3 H
)
ÁÁH I
;
ÁÁI J
}
ËË 	
private
ÍÍ 
static
ÍÍ 
decimal
ÍÍ '
CalculatePerformanceScore
ÍÍ 8
(
ÍÍ8 9"
DepartmentSummaryDto
ÍÍ9 M

department
ÍÍN X
)
ÍÍX Y
{
ÎÎ 	
if
ÏÏ 
(
ÏÏ 

department
ÏÏ 
.
ÏÏ 
TotalAllocation
ÏÏ *
==
ÏÏ+ -
$num
ÏÏ. /
)
ÏÏ/ 0
return
ÏÏ1 7
$num
ÏÏ8 9
;
ÏÏ9 :
var
ÓÓ 
utilizationRate
ÓÓ 
=
ÓÓ  !

department
ÓÓ" ,
.
ÓÓ, -

TotalSpent
ÓÓ- 7
/
ÓÓ8 9

department
ÓÓ: D
.
ÓÓD E
TotalAllocation
ÓÓE T
;
ÓÓT U
if
 
(
 
utilizationRate
 
>=
  "
$num
# '
&&
( *
utilizationRate
+ :
<=
; =
$num
> B
)
B C
return
ÒÒ 
$num
ÒÒ 
;
ÒÒ 
else
ÚÚ 
if
ÚÚ 
(
ÚÚ 
utilizationRate
ÚÚ $
<
ÚÚ% &
$num
ÚÚ' +
)
ÚÚ+ ,
return
ÛÛ 
utilizationRate
ÛÛ &
*
ÛÛ' (
$num
ÛÛ) -
+
ÛÛ. /
$num
ÛÛ0 3
;
ÛÛ3 4
else
ÙÙ 
return
ıı 
Math
ıı 
.
ıı 
Max
ıı 
(
ıı  
$num
ıı  !
,
ıı! "
$num
ıı# '
-
ıı( )
(
ıı* +
(
ıı+ ,
utilizationRate
ıı, ;
-
ıı< =
$num
ıı> B
)
ııB C
*
ııD E
$num
ııF J
)
ııJ K
)
ııK L
;
ııL M
}
ˆˆ 	
}
˜˜ 
}¯¯ À"
eD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Controllers\DashboardsController.cs
	namespace		 	"
BudgetManagementSystem		
  
.		  !
Api		! $
.		$ %
Controllers		% 0
{

 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class  
DashboardsController %
:& '
ControllerBase( 6
{ 
private 
readonly 
IAllocationService +
_allocations, 8
;8 9
public  
DashboardsController #
(# $
IAllocationService$ 6
allocations7 B
)B C
=>D F
_allocationsG S
=T U
allocationsV a
;a b
[ 	
HttpGet	 
( 
$str 
) 
] 
[ 	
	Authorize	 
( 
Roles 
= 
nameof !
(! "
UserRole" *
.* +
DepartmentHead+ 9
)9 :
): ;
]; <
public 
async 
Task 
< 
ActionResult &
<& '
ApiResponse' 2
<2 3 
DepartmentSummaryDto3 G
>G H
>H I
>I J
DepartmentSummaryK \
(\ ]
)] ^
{ 	
var 
depIdStr 
= 
User 
.  
	FindFirst  )
() *
$str* /
)/ 0
?0 1
.1 2
Value2 7
;7 8
if 
( 
string 
. 
IsNullOrWhiteSpace )
() *
depIdStr* 2
)2 3
)3 4
return5 ;

BadRequest< F
(F G
ApiResponseG R
<R S 
DepartmentSummaryDtoS g
>g h
.h i
Faili m
(m n
$str	n Ü
)
Ü á
)
á à
;
à â
var 
depId 
= 
int 
. 
Parse !
(! "
depIdStr" *
)* +
;+ ,
var 
summary 
= 
await 
_allocations  ,
., -%
GetDepartmentSummaryAsync- F
(F G
depIdG L
)L M
;M N
return 
Ok 
( 
ApiResponse !
<! " 
DepartmentSummaryDto" 6
>6 7
.7 8
Ok8 :
(: ;
summary; B
)B C
)C D
;D E
} 	
[   	
HttpGet  	 
(   
$str   
)   
]   
[!! 	
	Authorize!!	 
(!! 
Roles!! 
=!! 
nameof!! !
(!!! "
UserRole!!" *
.!!* +

Management!!+ 5
)!!5 6
+!!7 8
$str!!9 <
+!!= >
nameof!!? E
(!!E F
UserRole!!F N
.!!N O
FinanceAdmin!!O [
)!![ \
)!!\ ]
]!!] ^
public"" 
async"" 
Task"" 
<"" 
ActionResult"" &
<""& '
ApiResponse""' 2
<""2 3 
ManagementSummaryDto""3 G
>""G H
>""H I
>""I J
ManagementSummary""K \
(""\ ]
[""] ^
	FromQuery""^ g
]""g h
int""i l
?""l m

categoryId""n x
,""x y
[""z {
	FromQuery	""{ Ñ
]
""Ñ Ö
int
""Ü â
?
""â ä
departmentId
""ã ó
)
""ó ò
{## 	
var$$ 
summary$$ 
=$$ 
await$$ 
_allocations$$  ,
.$$, -%
GetManagementSummaryAsync$$- F
($$F G

categoryId$$G Q
,$$Q R
departmentId$$S _
)$$_ `
;$$` a
return%% 
Ok%% 
(%% 
ApiResponse%% !
<%%! " 
ManagementSummaryDto%%" 6
>%%6 7
.%%7 8
Ok%%8 :
(%%: ;
summary%%; B
)%%B C
)%%C D
;%%D E
}&& 	
}'' 
}(( æ<
eD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Controllers\CategoriesController.cs
	namespace		 	"
BudgetManagementSystem		
  
.		  !
Api		! $
.		$ %
Controllers		% 0
{

 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class  
CategoriesController %
:& '
ControllerBase( 6
{ 
private 
readonly 
ICategoryService )
_service* 2
;2 3
public  
CategoriesController #
(# $
ICategoryService$ 4
service5 <
)< =
=>> @
_serviceA I
=J K
serviceL S
;S T
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
ApiResponse' 2
<2 3
IEnumerable3 >
<> ?
CategoryResponseDto? R
>R S
>S T
>T U
>U V
GetAllW ]
(] ^
)^ _
{ 	
var 
list 
= 
await 
_service %
.% &
GetAllAsync& 1
(1 2
)2 3
;3 4
return 
Ok 
( 
ApiResponse !
<! "
IEnumerable" -
<- .
CategoryResponseDto. A
>A B
>B C
.C D
OkD F
(F G
listG K
)K L
)L M
;M N
} 	
[ 	
HttpPost	 
] 
[ 	
	Authorize	 
( 
Roles 
= 
nameof !
(! "
UserRole" *
.* +
FinanceAdmin+ 7
)7 8
)8 9
]9 :
public 
async 
Task 
< 
ActionResult &
<& '
ApiResponse' 2
<2 3
CategoryResponseDto3 F
>F G
>G H
>H I
CreateJ P
(P Q
[Q R
FromBodyR Z
]Z [
CategoryCreateDto\ m
dton q
)q r
{ 	
if 
( 
! 

ModelState 
. 
IsValid #
)# $
return% +

BadRequest, 6
(6 7
ApiResponse7 B
<B C
CategoryResponseDtoC V
>V W
.W X
FailX \
(\ ]
$str] p
,p q

ModelStater |
)| }
)} ~
;~ 
var   
userId   
=   
int   
.   
Parse   "
(  " #
User  # '
.  ' (
FindFirstValue  ( 6
(  6 7

ClaimTypes  7 A
.  A B
NameIdentifier  B P
)  P Q
!  Q R
)  R S
;  S T
var!! 
result!! 
=!! 
await!! 
_service!! '
.!!' (
CreateAsync!!( 3
(!!3 4
dto!!4 7
,!!7 8
userId!!9 ?
)!!? @
;!!@ A
return"" 
Ok"" 
("" 
ApiResponse"" !
<""! "
CategoryResponseDto""" 5
>""5 6
.""6 7
Ok""7 9
(""9 :
result"": @
,""@ A
$str""B R
)""R S
)""S T
;""T U
}## 	
[%% 	
HttpPut%%	 
(%% 
$str%% 
)%% 
]%% 
[&& 	
	Authorize&&	 
(&& 
Roles&& 
=&& 
nameof&& !
(&&! "
UserRole&&" *
.&&* +
FinanceAdmin&&+ 7
)&&7 8
)&&8 9
]&&9 :
public'' 
async'' 
Task'' 
<'' 
ActionResult'' &
<''& '
ApiResponse''' 2
<''2 3
CategoryResponseDto''3 F
>''F G
>''G H
>''H I
Update''J P
(''P Q
[''Q R
	FromRoute''R [
]''[ \
int''] `
id''a c
,''c d
[''e f
FromBody''f n
]''n o
CategoryUpdateDto	''p Å
dto
''Ç Ö
)
''Ö Ü
{(( 	
if)) 
()) 
id)) 
!=)) 
dto)) 
.)) 
Id)) 
))) 
return)) $

BadRequest))% /
())/ 0
ApiResponse))0 ;
<)); <
CategoryResponseDto))< O
>))O P
.))P Q
Fail))Q U
())U V
$str))V e
)))e f
)))f g
;))g h
if** 
(** 
!** 

ModelState** 
.** 
IsValid** #
)**# $
return**% +

BadRequest**, 6
(**6 7
ApiResponse**7 B
<**B C
CategoryResponseDto**C V
>**V W
.**W X
Fail**X \
(**\ ]
$str**] p
,**p q

ModelState**r |
)**| }
)**} ~
;**~ 
var++ 
userId++ 
=++ 
int++ 
.++ 
Parse++ "
(++" #
User++# '
.++' (
FindFirstValue++( 6
(++6 7

ClaimTypes++7 A
.++A B
NameIdentifier++B P
)++P Q
!++Q R
)++R S
;++S T
var,, 
result,, 
=,, 
await,, 
_service,, '
.,,' (
UpdateAsync,,( 3
(,,3 4
dto,,4 7
,,,7 8
userId,,9 ?
),,? @
;,,@ A
return-- 
Ok-- 
(-- 
ApiResponse-- !
<--! "
CategoryResponseDto--" 5
>--5 6
.--6 7
Ok--7 9
(--9 :
result--: @
,--@ A
$str--B T
)--T U
)--U V
;--V W
}.. 	
[00 	

HttpDelete00	 
(00 
$str00 
)00 
]00  
[11 	
	Authorize11	 
(11 
Roles11 
=11 
nameof11 !
(11! "
UserRole11" *
.11* +
FinanceAdmin11+ 7
)117 8
)118 9
]119 :
public22 
async22 
Task22 
<22 
ActionResult22 &
<22& '
ApiResponse22' 2
<222 3
object223 9
>229 :
>22: ;
>22; <
Delete22= C
(22C D
[22D E
	FromRoute22E N
]22N O
int22P S
id22T V
)22V W
{33 	
var44 
userId44 
=44 
int44 
.44 
Parse44 "
(44" #
User44# '
.44' (
FindFirstValue44( 6
(446 7

ClaimTypes447 A
.44A B
NameIdentifier44B P
)44P Q
!44Q R
)44R S
;44S T
await55 
_service55 
.55 
DeleteAsync55 &
(55& '
id55' )
,55) *
userId55+ 1
)551 2
;552 3
return66 
Ok66 
(66 
ApiResponse66 !
<66! "
object66" (
>66( )
.66) *
Ok66* ,
(66, -
new66- 0
{661 2
id663 5
}666 7
,667 8
$str669 K
)66K L
)66L M
;66M N
}77 	
};; 
}<< ã
_D:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Controllers\AuthController.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Controllers% 0
{		 
[

 
ApiController

 
]

 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
AuthController 
:  !
ControllerBase" 0
{ 
private 
readonly 
IAuthService %
_auth& +
;+ ,
public 
AuthController 
( 
IAuthService *
auth+ /
)/ 0
=>1 3
_auth4 9
=: ;
auth< @
;@ A
[ 	
HttpPost	 
( 
$str 
) 
] 
[ 	
AllowAnonymous	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
ApiResponse' 2
<2 3
LoginResponse3 @
>@ A
>A B
>B C
LoginD I
(I J
[J K
FromBodyK S
]S T
LoginRequestU a
requestb i
)i j
{ 	
if 
( 
! 

ModelState 
. 
IsValid #
)# $
return% +

BadRequest, 6
(6 7
ApiResponse7 B
<B C
LoginResponseC P
>P Q
.Q R
FailR V
(V W
$strW j
,j k

ModelStatel v
)v w
)w x
;x y
var 
result 
= 
await 
_auth $
.$ %

LoginAsync% /
(/ 0
request0 7
)7 8
;8 9
return 
Ok 
( 
ApiResponse !
<! "
LoginResponse" /
>/ 0
.0 1
Ok1 3
(3 4
result4 :
,: ;
$str< N
)N O
)O P
;P Q
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
[ 	
	Authorize	 
] 
public 
ActionResult 
< 
ApiResponse '
<' (
object( .
>. /
>/ 0
Me1 3
(3 4
)4 5
{ 	
var 
userId 
= 
User 
. 
FindFirstValue ,
(, -

ClaimTypes- 7
.7 8
NameIdentifier8 F
)F G
;G H
var   
role   
=   
User   
.   
FindFirstValue   *
(  * +

ClaimTypes  + 5
.  5 6
Role  6 :
)  : ;
;  ; <
var!! 
dep!! 
=!! 
User!! 
.!! 
	FindFirst!! $
(!!$ %
$str!!% *
)!!* +
?!!+ ,
.!!, -
Value!!- 2
;!!2 3
return"" 
Ok"" 
("" 
ApiResponse"" !
<""! "
object""" (
>""( )
."") *
Ok""* ,
("", -
new""- 0
{""1 2
userId""3 9
,""9 :
role""; ?
,""? @
departmentId""A M
=""N O
dep""P S
}""T U
)""U V
)""V W
;""W X
}## 	
}$$ 
}%% ¶Ì
fD:\Simple Budget Allocation Tool Micro\BudgetManagementSystem.Api\Controllers\AllocationsController.cs
	namespace 	"
BudgetManagementSystem
  
.  !
Api! $
.$ %
Controllers% 0
{ 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class !
AllocationsController &
:' (
ControllerBase) 7
{ 
private 
readonly 
IAllocationService +
_service, 4
;4 5
private 
readonly 
AppDbContext %
_db& )
;) *
private 
readonly 
ILogger  
<  !!
AllocationsController! 6
>6 7
_logger8 ?
;? @
public !
AllocationsController $
($ %
IAllocationService% 7
service8 ?
,? @
AppDbContextA M
dbN P
,P Q
ILoggerR Y
<Y Z!
AllocationsControllerZ o
>o p
loggerq w
)w x
{ 	
_service 
= 
service 
; 
_db 
= 
db 
; 
_logger 
= 
logger 
; 
} 	
[!! 	
HttpPost!!	 
]!! 
["" 	
	Authorize""	 
("" 
Roles"" 
="" 
nameof"" !
(""! "
UserRole""" *
.""* +
FinanceAdmin""+ 7
)""7 8
)""8 9
]""9 :
public## 
async## 
Task## 
<## 
ActionResult## &
<##& '
ApiResponse##' 2
<##2 3!
AllocationResponseDto##3 H
>##H I
>##I J
>##J K
Create##L R
(##R S
[##S T
FromBody##T \
]##\ ]
AllocationCreateDto##^ q
dto##r u
)##u v
{$$ 	
try%% 
{&& 
if'' 
('' 
!'' 

ModelState'' 
.''  
IsValid''  '
)''' (
return(( 

BadRequest(( %
(((% &
ApiResponse((& 1
<((1 2!
AllocationResponseDto((2 G
>((G H
.((H I
Fail((I M
(((M N
$str((N a
,((a b

ModelState((c m
)((m n
)((n o
;((o p
var** 
userId** 
=** 
int**  
.**  !
Parse**! &
(**& '
User**' +
.**+ ,
FindFirstValue**, :
(**: ;

ClaimTypes**; E
.**E F
NameIdentifier**F T
)**T U
!**U V
)**V W
;**W X
var++ 
result++ 
=++ 
await++ "
_service++# +
.+++ ,
CreateAsync++, 7
(++7 8
dto++8 ;
,++; <
userId++= C
)++C D
;++D E
_logger-- 
.-- 
LogInformation-- &
(--& '
$str	--' é
,
--é è
userId.. 
,.. 
dto.. 
...  
DepartmentId..  ,
,.., -
dto... 1
...1 2

CategoryId..2 <
)..< =
;..= >
return00 
Ok00 
(00 
ApiResponse00 %
<00% &!
AllocationResponseDto00& ;
>00; <
.00< =
Ok00= ?
(00? @
result00@ F
,00F G
$str00H i
)00i j
)00j k
;00k l
}11 
catch22 
(22 
	Exception22 
ex22 
)22  
{33 
_logger44 
.44 
LogError44  
(44  !
ex44! #
,44# $
$str44% u
,44u v
dto55 
?55 
.55 
DepartmentId55 %
,55% &
dto55' *
?55* +
.55+ ,

CategoryId55, 6
)556 7
;557 8
return66 

StatusCode66 !
(66! "
$num66" %
,66% &
ApiResponse66' 2
<662 3!
AllocationResponseDto663 H
>66H I
.66I J
Fail66J N
(66N O
$str66O |
)66| }
)66} ~
;66~ 
}77 
}88 	
[>> 	
HttpGet>>	 
(>> 
$str>> 0
)>>0 1
]>>1 2
[?? 	
	Authorize??	 
]?? 
public@@ 
async@@ 
Task@@ 
<@@ 
ActionResult@@ &
<@@& '
ApiResponse@@' 2
<@@2 3
IEnumerable@@3 >
<@@> ?!
AllocationResponseDto@@? T
>@@T U
>@@U V
>@@V W
>@@W X
GetByDepartment@@Y h
(@@h i
[@@i j
	FromRoute@@j s
]@@s t
int@@u x
departmentId	@@y Ö
)
@@Ö Ü
{AA 	
tryBB 
{CC 
varEE 
userRoleEE 
=EE 
UserEE #
.EE# $
FindFirstValueEE$ 2
(EE2 3

ClaimTypesEE3 =
.EE= >
RoleEE> B
)EEB C
;EEC D
varFF 
userDepartmentIdFF $
=FF% &
UserFF' +
.FF+ ,
FindFirstValueFF, :
(FF: ;
$strFF; I
)FFI J
;FFJ K
_loggerHH 
.HH 
LogInformationHH &
(HH& '
$str	HH' °
,
HH° ¢
userRoleII 
,II 
userDepartmentIdII .
,II. /
departmentIdII0 <
)II< =
;II= >
varVV 
listVV 
=VV 
awaitVV  
_serviceVV! )
.VV) * 
GetByDepartmentAsyncVV* >
(VV> ?
departmentIdVV? K
)VVK L
;VVL M
_loggerXX 
.XX 
LogInformationXX &
(XX& '
$strXX' d
,XXd e
listYY 
?YY 
.YY 
CountYY 
(YY  
)YY  !
??YY" $
$numYY% &
,YY& '
departmentIdYY( 4
)YY4 5
;YY5 6
return[[ 
Ok[[ 
([[ 
ApiResponse[[ %
<[[% &
IEnumerable[[& 1
<[[1 2!
AllocationResponseDto[[2 G
>[[G H
>[[H I
.[[I J
Ok[[J L
([[L M
list[[M Q
)[[Q R
)[[R S
;[[S T
}\\ 
catch]] 
(]] 
	Exception]] 
ex]] 
)]]  
{^^ 
_logger__ 
.__ 
LogError__  
(__  !
ex__! #
,__# $
$str__% a
,__a b
departmentId__c o
)__o p
;__p q
return`` 

StatusCode`` !
(``! "
$num``" %
,``% &
ApiResponse``' 2
<``2 3
IEnumerable``3 >
<``> ?!
AllocationResponseDto``? T
>``T U
>``U V
.``V W
Fail``W [
(``[ \
$str	``\ å
)
``å ç
)
``ç é
;
``é è
}aa 
}bb 	
[hh 	
HttpPuthh	 
(hh 
$strhh 
)hh 
]hh 
[ii 	
	Authorizeii	 
(ii 
Rolesii 
=ii 
nameofii !
(ii! "
UserRoleii" *
.ii* +
FinanceAdminii+ 7
)ii7 8
)ii8 9
]ii9 :
publicjj 
asyncjj 
Taskjj 
<jj 
ActionResultjj &
<jj& '
ApiResponsejj' 2
<jj2 3!
AllocationResponseDtojj3 H
>jjH I
>jjI J
>jjJ K
UpdatejjL R
(jjR S
[jjS T
	FromRoutejjT ]
]jj] ^
intjj_ b
idjjc e
,jje f
[jjg h
FromBodyjjh p
]jjp q 
AllocationUpdateDto	jjr Ö
dto
jjÜ â
)
jjâ ä
{kk 	
tryll 
{mm 
ifnn 
(nn 
!nn 

ModelStatenn 
.nn  
IsValidnn  '
)nn' (
returnoo 

BadRequestoo %
(oo% &
ApiResponseoo& 1
<oo1 2!
AllocationResponseDtooo2 G
>ooG H
.ooH I
FailooI M
(ooM N
$strooN a
,ooa b

ModelStateooc m
)oom n
)oon o
;ooo p
varqq 
userIdqq 
=qq 
intqq  
.qq  !
Parseqq! &
(qq& '
Userqq' +
.qq+ ,
FindFirstValueqq, :
(qq: ;

ClaimTypesqq; E
.qqE F
NameIdentifierqqF T
)qqT U
!qqU V
)qqV W
;qqW X
vartt 
existingAllocationtt &
=tt' (
awaittt) .
_dbtt/ 2
.tt2 3
Allocationstt3 >
.uu 
Includeuu 
(uu 
auu 
=>uu !
auu" #
.uu# $

Departmentuu$ .
)uu. /
.vv 
Includevv 
(vv 
avv 
=>vv !
avv" #
.vv# $
Categoryvv$ ,
)vv, -
.ww 
FirstOrDefaultAsyncww (
(ww( )
aww) *
=>ww+ -
aww. /
.ww/ 0
Idww0 2
==ww3 5
idww6 8
)ww8 9
;ww9 :
ifyy 
(yy 
existingAllocationyy &
==yy' )
nullyy* .
)yy. /
{zz 
return{{ 
NotFound{{ #
({{# $
ApiResponse{{$ /
<{{/ 0!
AllocationResponseDto{{0 E
>{{E F
.{{F G
Fail{{G K
({{K L
$"{{L N
$str{{N a
{{{a b
id{{b d
}{{d e
$str{{e o
"{{o p
){{p q
){{q r
;{{r s
}|| 
var~~ 
result~~ 
=~~ 
await~~ "
_service~~# +
.~~+ ,
UpdateAsync~~, 7
(~~7 8
id~~8 :
,~~: ;
dto~~< ?
,~~? @
userId~~A G
)~~G H
;~~H I
_logger
ÄÄ 
.
ÄÄ 
LogInformation
ÄÄ &
(
ÄÄ& '
$str
ÄÄ' h
,
ÄÄh i
id
ÄÄj l
,
ÄÄl m
userId
ÄÄn t
)
ÄÄt u
;
ÄÄu v
await
ÉÉ %
CreateNotificationAsync
ÉÉ -
(
ÉÉ- .

targetRole
ÑÑ 
:
ÑÑ 
$"
ÑÑ  "
$str
ÑÑ" -
{
ÑÑ- . 
existingAllocation
ÑÑ. @
.
ÑÑ@ A
DepartmentId
ÑÑA M
}
ÑÑM N
"
ÑÑN O
,
ÑÑO P
title
ÖÖ 
:
ÖÖ 
$str
ÖÖ 6
,
ÖÖ6 7
message
ÜÜ 
:
ÜÜ 
$"
ÜÜ 
$str
ÜÜ :
{
ÜÜ: ; 
existingAllocation
ÜÜ; M
.
ÜÜM N
Category
ÜÜN V
.
ÜÜV W
Name
ÜÜW [
}
ÜÜ[ \
$str
ÜÜ\ q
{
ÜÜq r
dto
ÜÜr u
.
ÜÜu v
Amount
ÜÜv |
:
ÜÜ| }
$str
ÜÜ} ~
}
ÜÜ~ 
"ÜÜ Ä
)
áá 
;
áá 
return
ââ 
Ok
ââ 
(
ââ 
ApiResponse
ââ %
<
ââ% &#
AllocationResponseDto
ââ& ;
>
ââ; <
.
ââ< =
Ok
ââ= ?
(
ââ? @
result
ââ@ F
,
ââF G
$str
ââH i
)
ââi j
)
ââj k
;
ââk l
}
ää 
catch
ãã 
(
ãã 
ArgumentException
ãã $
ex
ãã% '
)
ãã' (
{
åå 
_logger
çç 
.
çç 

LogWarning
çç "
(
çç" #
$str
çç# d
,
ççd e
id
ççf h
,
ççh i
ex
ççj l
.
ççl m
Message
ççm t
)
ççt u
;
ççu v
return
éé 

BadRequest
éé !
(
éé! "
ApiResponse
éé" -
<
éé- .#
AllocationResponseDto
éé. C
>
ééC D
.
ééD E
Fail
ééE I
(
ééI J
ex
ééJ L
.
ééL M
Message
ééM T
)
ééT U
)
ééU V
;
ééV W
}
èè 
catch
êê 
(
êê 
	Exception
êê 
ex
êê 
)
êê  
{
ëë 
_logger
íí 
.
íí 
LogError
íí  
(
íí  !
ex
íí! #
,
íí# $
$str
íí% O
,
ííO P
id
ííQ S
)
ííS T
;
ííT U
return
ìì 

StatusCode
ìì !
(
ìì! "
$num
ìì" %
,
ìì% &
ApiResponse
ìì' 2
<
ìì2 3#
AllocationResponseDto
ìì3 H
>
ììH I
.
ììI J
Fail
ììJ N
(
ììN O
$str
ììO |
)
ìì| }
)
ìì} ~
;
ìì~ 
}
îî 
}
ïï 	
[
õõ 	

HttpDelete
õõ	 
(
õõ 
$str
õõ 
)
õõ 
]
õõ  
[
úú 	
	Authorize
úú	 
(
úú 
Roles
úú 
=
úú 
nameof
úú !
(
úú! "
UserRole
úú" *
.
úú* +
FinanceAdmin
úú+ 7
)
úú7 8
)
úú8 9
]
úú9 :
public
ùù 
async
ùù 
Task
ùù 
<
ùù 
ActionResult
ùù &
<
ùù& '
ApiResponse
ùù' 2
<
ùù2 3
object
ùù3 9
>
ùù9 :
>
ùù: ;
>
ùù; <
Delete
ùù= C
(
ùùC D
[
ùùD E
	FromRoute
ùùE N
]
ùùN O
int
ùùP S
id
ùùT V
)
ùùV W
{
ûû 	
try
üü 
{
†† 
var
°° 
userId
°° 
=
°° 
int
°°  
.
°°  !
Parse
°°! &
(
°°& '
User
°°' +
.
°°+ ,
FindFirstValue
°°, :
(
°°: ;

ClaimTypes
°°; E
.
°°E F
NameIdentifier
°°F T
)
°°T U
!
°°U V
)
°°V W
;
°°W X
var
§§ 

allocation
§§ 
=
§§  
await
§§! &
_db
§§' *
.
§§* +
Allocations
§§+ 6
.
•• 
Include
•• 
(
•• 
a
•• 
=>
•• !
a
••" #
.
••# $

Department
••$ .
)
••. /
.
¶¶ 
Include
¶¶ 
(
¶¶ 
a
¶¶ 
=>
¶¶ !
a
¶¶" #
.
¶¶# $
Category
¶¶$ ,
)
¶¶, -
.
ßß !
FirstOrDefaultAsync
ßß (
(
ßß( )
a
ßß) *
=>
ßß+ -
a
ßß. /
.
ßß/ 0
Id
ßß0 2
==
ßß3 5
id
ßß6 8
)
ßß8 9
;
ßß9 :
if
©© 
(
©© 

allocation
©© 
==
©© !
null
©©" &
)
©©& '
{
™™ 
return
´´ 
NotFound
´´ #
(
´´# $
ApiResponse
´´$ /
<
´´/ 0
object
´´0 6
>
´´6 7
.
´´7 8
Fail
´´8 <
(
´´< =
$"
´´= ?
$str
´´? R
{
´´R S
id
´´S U
}
´´U V
$str
´´V `
"
´´` a
)
´´a b
)
´´b c
;
´´c d
}
¨¨ 
if
ØØ 
(
ØØ 

allocation
ØØ 
.
ØØ 
Spent
ØØ $
>
ØØ% &
$num
ØØ' (
)
ØØ( )
{
∞∞ 
_logger
±± 
.
±± 

LogWarning
±± &
(
±±& '
$str
±±' a
,
±±a b
id
±±c e
,
±±e f

allocation
±±g q
.
±±q r
Spent
±±r w
)
±±w x
;
±±x y
}
≤≤ 
await
¥¥ 
_service
¥¥ 
.
¥¥ 
DeleteAsync
¥¥ *
(
¥¥* +
id
¥¥+ -
,
¥¥- .
userId
¥¥/ 5
)
¥¥5 6
;
¥¥6 7
_logger
∂∂ 
.
∂∂ 
LogInformation
∂∂ &
(
∂∂& '
$str
∂∂' j
+
∂∂k l
$str
∑∑ f
,
∑∑f g
id
∏∏ 
,
∏∏ 
userId
∏∏ 
,
∏∏ 

allocation
∏∏  *
.
∏∏* +

Department
∏∏+ 5
.
∏∏5 6
Name
∏∏6 :
,
∏∏: ;

allocation
∏∏< F
.
∏∏F G
Category
∏∏G O
.
∏∏O P
Name
∏∏P T
,
∏∏T U

allocation
∏∏V `
.
∏∏` a
Amount
∏∏a g
,
∏∏g h

allocation
∏∏i s
.
∏∏s t
Spent
∏∏t y
)
∏∏y z
;
∏∏z {
await
ªª %
CreateNotificationAsync
ªª -
(
ªª- .

targetRole
ºº 
:
ºº 
$"
ºº  "
$str
ºº" -
{
ºº- .

allocation
ºº. 8
.
ºº8 9
DepartmentId
ºº9 E
}
ººE F
"
ººF G
,
ººG H
title
ΩΩ 
:
ΩΩ 
$str
ΩΩ 6
,
ΩΩ6 7
message
ææ 
:
ææ 
$"
ææ 
$str
ææ :
{
ææ: ;

allocation
ææ; E
.
ææE F
Category
ææF N
.
ææN O
Name
ææO S
}
ææS T
$str
ææT V
{
ææV W

allocation
ææW a
.
ææa b
Amount
ææb h
:
ææh i
$str
ææi j
}
ææj k
$strææk è
"ææè ê
)
øø 
;
øø 
return
¡¡ 
Ok
¡¡ 
(
¡¡ 
ApiResponse
¡¡ %
<
¡¡% &
object
¡¡& ,
>
¡¡, -
.
¡¡- .
Ok
¡¡. 0
(
¡¡0 1
new
¡¡1 4
{
¡¡5 6
AllocationId
¡¡7 C
=
¡¡D E
id
¡¡F H
}
¡¡I J
,
¡¡J K
$str
¡¡L m
)
¡¡m n
)
¡¡n o
;
¡¡o p
}
¬¬ 
catch
√√ 
(
√√ 
ArgumentException
√√ $
ex
√√% '
)
√√' (
{
ƒƒ 
_logger
≈≈ 
.
≈≈ 

LogWarning
≈≈ "
(
≈≈" #
$str
≈≈# d
,
≈≈d e
id
≈≈f h
,
≈≈h i
ex
≈≈j l
.
≈≈l m
Message
≈≈m t
)
≈≈t u
;
≈≈u v
return
∆∆ 

BadRequest
∆∆ !
(
∆∆! "
ApiResponse
∆∆" -
<
∆∆- .
object
∆∆. 4
>
∆∆4 5
.
∆∆5 6
Fail
∆∆6 :
(
∆∆: ;
ex
∆∆; =
.
∆∆= >
Message
∆∆> E
)
∆∆E F
)
∆∆F G
;
∆∆G H
}
«« 
catch
»» 
(
»» 
	Exception
»» 
ex
»» 
)
»»  
{
…… 
_logger
   
.
   
LogError
    
(
    !
ex
  ! #
,
  # $
$str
  % O
,
  O P
id
  Q S
)
  S T
;
  T U
return
ÀÀ 

StatusCode
ÀÀ !
(
ÀÀ! "
$num
ÀÀ" %
,
ÀÀ% &
ApiResponse
ÀÀ' 2
<
ÀÀ2 3
object
ÀÀ3 9
>
ÀÀ9 :
.
ÀÀ: ;
Fail
ÀÀ; ?
(
ÀÀ? @
$str
ÀÀ@ m
)
ÀÀm n
)
ÀÀn o
;
ÀÀo p
}
ÃÃ 
}
ÕÕ 	
[
”” 	
	HttpPatch
””	 
(
”” 
$str
”” -
)
””- .
]
””. /
[
‘‘ 	
	Authorize
‘‘	 
(
‘‘ 
Roles
‘‘ 
=
‘‘ 
$"
‘‘ 
{
‘‘ 
nameof
‘‘ $
(
‘‘$ %
UserRole
‘‘% -
.
‘‘- .
FinanceAdmin
‘‘. :
)
‘‘: ;
}
‘‘; <
$str
‘‘< =
{
‘‘= >
nameof
‘‘> D
(
‘‘D E
UserRole
‘‘E M
.
‘‘M N
DepartmentHead
‘‘N \
)
‘‘\ ]
}
‘‘] ^
"
‘‘^ _
)
‘‘_ `
]
‘‘` a
public
’’ 
async
’’ 
Task
’’ 
<
’’ 
ActionResult
’’ &
<
’’& '
ApiResponse
’’' 2
<
’’2 3
object
’’3 9
>
’’9 :
>
’’: ;
>
’’; <
UpdateSpent
’’= H
(
’’H I
[
’’I J
	FromRoute
’’J S
]
’’S T
int
’’U X
allocationId
’’Y e
,
’’e f
[
’’g h
	FromQuery
’’h q
]
’’q r
decimal
’’s z
newSpent’’{ É
)’’É Ñ
{
÷÷ 	
try
◊◊ 
{
ÿÿ 
if
ŸŸ 
(
ŸŸ 
newSpent
ŸŸ 
<
ŸŸ 
$num
ŸŸ  
)
ŸŸ  !
{
⁄⁄ 
return
€€ 

BadRequest
€€ %
(
€€% &
ApiResponse
€€& 1
<
€€1 2
object
€€2 8
>
€€8 9
.
€€9 :
Fail
€€: >
(
€€> ?
$str
€€? `
)
€€` a
)
€€a b
;
€€b c
}
‹‹ 
var
ﬁﬁ 
userId
ﬁﬁ 
=
ﬁﬁ 
int
ﬁﬁ  
.
ﬁﬁ  !
Parse
ﬁﬁ! &
(
ﬁﬁ& '
User
ﬁﬁ' +
.
ﬁﬁ+ ,
FindFirstValue
ﬁﬁ, :
(
ﬁﬁ: ;

ClaimTypes
ﬁﬁ; E
.
ﬁﬁE F
NameIdentifier
ﬁﬁF T
)
ﬁﬁT U
!
ﬁﬁU V
)
ﬁﬁV W
;
ﬁﬁW X
var
ﬂﬂ 
userRole
ﬂﬂ 
=
ﬂﬂ 
User
ﬂﬂ #
.
ﬂﬂ# $
FindFirstValue
ﬂﬂ$ 2
(
ﬂﬂ2 3

ClaimTypes
ﬂﬂ3 =
.
ﬂﬂ= >
Role
ﬂﬂ> B
)
ﬂﬂB C
;
ﬂﬂC D
var
‡‡ 
userDepartmentId
‡‡ $
=
‡‡% &
User
‡‡' +
.
‡‡+ ,
FindFirstValue
‡‡, :
(
‡‡: ;
$str
‡‡; I
)
‡‡I J
;
‡‡J K
var
„„ 

allocation
„„ 
=
„„  
await
„„! &
_db
„„' *
.
„„* +
Allocations
„„+ 6
.
‰‰ 
Include
‰‰ 
(
‰‰ 
a
‰‰ 
=>
‰‰ !
a
‰‰" #
.
‰‰# $

Department
‰‰$ .
)
‰‰. /
.
ÂÂ 
Include
ÂÂ 
(
ÂÂ 
a
ÂÂ 
=>
ÂÂ !
a
ÂÂ" #
.
ÂÂ# $
Category
ÂÂ$ ,
)
ÂÂ, -
.
ÊÊ !
FirstOrDefaultAsync
ÊÊ (
(
ÊÊ( )
a
ÊÊ) *
=>
ÊÊ+ -
a
ÊÊ. /
.
ÊÊ/ 0
Id
ÊÊ0 2
==
ÊÊ3 5
allocationId
ÊÊ6 B
)
ÊÊB C
;
ÊÊC D
if
ËË 
(
ËË 

allocation
ËË 
==
ËË !
null
ËË" &
)
ËË& '
{
ÈÈ 
return
ÍÍ 
NotFound
ÍÍ #
(
ÍÍ# $
ApiResponse
ÍÍ$ /
<
ÍÍ/ 0
object
ÍÍ0 6
>
ÍÍ6 7
.
ÍÍ7 8
Fail
ÍÍ8 <
(
ÍÍ< =
$"
ÍÍ= ?
$str
ÍÍ? R
{
ÍÍR S
allocationId
ÍÍS _
}
ÍÍ_ `
$str
ÍÍ` j
"
ÍÍj k
)
ÍÍk l
)
ÍÍl m
;
ÍÍm n
}
ÎÎ 
if
ÓÓ 
(
ÓÓ 
userRole
ÓÓ 
==
ÓÓ 
nameof
ÓÓ  &
(
ÓÓ& '
UserRole
ÓÓ' /
.
ÓÓ/ 0
DepartmentHead
ÓÓ0 >
)
ÓÓ> ?
)
ÓÓ? @
{
ÔÔ 
if
 
(
 
string
 
.
 
IsNullOrEmpty
 ,
(
, -
userDepartmentId
- =
)
= >
||
? A
int
B E
.
E F
Parse
F K
(
K L
userDepartmentId
L \
)
\ ]
!=
^ `

allocation
a k
.
k l
DepartmentId
l x
)
x y
{
ÒÒ 
return
ÛÛ 

StatusCode
ÛÛ )
(
ÛÛ) *
$num
ÛÛ* -
,
ÛÛ- .
ApiResponse
ÛÛ/ :
<
ÛÛ: ;
object
ÛÛ; A
>
ÛÛA B
.
ÛÛB C
Fail
ÛÛC G
(
ÛÛG H
$str
ÙÙ o
)
ıı 
)
ıı 
;
ıı 
}
ˆˆ 
}
˜˜ 
var
˘˘ 
oldSpent
˘˘ 
=
˘˘ 

allocation
˘˘ )
.
˘˘) *
Spent
˘˘* /
;
˘˘/ 0
await
˙˙ 
_service
˙˙ 
.
˙˙ 
UpdateSpentAsync
˙˙ /
(
˙˙/ 0
allocationId
˙˙0 <
,
˙˙< =
newSpent
˙˙> F
,
˙˙F G
userId
˙˙H N
)
˙˙N O
;
˙˙O P
_logger
¸¸ 
.
¸¸ 
LogInformation
¸¸ &
(
¸¸& '
$str¸¸' ì
,¸¸ì î
allocationId
˝˝  
,
˝˝  !
oldSpent
˝˝" *
,
˝˝* +
newSpent
˝˝, 4
,
˝˝4 5
userId
˝˝6 <
,
˝˝< =
userRole
˝˝> F
)
˝˝F G
;
˝˝G H
if
ÄÄ 
(
ÄÄ 
userRole
ÄÄ 
==
ÄÄ 
nameof
ÄÄ  &
(
ÄÄ& '
UserRole
ÄÄ' /
.
ÄÄ/ 0
DepartmentHead
ÄÄ0 >
)
ÄÄ> ?
)
ÄÄ? @
{
ÅÅ 
await
ÇÇ %
CreateNotificationAsync
ÇÇ 1
(
ÇÇ1 2

targetRole
ÉÉ "
:
ÉÉ" #
nameof
ÉÉ$ *
(
ÉÉ* +
UserRole
ÉÉ+ 3
.
ÉÉ3 4
FinanceAdmin
ÉÉ4 @
)
ÉÉ@ A
,
ÉÉA B
title
ÑÑ 
:
ÑÑ 
$str
ÑÑ <
,
ÑÑ< =
message
ÖÖ 
:
ÖÖ  
$"
ÖÖ! #
$str
ÖÖ# .
{
ÖÖ. /

allocation
ÖÖ/ 9
.
ÖÖ9 :

Department
ÖÖ: D
.
ÖÖD E
Name
ÖÖE I
}
ÖÖI J
$str
ÖÖJ `
{
ÖÖ` a

allocation
ÖÖa k
.
ÖÖk l
Category
ÖÖl t
.
ÖÖt u
Name
ÖÖu y
}
ÖÖy z
$str
ÖÖz |
{
ÖÖ| }
oldSpentÖÖ} Ö
:ÖÖÖ Ü
$strÖÖÜ á
}ÖÖá à
$strÖÖà ã
{ÖÖã å
newSpentÖÖå î
:ÖÖî ï
$strÖÖï ñ
}ÖÖñ ó
"ÖÖó ò
)
ÜÜ 
;
ÜÜ 
}
áá 
return
ââ 
Ok
ââ 
(
ââ 
ApiResponse
ââ %
<
ââ% &
object
ââ& ,
>
ââ, -
.
ââ- .
Ok
ââ. 0
(
ââ0 1
new
ââ1 4
{
ää 
AllocationId
ãã  
=
ãã! "
allocationId
ãã# /
,
ãã/ 0
OldSpent
åå 
=
åå 
oldSpent
åå '
,
åå' (
NewSpent
çç 
=
çç 
newSpent
çç '
,
çç' (
	Remaining
éé 
=
éé 

allocation
éé  *
.
éé* +
Amount
éé+ 1
-
éé2 3
newSpent
éé4 <
,
éé< =
	UpdatedBy
èè 
=
èè 
userRole
èè  (
}
êê 
,
êê 
$str
êê 6
)
êê6 7
)
êê7 8
;
êê8 9
}
ëë 
catch
íí 
(
íí 
ArgumentException
íí $
ex
íí% '
)
íí' (
{
ìì 
_logger
îî 
.
îî 

LogWarning
îî "
(
îî" #
$str
îî# b
,
îîb c
allocationId
îîd p
,
îîp q
ex
îîr t
.
îît u
Message
îîu |
)
îî| }
;
îî} ~
return
ïï 

BadRequest
ïï !
(
ïï! "
ApiResponse
ïï" -
<
ïï- .
object
ïï. 4
>
ïï4 5
.
ïï5 6
Fail
ïï6 :
(
ïï: ;
ex
ïï; =
.
ïï= >
Message
ïï> E
)
ïïE F
)
ïïF G
;
ïïG H
}
ññ 
catch
óó 
(
óó 
	Exception
óó 
ex
óó 
)
óó  
{
òò 
_logger
ôô 
.
ôô 
LogError
ôô  
(
ôô  !
ex
ôô! #
,
ôô# $
$str
ôô% `
,
ôô` a
allocationId
ôôb n
)
ôôn o
;
ôôo p
return
öö 

StatusCode
öö !
(
öö! "
$num
öö" %
,
öö% &
ApiResponse
öö' 2
<
öö2 3
object
öö3 9
>
öö9 :
.
öö: ;
Fail
öö; ?
(
öö? @
$str
öö@ o
)
ööo p
)
ööp q
;
ööq r
}
õõ 
}
úú 	
[
¢¢ 	
HttpPut
¢¢	 
(
¢¢ 
$str
¢¢ +
)
¢¢+ ,
]
¢¢, -
[
££ 	
	Authorize
££	 
(
££ 
Roles
££ 
=
££ 
$"
££ 
{
££ 
nameof
££ $
(
££$ %
UserRole
££% -
.
££- .
FinanceAdmin
££. :
)
££: ;
}
££; <
$str
££< =
{
££= >
nameof
££> D
(
££D E
UserRole
££E M
.
££M N
DepartmentHead
££N \
)
££\ ]
}
££] ^
"
££^ _
)
££_ `
]
££` a
public
§§ 
async
§§ 
Task
§§ 
<
§§ 
ActionResult
§§ &
<
§§& '
ApiResponse
§§' 2
<
§§2 3
object
§§3 9
>
§§9 :
>
§§: ;
>
§§; <!
UpdateSpentWithBody
§§= P
(
§§P Q
[
§§Q R
	FromRoute
§§R [
]
§§[ \
int
§§] `
allocationId
§§a m
,
§§m n
[
§§o p
FromBody
§§p x
]
§§x y
UpdateSpentDto§§z à
dto§§â å
)§§å ç
{
•• 	
try
¶¶ 
{
ßß 
if
®® 
(
®® 
!
®® 

ModelState
®® 
.
®®  
IsValid
®®  '
)
®®' (
return
©© 

BadRequest
©© %
(
©©% &
ApiResponse
©©& 1
<
©©1 2
object
©©2 8
>
©©8 9
.
©©9 :
Fail
©©: >
(
©©> ?
$str
©©? R
,
©©R S

ModelState
©©T ^
)
©©^ _
)
©©_ `
;
©©` a
if
´´ 
(
´´ 
dto
´´ 
.
´´ 
SpentAmount
´´ #
<
´´$ %
$num
´´& '
)
´´' (
{
¨¨ 
return
≠≠ 

BadRequest
≠≠ %
(
≠≠% &
ApiResponse
≠≠& 1
<
≠≠1 2
object
≠≠2 8
>
≠≠8 9
.
≠≠9 :
Fail
≠≠: >
(
≠≠> ?
$str
≠≠? `
)
≠≠` a
)
≠≠a b
;
≠≠b c
}
ÆÆ 
var
∞∞ 
userId
∞∞ 
=
∞∞ 
int
∞∞  
.
∞∞  !
Parse
∞∞! &
(
∞∞& '
User
∞∞' +
.
∞∞+ ,
FindFirstValue
∞∞, :
(
∞∞: ;

ClaimTypes
∞∞; E
.
∞∞E F
NameIdentifier
∞∞F T
)
∞∞T U
!
∞∞U V
)
∞∞V W
;
∞∞W X
var
±± 
userRole
±± 
=
±± 
User
±± #
.
±±# $
FindFirstValue
±±$ 2
(
±±2 3

ClaimTypes
±±3 =
.
±±= >
Role
±±> B
)
±±B C
;
±±C D
var
≤≤ 
userDepartmentId
≤≤ $
=
≤≤% &
User
≤≤' +
.
≤≤+ ,
FindFirstValue
≤≤, :
(
≤≤: ;
$str
≤≤; I
)
≤≤I J
;
≤≤J K
var
µµ 

allocation
µµ 
=
µµ  
await
µµ! &
_db
µµ' *
.
µµ* +
Allocations
µµ+ 6
.
∂∂ 
Include
∂∂ 
(
∂∂ 
a
∂∂ 
=>
∂∂ !
a
∂∂" #
.
∂∂# $

Department
∂∂$ .
)
∂∂. /
.
∑∑ 
Include
∑∑ 
(
∑∑ 
a
∑∑ 
=>
∑∑ !
a
∑∑" #
.
∑∑# $
Category
∑∑$ ,
)
∑∑, -
.
∏∏ !
FirstOrDefaultAsync
∏∏ (
(
∏∏( )
a
∏∏) *
=>
∏∏+ -
a
∏∏. /
.
∏∏/ 0
Id
∏∏0 2
==
∏∏3 5
allocationId
∏∏6 B
)
∏∏B C
;
∏∏C D
if
∫∫ 
(
∫∫ 

allocation
∫∫ 
==
∫∫ !
null
∫∫" &
)
∫∫& '
{
ªª 
return
ºº 
NotFound
ºº #
(
ºº# $
ApiResponse
ºº$ /
<
ºº/ 0
object
ºº0 6
>
ºº6 7
.
ºº7 8
Fail
ºº8 <
(
ºº< =
$"
ºº= ?
$str
ºº? R
{
ººR S
allocationId
ººS _
}
ºº_ `
$str
ºº` j
"
ººj k
)
ººk l
)
ººl m
;
ººm n
}
ΩΩ 
if
¿¿ 
(
¿¿ 
userRole
¿¿ 
==
¿¿ 
nameof
¿¿  &
(
¿¿& '
UserRole
¿¿' /
.
¿¿/ 0
DepartmentHead
¿¿0 >
)
¿¿> ?
)
¿¿? @
{
¡¡ 
if
¬¬ 
(
¬¬ 
string
¬¬ 
.
¬¬ 
IsNullOrEmpty
¬¬ ,
(
¬¬, -
userDepartmentId
¬¬- =
)
¬¬= >
||
¬¬? A
int
¬¬B E
.
¬¬E F
Parse
¬¬F K
(
¬¬K L
userDepartmentId
¬¬L \
)
¬¬\ ]
!=
¬¬^ `

allocation
¬¬a k
.
¬¬k l
DepartmentId
¬¬l x
)
¬¬x y
{
√√ 
return
≈≈ 

StatusCode
≈≈ )
(
≈≈) *
$num
≈≈* -
,
≈≈- .
ApiResponse
≈≈/ :
<
≈≈: ;
object
≈≈; A
>
≈≈A B
.
≈≈B C
Fail
≈≈C G
(
≈≈G H
$str
∆∆ o
)
«« 
)
«« 
;
«« 
}
»» 
}
…… 
var
ÀÀ 
oldSpent
ÀÀ 
=
ÀÀ 

allocation
ÀÀ )
.
ÀÀ) *
Spent
ÀÀ* /
;
ÀÀ/ 0
await
ÃÃ 
_service
ÃÃ 
.
ÃÃ 
UpdateSpentAsync
ÃÃ /
(
ÃÃ/ 0
allocationId
ÃÃ0 <
,
ÃÃ< =
dto
ÃÃ> A
.
ÃÃA B
SpentAmount
ÃÃB M
,
ÃÃM N
userId
ÃÃO U
)
ÃÃU V
;
ÃÃV W
_logger
ŒŒ 
.
ŒŒ 
LogInformation
ŒŒ &
(
ŒŒ& '
$strŒŒ' ì
,ŒŒì î
allocationId
œœ  
,
œœ  !
oldSpent
œœ" *
,
œœ* +
dto
œœ, /
.
œœ/ 0
SpentAmount
œœ0 ;
,
œœ; <
userId
œœ= C
,
œœC D
userRole
œœE M
)
œœM N
;
œœN O
if
““ 
(
““ 
userRole
““ 
==
““ 
nameof
““  &
(
““& '
UserRole
““' /
.
““/ 0
DepartmentHead
““0 >
)
““> ?
)
““? @
{
”” 
await
‘‘ %
CreateNotificationAsync
‘‘ 1
(
‘‘1 2

targetRole
’’ "
:
’’" #
nameof
’’$ *
(
’’* +
UserRole
’’+ 3
.
’’3 4
FinanceAdmin
’’4 @
)
’’@ A
,
’’A B
title
÷÷ 
:
÷÷ 
$str
÷÷ <
,
÷÷< =
message
◊◊ 
:
◊◊  
$"
◊◊! #
$str
◊◊# .
{
◊◊. /

allocation
◊◊/ 9
.
◊◊9 :

Department
◊◊: D
.
◊◊D E
Name
◊◊E I
}
◊◊I J
$str
◊◊J `
{
◊◊` a

allocation
◊◊a k
.
◊◊k l
Category
◊◊l t
.
◊◊t u
Name
◊◊u y
}
◊◊y z
$str
◊◊z |
{
◊◊| }
oldSpent◊◊} Ö
:◊◊Ö Ü
$str◊◊Ü á
}◊◊á à
$str◊◊à ã
{◊◊ã å
dto◊◊å è
.◊◊è ê
SpentAmount◊◊ê õ
:◊◊õ ú
$str◊◊ú ù
}◊◊ù û
"◊◊û ü
)
ÿÿ 
;
ÿÿ 
}
ŸŸ 
return
€€ 
Ok
€€ 
(
€€ 
ApiResponse
€€ %
<
€€% &
object
€€& ,
>
€€, -
.
€€- .
Ok
€€. 0
(
€€0 1
new
€€1 4
{
‹‹ 
AllocationId
››  
=
››! "
allocationId
››# /
,
››/ 0
OldSpent
ﬁﬁ 
=
ﬁﬁ 
oldSpent
ﬁﬁ '
,
ﬁﬁ' (
NewSpent
ﬂﬂ 
=
ﬂﬂ 
dto
ﬂﬂ "
.
ﬂﬂ" #
SpentAmount
ﬂﬂ# .
,
ﬂﬂ. /
	Remaining
‡‡ 
=
‡‡ 

allocation
‡‡  *
.
‡‡* +
Amount
‡‡+ 1
-
‡‡2 3
dto
‡‡4 7
.
‡‡7 8
SpentAmount
‡‡8 C
,
‡‡C D
	UpdatedBy
·· 
=
·· 
userRole
··  (
,
··( )
	UpdatedAt
‚‚ 
=
‚‚ 
DateTime
‚‚  (
.
‚‚( )
UtcNow
‚‚) /
}
„„ 
,
„„ 
$str
„„ 6
)
„„6 7
)
„„7 8
;
„„8 9
}
‰‰ 
catch
ÂÂ 
(
ÂÂ 
ArgumentException
ÂÂ $
ex
ÂÂ% '
)
ÂÂ' (
{
ÊÊ 
_logger
ÁÁ 
.
ÁÁ 

LogWarning
ÁÁ "
(
ÁÁ" #
$str
ÁÁ# b
,
ÁÁb c
allocationId
ÁÁd p
,
ÁÁp q
ex
ÁÁr t
.
ÁÁt u
Message
ÁÁu |
)
ÁÁ| }
;
ÁÁ} ~
return
ËË 

BadRequest
ËË !
(
ËË! "
ApiResponse
ËË" -
<
ËË- .
object
ËË. 4
>
ËË4 5
.
ËË5 6
Fail
ËË6 :
(
ËË: ;
ex
ËË; =
.
ËË= >
Message
ËË> E
)
ËËE F
)
ËËF G
;
ËËG H
}
ÈÈ 
catch
ÍÍ 
(
ÍÍ 
	Exception
ÍÍ 
ex
ÍÍ 
)
ÍÍ  
{
ÎÎ 
_logger
ÏÏ 
.
ÏÏ 
LogError
ÏÏ  
(
ÏÏ  !
ex
ÏÏ! #
,
ÏÏ# $
$str
ÏÏ% `
,
ÏÏ` a
allocationId
ÏÏb n
)
ÏÏn o
;
ÏÏo p
return
ÌÌ 

StatusCode
ÌÌ !
(
ÌÌ! "
$num
ÌÌ" %
,
ÌÌ% &
ApiResponse
ÌÌ' 2
<
ÌÌ2 3
object
ÌÌ3 9
>
ÌÌ9 :
.
ÌÌ: ;
Fail
ÌÌ; ?
(
ÌÌ? @
$str
ÌÌ@ o
)
ÌÌo p
)
ÌÌp q
;
ÌÌq r
}
ÓÓ 
}
ÔÔ 	
[
ıı 	
HttpGet
ıı	 
(
ıı 
$str
ıı ;
)
ıı; <
]
ıı< =
[
ˆˆ 	
	Authorize
ˆˆ	 
]
ˆˆ 
public
˜˜ 
async
˜˜ 
Task
˜˜ 
<
˜˜ 
ActionResult
˜˜ &
<
˜˜& '
ApiResponse
˜˜' 2
<
˜˜2 3
object
˜˜3 9
>
˜˜9 :
>
˜˜: ;
>
˜˜; <%
GetDepartmentStatistics
˜˜= T
(
˜˜T U
[
˜˜U V
	FromRoute
˜˜V _
]
˜˜_ `
int
˜˜a d
departmentId
˜˜e q
)
˜˜q r
{
¯¯ 	
try
˘˘ 
{
˙˙ 
var
¸¸ 
userRole
¸¸ 
=
¸¸ 
User
¸¸ #
.
¸¸# $
FindFirstValue
¸¸$ 2
(
¸¸2 3

ClaimTypes
¸¸3 =
.
¸¸= >
Role
¸¸> B
)
¸¸B C
;
¸¸C D
var
˝˝ 
userDepartmentId
˝˝ $
=
˝˝% &
User
˝˝' +
.
˝˝+ ,
FindFirstValue
˝˝, :
(
˝˝: ;
$str
˝˝; I
)
˝˝I J
;
˝˝J K
if
ˇˇ 
(
ˇˇ 
userRole
ˇˇ 
==
ˇˇ 
nameof
ˇˇ  &
(
ˇˇ& '
UserRole
ˇˇ' /
.
ˇˇ/ 0
DepartmentHead
ˇˇ0 >
)
ˇˇ> ?
)
ˇˇ? @
{
ÄÄ 
if
ÅÅ 
(
ÅÅ 
string
ÅÅ 
.
ÅÅ 
IsNullOrEmpty
ÅÅ ,
(
ÅÅ, -
userDepartmentId
ÅÅ- =
)
ÅÅ= >
||
ÅÅ? A
int
ÅÅB E
.
ÅÅE F
Parse
ÅÅF K
(
ÅÅK L
userDepartmentId
ÅÅL \
)
ÅÅ\ ]
!=
ÅÅ^ `
departmentId
ÅÅa m
)
ÅÅm n
{
ÇÇ 
return
ÑÑ 

StatusCode
ÑÑ )
(
ÑÑ) *
$num
ÑÑ* -
,
ÑÑ- .
ApiResponse
ÑÑ/ :
<
ÑÑ: ;
object
ÑÑ; A
>
ÑÑA B
.
ÑÑB C
Fail
ÑÑC G
(
ÑÑG H
$str
ÖÖ l
)
ÜÜ 
)
ÜÜ 
;
ÜÜ 
}
áá 
}
àà 
var
ää 
allocations
ää 
=
ää  !
await
ää" '
_db
ää( +
.
ää+ ,
Allocations
ää, 7
.
ãã 
Where
ãã 
(
ãã 
a
ãã 
=>
ãã 
a
ãã  !
.
ãã! "
DepartmentId
ãã" .
==
ãã/ 1
departmentId
ãã2 >
)
ãã> ?
.
åå 
ToListAsync
åå  
(
åå  !
)
åå! "
;
åå" #
var
éé 

statistics
éé 
=
éé  
new
éé! $
{
èè 
DepartmentId
êê  
=
êê! "
departmentId
êê# /
,
êê/ 0
TotalCategories
ëë #
=
ëë$ %
allocations
ëë& 1
.
ëë1 2
Count
ëë2 7
,
ëë7 8
TotalAllocated
íí "
=
íí# $
allocations
íí% 0
.
íí0 1
Sum
íí1 4
(
íí4 5
a
íí5 6
=>
íí7 9
a
íí: ;
.
íí; <
Amount
íí< B
)
ííB C
,
ííC D

TotalSpent
ìì 
=
ìì  
allocations
ìì! ,
.
ìì, -
Sum
ìì- 0
(
ìì0 1
a
ìì1 2
=>
ìì3 5
a
ìì6 7
.
ìì7 8
Spent
ìì8 =
)
ìì= >
,
ìì> ?
TotalRemaining
îî "
=
îî# $
allocations
îî% 0
.
îî0 1
Sum
îî1 4
(
îî4 5
a
îî5 6
=>
îî7 9
a
îî: ;
.
îî; <
Amount
îî< B
-
îîC D
a
îîE F
.
îîF G
Spent
îîG L
)
îîL M
,
îîM N#
UtilizationPercentage
ïï )
=
ïï* +
allocations
ïï, 7
.
ïï7 8
Sum
ïï8 ;
(
ïï; <
a
ïï< =
=>
ïï> @
a
ïïA B
.
ïïB C
Amount
ïïC I
)
ïïI J
>
ïïK L
$num
ïïM N
?
ññ 
Math
ññ 
.
ññ 
Round
ññ $
(
ññ$ %
(
ññ% &
allocations
ññ& 1
.
ññ1 2
Sum
ññ2 5
(
ññ5 6
a
ññ6 7
=>
ññ8 :
a
ññ; <
.
ññ< =
Spent
ññ= B
)
ññB C
/
ññD E
allocations
ññF Q
.
ññQ R
Sum
ññR U
(
ññU V
a
ññV W
=>
ññX Z
a
ññ[ \
.
ññ\ ]
Amount
ññ] c
)
ññc d
)
ññd e
*
ññf g
$num
ññh k
,
ññk l
$num
ññm n
)
ññn o
:
óó 
$num
óó 
,
óó "
CategoriesOverBudget
òò (
=
òò) *
allocations
òò+ 6
.
òò6 7
Count
òò7 <
(
òò< =
a
òò= >
=>
òò? A
a
òòB C
.
òòC D
Spent
òòD I
>
òòJ K
a
òòL M
.
òòM N
Amount
òòN T
)
òòT U
,
òòU V!
CategoriesNearLimit
ôô '
=
ôô( )
allocations
ôô* 5
.
ôô5 6
Count
ôô6 ;
(
ôô; <
a
ôô< =
=>
ôô> @
a
ôôA B
.
ôôB C
Spent
ôôC H
>=
ôôI K
(
ôôL M
a
ôôM N
.
ôôN O
Amount
ôôO U
*
ôôV W
$num
ôôX \
)
ôô\ ]
&&
ôô^ `
a
ôôa b
.
ôôb c
Spent
ôôc h
<=
ôôi k
a
ôôl m
.
ôôm n
Amount
ôôn t
)
ôôt u
,
ôôu v
LastUpdated
öö 
=
öö  !
DateTime
öö" *
.
öö* +
UtcNow
öö+ 1
}
õõ 
;
õõ 
return
ùù 
Ok
ùù 
(
ùù 
ApiResponse
ùù %
<
ùù% &
object
ùù& ,
>
ùù, -
.
ùù- .
Ok
ùù. 0
(
ùù0 1

statistics
ùù1 ;
,
ùù; <
$str
ùù= k
)
ùùk l
)
ùùl m
;
ùùm n
}
ûû 
catch
üü 
(
üü 
	Exception
üü 
ex
üü 
)
üü  
{
†† 
_logger
°° 
.
°° 
LogError
°°  
(
°°  !
ex
°°! #
,
°°# $
$str
°°% `
,
°°` a
departmentId
°°b n
)
°°n o
;
°°o p
return
¢¢ 

StatusCode
¢¢ !
(
¢¢! "
$num
¢¢" %
,
¢¢% &
ApiResponse
¢¢' 2
<
¢¢2 3
object
¢¢3 9
>
¢¢9 :
.
¢¢: ;
Fail
¢¢; ?
(
¢¢? @
$str
¢¢@ o
)
¢¢o p
)
¢¢p q
;
¢¢q r
}
££ 
}
§§ 	
private
©© 
async
©© 
Task
©© %
CreateNotificationAsync
©© 2
(
©©2 3
string
©©3 9
?
©©9 :

targetRole
©©; E
=
©©F G
null
©©H L
,
©©L M
string
©©N T
title
©©U Z
=
©©[ \
$str
©©] _
,
©©_ `
string
©©a g
message
©©h o
=
©©p q
$str
©©r t
)
©©t u
{
™™ 	
try
´´ 
{
¨¨ 
var
≠≠ 
notification
≠≠  
=
≠≠! "
new
≠≠# &
Notification
≠≠' 3
{
ÆÆ 

TargetRole
ØØ 
=
ØØ  

targetRole
ØØ! +
??
ØØ, .
$str
ØØ/ 1
,
ØØ1 2
Title
∞∞ 
=
∞∞ 
title
∞∞ !
,
∞∞! "
Message
±± 
=
±± 
message
±± %
,
±±% &
IsRead
≤≤ 
=
≤≤ 
false
≤≤ "
,
≤≤" #
	CreatedAt
≥≥ 
=
≥≥ 
DateTime
≥≥  (
.
≥≥( )
UtcNow
≥≥) /
}
¥¥ 
;
¥¥ 
_db
∂∂ 
.
∂∂ 
Notifications
∂∂ !
.
∂∂! "
Add
∂∂" %
(
∂∂% &
notification
∂∂& 2
)
∂∂2 3
;
∂∂3 4
await
∑∑ 
_db
∑∑ 
.
∑∑ 
SaveChangesAsync
∑∑ *
(
∑∑* +
)
∑∑+ ,
;
∑∑, -
_logger
ππ 
.
ππ 
LogInformation
ππ &
(
ππ& '
$str
ππ' W
,
ππW X
title
ππY ^
,
ππ^ _

targetRole
ππ` j
)
ππj k
;
ππk l
}
∫∫ 
catch
ªª 
(
ªª 
	Exception
ªª 
ex
ªª 
)
ªª  
{
ºº 
_logger
ΩΩ 
.
ΩΩ 
LogError
ΩΩ  
(
ΩΩ  !
ex
ΩΩ! #
,
ΩΩ# $
$str
ΩΩ% K
,
ΩΩK L
title
ΩΩM R
)
ΩΩR S
;
ΩΩS T
}
øø 
}
¿¿ 	
}
¡¡ 
}¬¬ 